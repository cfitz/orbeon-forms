<xforms:model id="MODS" schema="oxf:/apps/mods/schema.xsd"
      xmlns:xs="http://www.w3.org/2001/XMLSchema"
      xmlns:xforms="http://www.w3.org/2002/xforms"
      xmlns:ev="http://www.w3.org/2001/xml-events"
      xmlns:xxforms="http://orbeon.org/oxf/xml/xforms"
      xmlns:exforms="http://www.exforms.org/exf/1-0"
      xmlns:xi="http://www.w3.org/2001/XInclude"
      xmlns:f="http://orbeon.org/oxf/xml/formatting"
      xmlns:xhtml="http://www.w3.org/1999/xhtml"
      xmlns:xxi="http://orbeon.org/oxf/xml/xinclude"
      xmlns:dmv="http://orbeon.org/oxf/examples/dmv"
      xmlns:mods="http://www.loc.gov/mods/v3"
     xmlns:dl="http://dl.lib.brown.edu/editor/mods/dl" 
      xmlns="http://www.w3.org/1999/xhtml">

    <!-- This is called when the XForms engine is ready -->
    <xforms:action ev:event="xforms-ready">
        
        <!-- Set initial focus -->
        <xforms:setfocus control="mods-titleinfo-title-control"/>
        <!-- Make sure we look clean after initialization, as insertions can take place above -->
        <xforms:setvalue ref="xxforms:instance('control-instance')/data-status"/>
       
  <xforms:setvalue model="resources-model" ref="instance('language-instance')">norm</xforms:setvalue>
<xforms:send submission="update-language-submission"/> 
       
    </xforms:action>

    <!-- Mark document as dirty in case of insertion or deletion -->
    <xforms:setvalue ev:event="xforms-insert" ref="xxforms:instance('control-instance')/data-status">dirty</xforms:setvalue>
    <xforms:setvalue ev:event="xforms-delete" ref="xxforms:instance('control-instance')/data-status">dirty</xforms:setvalue>

    

    <!-- Main XForms instance -->
     <xforms:instance id="document-instance" src="oxf:/apps/immigrationCommission/forms/documents/template-form.xml" xxforms:readonly-appearance="static" />




    <!-- XForms instance containing the XML schema (for enumerations) -->
    <xforms:instance id="schema-instance" src="oxf:/apps/mods/schema.xsd" xxforms:readonly="true" xxforms:shared="application"/>


    <!-- XForms instance for widget control information -->
    <xforms:instance id="triggers-instance">
        <control xmlns="">
        
            <add-titleInfo-trigger/>
            <remove-titleInfo-trigger/>
            <add-titleType-trigger/>
            <remove-titleType-trigger/>
            <add-titleNonSort-trigger/>  
            <remove-titleNonSort-trigger/>
            <add-titleTitle-trigger/>
            <remove-titleTitle-trigger/>
            <add-titleSubTitle-trigger/>
            <remove-titleSubTitle-trigger/>
            <add-titlePartNumber-trigger/>
            <remove-titlePartNumber-trigger/>
            <add-titlePartName-trigger/>
            <remove-titlePartName-trigger/>
            
            <add-originInfo-trigger/>
            <keyDate-trigger/>
            <remove-originInfo-trigger/> 
              <add-copyrightDate-trigger/>
                <add-creationDate-trigger/>
                <remove-dateCreated-trigger/>
                   <add-identifier-trigger/>
                <remove-identifier-trigger/>
			<add-typeofresource-trigger/>
			<remove-typeofresource-trigger/>
           	<add-name-trigger/>
			<remove-name-trigger/>
			  	<add-genre-trigger/>
			<remove-genre-trigger/>
			 <add-physicalDescription-trigger/>
			<remove-physicalDescription-trigger/>
			<add-location-trigger/>
			<remove-location-trigger/>
			<add-url-trigger/>
			<remove-url-trigger/>
			<add-physicallocation-trigger/>
			<remove-physicallocation-trigger/>
			<add-accessCondition-trigger/>
			<remove-accessCondition-trigger/>
				<add-abstract-trigger/>
			<remove-abstract-trigger/>
			<add-subject-trigger/>
			<remove-subject-trigger/>
			<add-note-trigger/>
			<remove-note-trigger/>
				<add-namePart-trigger/>
			<remove-namePart-trigger/>
				<add-nameRole-trigger/>
			<remove-nameRole-trigger/>
        </control>
    </xforms:instance>

<!-- mods instances -->
			 <xforms:instance id="genre-instance" src="oxf:/apps/immigrationCommission/forms/documents/instance/genre-instance.xml" />
		    <xforms:instance id="origininfodate-instance" src="oxf:/apps/immigrationCommission/forms/documents/instance/origininfodate-instance.xml" />
			<xforms:instance id="origininfo-instance" src="oxf:/apps/immigrationCommission/forms/documents/instance/origininfo-instance.xml" />
			<xforms:instance id="titleinfo-instance"  src="oxf:/apps/immigrationCommission/forms/documents/instance/titleinfo-instance.xml" />
			<xforms:instance id="nonsort-instance" src="oxf:/apps/immigrationCommission/forms/documents/instance/nonsort-instance.xml" />
			<xforms:instance id="typeofresource-instance" src="oxf:/apps/immigrationCommission/forms/documents/instance/typeofresource-instance.xml" />
			<xforms:instance id="name-instance" src="oxf:/apps/immigrationCommission/forms/documents/instance/name-instance.xml" />
			<xforms:instance id="abstract-instance" src="oxf:/apps/immigrationCommission/forms/documents/instance/abstract-instance.xml" />
			<xforms:instance id="note-instance" src="oxf:/apps/immigrationCommission/forms/documents/instance/note-instance.xml" />
			<xforms:instance id="modslanguage-instance" src="oxf:/apps/immigrationCommission/forms/documents/instance/language-instance.xml" />
			<xforms:instance id="identifier-instance" src="oxf:/apps/immigrationCommission/forms/documents/instance/identifier-instance.xml" />
\			<xforms:instance id="insert-instance" src="oxf:/apps/immigrationCommission/forms/documents/instance/insert-instance.xml" />
\			<xforms:instance id="subject-instance" src="oxf:/apps/immigrationCommission/forms/documents/instance/subject-instance.xml" />
		<!--	<xforms:instance id="errors-instance" src="oxf:/apps/immigrationCommission/forms/documents/instance/errors-instance.xml" />-->
			<xforms:instance id="error-template-instance" src="oxf:/apps/immigrationCommission/forms/documents/instance/error-template-instance.xml" />
			<xforms:instance id="toggle-instance" src="oxf:/apps/immigrationCommission/forms/documents/instance/toggle-instance.xml" />
		<!--	<xforms:instance id="control-instance" src="oxf:/apps/immigrationCommission/forms/documents/instance/control-instance.xml" />-->
			<xforms:instance id="record-instance" src="oxf:/apps/immigrationCommission/forms/documents/instance/record-instance.xml" />
			<xforms:instance id="datechoice-instance" src="oxf:/apps/immigrationCommission/forms/documents/instance/datechoice-instance.xml" />
		
			<!-- itemsets -->
			<xforms:instance id="qualifier-select" src="oxf:/apps/immigrationCommission/forms/documents/select/qualifier-select.xml" />
			<xforms:instance id="nonsort-select" src="oxf:/apps/immigrationCommission/forms/documents/select/nonsort-select.xml" />
			<xforms:instance id="titletype-select" src="oxf:/apps/immigrationCommission/forms/documents/select/titletype-select.xml" />
			<xforms:instance id="datetype-select" src="oxf:/apps/immigrationCommission/forms/documents/select/datetype-select.xml" />
			<xforms:instance id="daterange-select" src="oxf:/apps/immigrationCommission/forms/documents/select/daterange-select.xml" />
			<xforms:instance id="genretype-select" src="oxf:/apps/immigrationCommission/forms/documents/select/genretype-select.xml" />
			  <xforms:instance id="typeofresource-select" src="oxf:/apps/immigrationCommission/forms/documents/select/typeofresource-select.xml" />
			<xforms:instance id="nametype-select" src="oxf:/apps/immigrationCommission/forms/documents/select/nametype-select.xml" />
			<xforms:instance id="roletype-select" src="oxf:/apps/immigrationCommission/forms/documents/select/roletype-select.xml" />
			<xforms:instance id="notetype-select" src="oxf:/apps/immigrationCommission/forms/documents/select/notetype-select.xml" />
			<xforms:instance id="languageterm-select" src="oxf:/apps/immigrationCommission/forms/documents/select/languageterm-select.xml" />
			<xforms:instance id="identifiertype-select" src="oxf:/apps/immigrationCommission/forms/documents/select/identifiertype-select.xml" />
			<xforms:instance id="form-select" src="oxf:/apps/immigrationCommission/forms/documents/select/form-select.xml" />
			<xforms:instance id="internetmediatype-select" src="oxf:/apps/immigrationCommission/forms/documents/select/internetmediatype-select.xml" />
			<xforms:instance id="digitalorigin-select" src="oxf:/apps/immigrationCommission/forms/documents/select/digitalorigin-select.xml" />
			<xforms:instance id="urlaccess-select" src="oxf:/apps/immigrationCommission/forms/documents/select/urlaccess-select.xml" />
			<xforms:instance id="accesscondition-select" src="oxf:/apps/immigrationCommission/forms/documents/select/accesscondition-select.xml" />
			<xforms:instance id="nameparttype-select" src="oxf:/apps/immigrationCommission/forms/documents/select/nameparttype-select.xml" />


   			<xforms:bind nodeset="instance('toggle-instance')/button1" readonly="@readonly='true'"/>
			<xforms:bind nodeset="instance('toggle-instance')/button2" readonly="@readonly='true'"/>
			
			
			
			<xforms:bind nodeset="instance('document-instance')">
			<xforms:bind nodeset="." readonly="xxforms:instance('parameters-instance')/readonly = 'true'" />
		    <xforms:bind nodeset="mods:originInfo[1]/child::*[position()=1 and contains(name(),'ate')]" required="true()" type="dl:string" />
			<xforms:bind nodeset="mods:originInfo/mods:copyrightDate"  type="dl:date" />
			<xforms:bind nodeset="mods:originInfo/mods:dateCreated"  type="dl:date" />
			<xforms:bind nodeset="mods:originInfo/mods:dateIssued"  type="dl:date" />
			<xforms:bind nodeset="mods:identifier" required="true()" type="dl:string" readonly="@displayLabel='Suri'"/>
			<xforms:bind nodeset="mods:identifier/@type" required="true()" type="dl:string" />
			<xforms:bind nodeset="mods:titleInfo/mods:title" required="true()" type="dl:string" />
			<xforms:bind nodeset="mods:titleInfo/@type" required="true()" type="dl:string" />
			<xforms:bind nodeset="mods:typeOfResource" required="true()" type="dl:string" />
			<xforms:bind nodeset="mods:physicalDescription" required="true()" type="dl:string" />
			<xforms:bind nodeset="mods:physicalDescription/mods:digitalOrigin" required="true()" type="dl:string" />
			<xforms:bind nodeset="mods:location" required="true()" />
			<xforms:bind nodeset="mods:location/mods:url" required="true()" type="dl:string" />
			<xforms:bind nodeset="mods:accessCondition" required="true()" type="dl:string" />
			<xforms:bind nodeset="mods:accessCondition/@type" required="true()" type="dl:string" />
			 </xforms:bind>
			<!--   
			<xforms:bind nodeset="instance('document-instance')/mods:originInfo[1]/child::*[position()=2 and contains(name(),'ate')]" required="true()" type="dl:string" />
			
			<xforms:bind nodeset="instance('document-instance')/mods:genre" required="true()" type="dl:string" />
			<xforms:bind nodeset="instance('document-instance')/mods:name/@type" required="true()" type="dl:string" />
			<xforms:bind nodeset="instance('document-instance')/mods:name/mods:namePart" required="true()" type="dl:string" />
			<xforms:bind nodeset="instance('document-instance')/mods:name/mods:role/mods:roleTerm" required="true()" type="dl:string" />
			<xforms:bind nodeset="instance('document-instance')/mods:abstract" required="true()" type="dl:string" />
			<xforms:bind nodeset="instance('document-instance')/mods:note" required="true()" type="dl:string" />
			<xforms:bind nodeset="instance('document-instance')/mods:language/mods:languageTerm" required="true()" type="dl:string" />
			<xforms:bind nodeset="instance('datechoice-instance')/type" required="true()" type="dl:string" />
			<xforms:bind nodeset="instance('datechoice-instance')/range" required="true()" type="dl:string" readonly="if(instance('datechoice-instance')/type = 'copyrightDate' or instance('datechoice-instance')/type = '') then(true()) else(false())" />
     
			
			
  <xforms:bind nodeset="instance('document-instance')/mods:originInfo/child::*" readonly="xxforms:instance('parameters-instance')/readonly = 'true'"/>
				-->

<!--  Looks better than Brown trigger model... -->
    
    <xforms:bind nodeset="instance('triggers-instance')">
    
    <xforms:bind nodeset="add-identifier-trigger"
                     readonly=" xxforms:instance('parameters-instance')/readonly = 'true'"/>
        <xforms:bind nodeset="remove-identifier-trigger"
                     readonly="count(instance('document-instance')//mods:identifier) &lt; 2 or  xxforms:instance('parameters-instance')/readonly = 'true'" /> 
 		
    
    
        <xforms:bind nodeset="add-titleInfo-trigger"
                     readonly=" xxforms:instance('parameters-instance')/readonly = 'true'"/>
        <xforms:bind nodeset="remove-titleInfo-trigger"
                     readonly="count(instance('document-instance')/mods:titleInfo) &lt; 2 or xxforms:instance('parameters-instance')/readonly = 'true'"/>
        <xforms:bind nodeset="add-titleType-trigger" id="add-titleType-trigger"
                     readonly=" xxforms:instance('parameters-instance')/readonly = 'true'"/>
        <xforms:bind nodeset="remove-titleType-trigger" id="remove-titleType-trigger"
                     readonly="xxforms:instance('parameters-instance')/readonly = 'true'"/>
                     
   <xforms:bind nodeset="add-titleNonSort-trigger" id="add-titleNonSort-trigger"
                     readonly=" xxforms:instance('parameters-instance')/readonly = 'true'"/>
   <xforms:bind nodeset="remove-titleNonSort-trigger" id="remove-titleNonSort-trigger"
                     readonly="xxforms:instance('parameters-instance')/readonly = 'true'"/>
   <xforms:bind nodeset="add-titleTitle-trigger" id="add-titleTitle-trigger"
                     readonly=" xxforms:instance('parameters-instance')/readonly = 'true'"/>
   <xforms:bind nodeset="remove-titleTitle-trigger" id="remove-titleTitle-trigger"
                     readonly="xxforms:instance('parameters-instance')/readonly = 'true'"/>    	 
   <xforms:bind nodeset="add-titleSubTitle-trigger" id="add-titleSubTitle-trigger"
                     readonly=" xxforms:instance('parameters-instance')/readonly = 'true'"/>
   <xforms:bind nodeset="remove-titleSubTitle-trigger" id="remove-titleSubTitle-trigger"
                     readonly="xxforms:instance('parameters-instance')/readonly = 'true'"/>         
   <xforms:bind nodeset="add-titlePartNumber-trigger" id="add-titlePartNumber-trigger"
                     readonly=" xxforms:instance('parameters-instance')/readonly = 'true'"/>
   <xforms:bind nodeset="remove-titlePartNumber-trigger" id="remove-titlePartNumber-trigger"
                     readonly="xxforms:instance('parameters-instance')/readonly = 'true'"/>         
   <xforms:bind nodeset="add-titlePartName-trigger" id="add-titlePartName-trigger"
                     readonly=" xxforms:instance('parameters-instance')/readonly = 'true'"/>
   <xforms:bind nodeset="remove-titlePartName-trigger" id="remove-titlePartName-trigger"
                     readonly="xxforms:instance('parameters-instance')/readonly = 'true'"/>         
         
         <xforms:bind nodeset="add-originInfo-trigger"
                     readonly=" xxforms:instance('parameters-instance')/readonly = 'true'"/>
        <xforms:bind nodeset="remove-originInfo-trigger"
                     readonly=" xxforms:instance('parameters-instance')/readonly = 'true'"/>   
      <xforms:bind nodeset="add-typeofresource-trigger"
                     readonly=" xxforms:instance('parameters-instance')/readonly = 'true'"/>
        <xforms:bind nodeset="remove-typeofresource-trigger"
                     readonly=" xxforms:instance('parameters-instance')/readonly = 'true'"/>    
         <xforms:bind nodeset="add-copyrightDate-trigger"
                     readonly=" xxforms:instance('parameters-instance')/readonly = 'true'"/>
         <xforms:bind nodeset="remove-dateCreated-trigger"
                     readonly=" xxforms:instance('parameters-instance')/readonly = 'true'"/>
            <xforms:bind nodeset="keyDate-trigger"
					readonly=" xxforms:instance('parameters-instance')/readonly = 'true'"/>                              
         <xforms:bind nodeset="add-creationDate-trigger"
                     readonly=" xxforms:instance('parameters-instance')/readonly = 'true'"/>
   <xforms:bind nodeset="add-name-trigger"
                     readonly=" xxforms:instance('parameters-instance')/readonly = 'true'"/>
         <xforms:bind nodeset="remove-name-trigger"
                     readonly=" xxforms:instance('parameters-instance')/readonly = 'true'"/>    
                  <xforms:bind nodeset="add-genre-trigger"
                     readonly=" xxforms:instance('parameters-instance')/readonly = 'true'"/>
         <xforms:bind nodeset="remove-genre-trigger"
                     readonly=" xxforms:instance('parameters-instance')/readonly = 'true'"/> 
   <xforms:bind nodeset="add-physicalDescription-trigger"
                     readonly=" xxforms:instance('parameters-instance')/readonly = 'true'"/>
         <xforms:bind nodeset="remove-physicalDescription-trigger"
                     readonly=" xxforms:instance('parameters-instance')/readonly = 'true'"/>                      
 <xforms:bind nodeset="add-location-trigger"
                     readonly=" xxforms:instance('parameters-instance')/readonly = 'true'"/>
 <xforms:bind nodeset="remove-location-trigger"
                     readonly="count(instance('document-instance')/mods:location) &lt; 2 or xxforms:instance('parameters-instance')/readonly = 'true'"/>   
 <xforms:bind nodeset="add-url-trigger"
                     readonly="xxforms:instance('parameters-instance')/readonly = 'true'"/>
 <xforms:bind nodeset="remove-url-trigger"
                     readonly="xxforms:instance('parameters-instance')/readonly = 'true'"/> 
 <xforms:bind nodeset="add-physicallocation-trigger"
                     readonly=" xxforms:instance('parameters-instance')/readonly = 'true'"/>
 <xforms:bind nodeset="remove-physicallocation-trigger"
                    readonly=" xxforms:instance('parameters-instance')/readonly = 'true'"/>  
 <xforms:bind nodeset="remove-accessCondition-trigger"
                     readonly="count(instance('document-instance')/mods:accessCondition) &lt; 2 or xxforms:instance('parameters-instance')/readonly = 'true'"/>   
 <xforms:bind nodeset="add-accessCondition-trigger"
                     readonly=" xxforms:instance('parameters-instance')/readonly = 'true'"/>                    
  <xforms:bind nodeset="remove-subject-trigger"
                     readonly="count(instance('document-instance')/mods:subject) &lt; 2 or xxforms:instance('parameters-instance')/readonly = 'true'"/>   
 <xforms:bind nodeset="add-subject-trigger"
                     readonly=" xxforms:instance('parameters-instance')/readonly = 'true'"/>   
   <xforms:bind nodeset="remove-note-trigger"
                     readonly="count(instance('document-instance')/mods:note) &lt; 2 or xxforms:instance('parameters-instance')/readonly = 'true'"/>   
 <xforms:bind nodeset="add-note-trigger"
                     readonly=" xxforms:instance('parameters-instance')/readonly = 'true'"/> 
 <xforms:bind nodeset="remove-namePart-trigger" id="remove-namePart-trigger"
                     readonly="xxforms:instance('parameters-instance')/readonly = 'true'"/>   
 <xforms:bind nodeset="add-namePart-trigger" id="add-namePart-trigger"
                     readonly=" xxforms:instance('parameters-instance')/readonly = 'true'"/>   
  <xforms:bind nodeset="remove-nameRole-trigger" id="remove-nameRole-trigger"
                     readonly="xxforms:instance('parameters-instance')/readonly = 'true'"/>   
 <xforms:bind nodeset="add-nameRole-trigger" id="add-nameRole-trigger"
                     readonly=" xxforms:instance('parameters-instance')/readonly = 'true'"/> 

                                          </xforms:bind>

  
</xforms:model>
