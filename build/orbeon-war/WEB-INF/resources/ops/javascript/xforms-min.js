var XFORMS_SEPARATOR_1="\xB7";var XFORMS_SEPARATOR_2="-";var XFORMS_SERVER_PATH="/xforms-server";var XXFORMS_NAMESPACE_URI="http://orbeon.org/oxf/xml/xforms";var PATH_TO_JAVASCRIPT_1="/ops/javascript/xforms";var PATH_TO_JAVASCRIPT_2=XFORMS_SERVER_PATH+"/";var ELEMENT_TYPE=document.createElement("dummy").nodeType;var ATTRIBUTE_TYPE=document.createAttribute("dummy").nodeType;var TEXT_TYPE=document.createTextNode("").nodeType;var XFORMS_REGEXP_CR=new RegExp("\\r","g");var XFORMS_REGEXP_SINGLE_QUOTE=new RegExp("'","g");var XFORMS_REGEXP_OPEN_ANGLE=new RegExp("<","g");var XFORMS_REGEXP_AMPERSAND=new RegExp("&","g");var XFORMS_WIDE_TEXTAREA_MIN_ROWS=5;var DEFAULT_LOADING_TEXT="Loading...";var ORBEON=ORBEON||{};ORBEON.util=ORBEON.util||{};ORBEON.xforms=ORBEON.xforms||{};ORBEON.widgets=ORBEON.widgets||{};ORBEON.widget=ORBEON.widget||{};ORBEON.xforms.Globals=ORBEON.xforms.Globals||{};ORBEON.util={IEDom:{hasClass:function(b,c){if(b.className==c){return true}else{var a=b.className+XFORMS_SEPARATOR_1;if(a.indexOf(c+" ")==0){return true}if(a.indexOf(" "+c+" ")!=-1){return true}if(a.indexOf(" "+c+XFORMS_SEPARATOR_1)!=-1){return true}return false}},addClass:function(a,b){if(!this.hasClass(a,b)){a.className=a.className.length==0?b:(a.className+" "+b)}},setClasses:function(a,b){a.className=b},removeClass:function(d,e){if(this.hasClass(d,e)){var c=d.className.split(" ");var a="";for(var b=0;b<c.length;b++){if(c[b]!=e){if(a.length>0){a+=" "}a+=c[b]}}d.className=a}},getElementsByName:function(b,a,c){return b.getElementsByTagName(c==null?a:c+":"+a)}},MozDom:{_regenerateClassName:function(c){var a="";for(var b in c.orbeonClasses){if(c.orbeonClasses[b]){if(a.length>0){a+=" "}a+=b}}c.className=a},_regenerateOrbeonClasses:function(c){c.orbeonClasses={};var b=c.className.split(" ");for(var a=0;a<b.length;a++){c.orbeonClasses[b[a]]=true}},hasClass:function(a,b){if(!a.orbeonClasses){this._regenerateOrbeonClasses(a)}return a.orbeonClasses[b]==true},addClass:function(a,b){if(!this.hasClass(a,b)){a.orbeonClasses[b]=true;this._regenerateClassName(a)}},setClasses:function(a,b){a.className=b;this._regenerateOrbeonClasses(a)},removeClass:function(a,b){if(this.hasClass(a,b)){a.orbeonClasses[b]=false;this._regenerateClassName(a)}},getElementsByName:function(b,a,c){return b.getElementsByTagName((ORBEON.xforms.Globals.isFF3OrNewer&&c!=null?c+":":"")+a)}},Dom:{ELEMENT_TYPE:1,isElement:function(a){return a.nodeType==this.ELEMENT_TYPE},getElementById:function(a){return YAHOO.util.Dom.get(a)},getElementByIdNoCache:function(a){return YAHOO.util.Dom.get(a)},getAttribute:function(b,a){if(ORBEON.xforms.Globals.isRenderingEngineTrident){return b.getAttribute(a)}else{if(b.hasAttribute(a)){if(ORBEON.xforms.Globals.isRenderingEngineWebCore){return ORBEON.util.String.replace(b.getAttribute(a),"&#38;","&")}else{return b.getAttribute(a)}}else{return null}}},setAttribute:function(d,c,g){if(c=="class"){ORBEON.util.Dom.setClasses(d,g)}else{if(c=="colspan"){d.colSpan=g}else{if(c=="rowspan"){d.rowSpan=g}else{if(c=="accesskey"){d.accessKey=g}else{if(c=="tabindex"){d.tabIndex=g}else{if(c=="type"){d.type=g}else{if(c=="name"&&d.tagName.toLowerCase()=="input"){d.setAttribute(c,g);if(YAHOO.lang.isObject(d.form)){var b=d.form[g];var f=false;if(b&&YAHOO.lang.isNumber(b.length)){for(var e=0;e<b.length;e++){if(b[e]==d){f=true}}}else{if(YAHOO.lang.isObject(b)){if(b==d){f=true}}}if(!f){var a=d.outerHTML;a=a.replace(new RegExp(" name=.*( |>)","g"),"$1");a=a.replace(new RegExp(">"),' name="'+g+'">');var h=document.createElement(a);d.parentNode.insertBefore(h,d);d.parentNode.removeChild(d)}}}else{d.setAttribute(c,g)}}}}}}}},getChildElementByIndex:function(c,a){for(var b=0;b<c.childNodes.length;b++){var d=c.childNodes[b];if(ORBEON.util.Dom.isElement(d)){if(a==0){return d}a--}}return null},getChildElementByClass:function(c,a){for(var b=0;b<c.childNodes.length;b++){var d=c.childNodes[b];if(ORBEON.util.Dom.isElement(d)&&ORBEON.util.Dom.hasClass(d,a)){return d}}return null},getChildElementsByClass:function(d,b){var a=[];for(var c=0;c<d.childNodes.length;c++){var e=d.childNodes[c];if(ORBEON.util.Dom.isElement(e)&&ORBEON.util.Dom.hasClass(e,b)){a[a.length]=e}}return a.length==0?null:a},nextSiblingElement:function(a){while(true){var b=a.nextSibling;if(b==null){return null}if(ORBEON.util.Dom.isElement(b)){return b}}},stringToDom:function(a){if(document.implementation.createDocument){return(new DOMParser()).parseFromString(a,"application/xml")}else{if(window.ActiveXObject){var b=new ActiveXObject("Microsoft.XMLDOM");b.async="false";b.loadXML(a);return b}}return null},clearUploadControl:function(a){var d=YAHOO.util.Dom.getElementsByClassName("xforms-upload-select",null,a)[0];var b=d.parentNode;var c=document.createElement("input");ORBEON.util.Dom.addClass(c,d.className);c.setAttribute("type",d.type);c.setAttribute("name",d.name);c.setAttribute("size",d.size);c.setAttribute("unselectable","on");b.replaceChild(c,d);return null},getStringValue:function(c){if(c.innerText==null){var a="";for(var b=0;b<c.childNodes.length;b++){var d=c.childNodes[b];if(d.nodeType==TEXT_TYPE){a+=d.nodeValue}}return a}else{return c.innerText}},setStringValue:function(a,c){if(a.innerText==null){while(a.childNodes.length>0){a.removeChild(a.firstChild)}var b=a.ownerDocument.createTextNode(c);a.appendChild(b)}else{a.innerText=c}},nudgeAferDelay:function(b){if(YAHOO.env.ua.ie!=0&&YAHOO.env.ua.ie<=7){var a=b.getElementsByTagName("table");window.setTimeout(function(){b.className=b.className;for(var d=0;d<a.length;d++){var c=a[d];c.className=c.className}},ORBEON.util.Properties.internalShortDelay.get())}},getElementByTagName:function(d,e){var c=null;if(YAHOO.lang.isArray(e)){var b=e;for(var a=0;a<b.length;a++){var e=b[a];var c=ORBEON.util.Dom.getElementByTagName(d,e);if(c!=null){break}}}else{if(d.tagName.toLowerCase()==e){c=d}else{var f=d.getElementsByTagName(e);if(f.length==1){c=f[0]}}}return c},isAncestorOrSelfHidden:function(a){while(true){if(a==null){return false}if(!YAHOO.lang.isUndefined(a.style)&&YAHOO.util.Dom.getStyle(a,"display")=="none"){return true}a=a.parentNode}}},String:{replace:function(c,b,a){return c.indexOf(b)==-1?c:c.replace(new RegExp(b,"g"),a)},eval:function(javascriptString){javascriptString=ORBEON.util.String.replace(javascriptString,"\n"," ");javascriptString=ORBEON.util.String.replace(javascriptString,"\r"," ");return eval(javascriptString)},escapeAttribute:function(a){return ORBEON.util.String.replace(a,'"',"&quot;")},escapeHTMLMinimal:function(a){a=ORBEON.util.String.replace(a,"&","&amp;");return ORBEON.util.String.replace(a,"<","&lt;")},endsWith:function(c,b){var a=c.lastIndexOf(b);return a!=-1&&a+b.length==c.length},normalizeSerializedHTML:function(a){if(typeof a=="string"){return a.replace(XFORMS_REGEXP_CR,"")}else{return a}}},DateTime:{magicTimeToJSDate:function(a){return ORBEON.util.DateTime._magicToJSDate(a,ORBEON.util.DateTime._timeParsePatterns)},magicDateToJSDate:function(a){return ORBEON.util.DateTime._magicToJSDate(a,ORBEON.util.DateTime._dateParsePatterns)},_magicToJSDate:function(b,a){for(var c=0;c<a.length;c++){var e=a[c].re;var d=a[c].handler;var f=e.exec(b);if(f){return d(f)}}return null},jsDateToISOTime:function(a){return ORBEON.util.DateTime._padAZero(a.getHours())+":"+ORBEON.util.DateTime._padAZero(a.getMinutes())+":"+ORBEON.util.DateTime._padAZero(a.getSeconds())},jsDateToISODate:function(a){return a.getFullYear()+"-"+ORBEON.util.DateTime._padAZero(a.getMonth()+1)+"-"+ORBEON.util.DateTime._padAZero(a.getDate())},jsDateToISODateTime:function(a,b){return ORBEON.util.DateTime.jsDateToISODate(a)+"T"+ORBEON.util.DateTime.jsDateToISOTime(b)},jsDateToformatDisplayTime:function(a){if(ORBEON.util.Properties.formatInputTime.get()=="[H]:[m]:[s]"){return a.getHours()+":"+ORBEON.util.DateTime._padAZero(a.getMinutes())+":"+ORBEON.util.DateTime._padAZero(a.getSeconds())}else{return(a.getHours()==12?12:a.getHours()%12)+":"+ORBEON.util.DateTime._padAZero(a.getMinutes())+":"+ORBEON.util.DateTime._padAZero(a.getSeconds())+(a.getHours()<12?" a.m.":" p.m.")}},jsDateToformatDisplayDate:function(e){var g=ORBEON.util.Properties.formatInputDate.get();var b=g.split(new RegExp("[\\[\\]]"));var a=[];for(var c=0;c<b.length;c++){var f=b[c];function d(j){var h=j.apply(e).toString();if(f.indexOf("01")==1&&h.length<2){h="0"+h}a.push(h)}if(f==""){}else{if(f.indexOf("D")==0){d(e.getDate)}else{if(f.indexOf("M")==0){d(function(){return this.getMonth()+1})}else{if(f.indexOf("Y")==0){d(e.getFullYear)}else{a.push(f)}}}}}return a.join("")},_timeParsePatterns:[{re:/^now$/i,handler:function(){return new Date()}},{re:/^(\d{1,2}):(\d{1,2}):(\d{1,2}) ?(p|pm|p\.m\.)$/,handler:function(b){var c=new Date();var a=parseInt(b[1],10);if(a<12){a+=12}c.setHours(a);c.setMinutes(parseInt(b[2],10));c.setSeconds(parseInt(b[3],10));return c}},{re:/^(\d{1,2}):(\d{1,2}) ?(p|pm|p\.m\.)$/,handler:function(b){var c=new Date();var a=parseInt(b[1],10);if(a<12){a+=12}c.setHours(a);c.setMinutes(parseInt(b[2],10));c.setSeconds(0);return c}},{re:/^(\d{1,2}) ?(p|pm|p\.m\.)$/,handler:function(b){var c=new Date();var a=parseInt(b[1],10);if(a<12){a+=12}c.setHours(a);c.setMinutes(0);c.setSeconds(0);return c}},{re:/^(\d{1,2}):(\d{1,2}):(\d{1,2}) ?(a|am|a\.m\.)?$/,handler:function(b){var c=new Date();var a=parseInt(b[1],10);if(!YAHOO.lang.isUndefined(b[4])&&b[4]!=""){a=a%12}c.setHours(a);c.setMinutes(parseInt(b[2],10));c.setSeconds(parseInt(b[3],10));return c}},{re:/^(\d{1,2}):(\d{1,2}) ?(a|am|a\.m\.)?$/,handler:function(b){var c=new Date();var a=parseInt(b[1],10);if(!YAHOO.lang.isUndefined(b[3])&&b[3]!=""){a=a%12}c.setHours(a);c.setMinutes(parseInt(b[2],10));c.setSeconds(0);return c}},{re:/^(\d{1,2}) ?(a|am|a\.m\.)?$/,handler:function(b){var c=new Date();var a=parseInt(b[1],10);if(!YAHOO.lang.isUndefined(b[2])&&b[2]!=""){a=a%12}c.setHours(a);c.setMinutes(0);c.setSeconds(0);return c}},{re:/^(\d{1,6})$/,handler:function(e){var f=new Date();var c=e[1].substring(0,2);var a=parseInt(e[1].substring(2,4),10);var b=parseInt(e[1].substring(4,6),10);if(isNaN(a)){a=0}if(isNaN(b)){b=0}f.setHours(parseInt(c,10));f.setMinutes(parseInt(a,10));f.setSeconds(parseInt(b,10));return f}}],_dateParsePatterns:[{re:/^tod/i,handler:function(){return new Date()}},{re:/^tom/i,handler:function(){var a=new Date();a.setDate(a.getDate()+1);return a}},{re:/^yes/i,handler:function(){var a=new Date();a.setDate(a.getDate()-1);return a}},{re:/^(\d{1,2})(st|nd|rd|th)?$/i,handler:function(a){var b=new Date();b.setDate(parseInt(a[1],10));return b}},{re:/^(\d{1,2})(?:st|nd|rd|th)? (\w+)$/i,handler:function(a){return ORBEON.util.DateTime._newDate(ORBEON.util.DateTime._currentYear,ORBEON.util.DateTime._parseMonth(a[2]),parseInt(a[1],10))}},{re:/^(\d{1,2})(?:st|nd|rd|th)? (\w+),? (\d{2,4})$/i,handler:function(a){return ORBEON.util.DateTime._newDate(ORBEON.util.DateTime._parseYear(a[3]),ORBEON.util.DateTime._parseMonth(a[2]),parseInt(a[1],10))}},{re:/^(\w+) (\d{1,2})(?:st|nd|rd|th)?$/i,handler:function(a){return ORBEON.util.DateTime._newDate(ORBEON.util.DateTime._currentYear,ORBEON.util.DateTime._parseMonth(a[1]),parseInt(a[2],10))}},{re:/^(\w+) (\d{1,2})(?:st|nd|rd|th)?,? (\d{2,4})$/i,handler:function(a){return ORBEON.util.DateTime._newDate(ORBEON.util.DateTime._parseYear(a[3]),ORBEON.util.DateTime._parseMonth(a[1]),parseInt(a[2],10))}},{re:/^next (\w+)$/i,handler:function(e){var f=new Date();var b=f.getDay();var c=ORBEON.util.DateTime._parseWeekday(e[1]);var a=c-b;if(c<=b){a+=7}f.setDate(f.getDate()+a);return f}},{re:/^last (\w+)$/i,handler:function(a){throw new Error("Not yet implemented")}},{re:/^(\d{1,2}).(\d{1,2}).(\d{2,4})$/,handler:function(a){var b;if(ORBEON.util.Properties.formatInputDate.get().indexOf("[D")==0){b=ORBEON.util.DateTime._newDate(ORBEON.util.DateTime._parseYear(a[3]),parseInt(a[2],10)-1,parseInt(a[1],10))}else{b=ORBEON.util.DateTime._newDate(ORBEON.util.DateTime._parseYear(a[3]),parseInt(a[1],10)-1,parseInt(a[2],10))}return b}},{re:/^(\d{1,2}).(\d{1,2})$/,handler:function(a){var b;if(ORBEON.util.Properties.formatInputDate.get().indexOf("[D")==0){b=ORBEON.util.DateTime._newDate(ORBEON.util.DateTime._currentYear,parseInt(a[1],10)-1,parseInt(a[2],10))}else{b=ORBEON.util.DateTime._newDate(ORBEON.util.DateTime._currentYear,parseInt(a[2],10)-1,parseInt(a[1],10))}return b}},{re:/(^\d{4})-(\d{1,2})-(\d{1,2})(Z|([+-]\d{2}:\d{2}))?$/,handler:function(a){return ORBEON.util.DateTime._newDate(ORBEON.util.DateTime._parseYear(a[1]),parseInt(a[2],10)-1,parseInt(a[3],10))}}],_padAZero:function(a){a=a.toString();if(a.length==1){return"0"+a}else{return a}},_monthNames:"January February March April May June July August September October November December".split(" "),_weekdayNames:"Sunday Monday Tuesday Wednesday Thursday Friday Saturday".split(" "),_parseMonth:function(b){var a=ORBEON.util.DateTime._monthNames.filter(function(c){return new RegExp("^"+b,"i").test(c)});if(a.length==0){throw new Error("Invalid month string")}if(a.length>1){throw new Error("Ambiguous month")}return ORBEON.util.DateTime._monthNames.indexOf(a[0])},_parseWeekday:function(b){var a=ORBEON.util.DateTime._weekdayNames.filter(function(c){return new RegExp("^"+b,"i").test(c)});if(a.length==0){throw new Error("Invalid day string")}if(a.length>1){throw new Error("Ambiguous weekday")}return ORBEON.util.DateTime._weekdayNames.indexOf(a[0])},_currentYear:new Date().getFullYear(),_parseYear:function(b){b=parseInt(b,10);if(b<100){var a=1900+b;var c=2000+b;b=Math.abs(a-ORBEON.util.DateTime._currentYear)<Math.abs(c-ORBEON.util.DateTime._currentYear)?a:c}return b},_newDate:function(c,d,b){var a=new Date(c,d,b);return a.getFullYear()==c&&a.getMonth()==d&&a.getDate()==b?a:null}},Property:function(){var a=function(c,b){this.name=c;this.defaultValue=b};a.prototype.get=function(){return YAHOO.lang.isUndefined(opsXFormsProperties)||YAHOO.lang.isUndefined(opsXFormsProperties[this.name])?this.defaultValue:opsXFormsProperties[this.name]};return a}(),Properties:{init:function(){this.sessionHeartbeat=new ORBEON.util.Property("session-heartbeat",true);this.sessionHeartbeatDelay=new ORBEON.util.Property("session-heartbeat-delay",12*60*60*800);this.revisitHandling=new ORBEON.util.Property("revisit-handling","restore");this.fckEditorBasePath=new ORBEON.util.Property("fck-editor-base-path","/ops/fckeditor/");this.delayBeforeIncrementalRequest=new ORBEON.util.Property("delay-before-incremental-request",500);this.delayBeforeForceIncrementalRequest=new ORBEON.util.Property("delay-before-force-incremental-request",2000);this.delayBeforeGeckoCommunicationError=new ORBEON.util.Property("delay-before-gecko-communication-error",5000);this.delayBeforeCloseMinimalDialog=new ORBEON.util.Property("delay-before-close-minimal-dialog",5000);this.delayBeforeAjaxTimeout=new ORBEON.util.Property("delay-before-ajax-timeout",30000);this.internalShortDelay=new ORBEON.util.Property("internal-short-delay",100);this.delayBeforeDisplayLoading=new ORBEON.util.Property("delay-before-display-loading",500);this.debugWindowHeight=new ORBEON.util.Property("debug-window-height",600);this.debugWindowWidth=new ORBEON.util.Property("debug-window-width",300);this.loadingMinTopPadding=new ORBEON.util.Property("loading-min-top-padding",10);this.helpHandler=new ORBEON.util.Property("help-handler",false);this.helpTooltip=new ORBEON.util.Property("help-tooltip",false);this.offlineSupport=new ORBEON.util.Property("offline",false);this.formatInputTime=new ORBEON.util.Property("format.input.time","[h] =[m] =[s] [P]");this.formatInputDate=new ORBEON.util.Property("format.input.date","[M]/[D]/[Y]");this.datePicker=new ORBEON.util.Property("datepicker","yui");this.datePickerNavigator=new ORBEON.util.Property("datepicker.navigator",true);this.datePickerTwoMonths=new ORBEON.util.Property("datepicker.two-months",false);this.htmlEditor=new ORBEON.util.Property("htmleditor","yui");this.showErrorDialog=new ORBEON.util.Property("show-error-dialog",true);this.clientEventMode=new ORBEON.util.Property("client.events.mode","default");this.clientEventsFilter=new ORBEON.util.Property("client.events.filter","");this.resourcesVersioned=new ORBEON.util.Property("oxf.resources.versioned",false);this.resourcesVersionNumber=new ORBEON.util.Property("oxf.resources.version-number","");this.newXHTMLLayout=new ORBEON.util.Property("new-xhtml-layout",false);this.xhtmlLayout=new ORBEON.util.Property("xhtml-layout","nospan");this.retryDelayIncrement=new ORBEON.util.Property("retry.delay-increment",5000);this.retryMaxDelay=new ORBEON.util.Property("retry.max-delay",30000)}}};ORBEON.util.Properties.init();ORBEON.util.Utils={logMessage:function(a){if(typeof console!="undefined"){console.log(a)}},isNewXHTMLLayout:function(){return ORBEON.util.Properties.newXHTMLLayout.get()||ORBEON.util.Properties.xhtmlLayout.get()!="nospan"},hideModalProgressPanel:function(){if(ORBEON.xforms.Globals.modalProgressPanel){ORBEON.xforms.Globals.modalProgressPanel.hide();ORBEON.xforms.Globals.modalProgressPanel=null}},displayModalProgressPanel:function(a){if(!ORBEON.xforms.Globals.modalProgressPanel){ORBEON.xforms.Globals.modalProgressPanel=new YAHOO.widget.Panel("wait",{width:"60px",fixedcenter:true,close:false,draggable:false,zindex:4,modal:true,visible:true});ORBEON.xforms.Globals.modalProgressPanel.setBody('<img alt="Processing, please wait" src="'+ORBEON.xforms.Globals.resourcesBaseURL[a]+'/ops/images/xforms/processing.gif"/>');ORBEON.xforms.Globals.modalProgressPanel.render(document.body)}ORBEON.xforms.Globals.modalProgressPanel.show()},countOccurrences:function(c,b){var a=0;var d=c.indexOf(b);while(d!=-1){a++;d=c.indexOf(b,d+1)}return a},appendToEffectiveId:function(c,a){var b=ORBEON.util.Utils.getEffectiveIdNoSuffix(c);return b+a+ORBEON.util.Utils.getEffectiveIdSuffixWithSeparator(c)},getEffectiveIdNoSuffix:function(b){if(b==null){return null}var a=b.indexOf(XFORMS_SEPARATOR_1);if(a!=-1){return b.substring(0,a)}else{return b}},getEffectiveIdSuffixWithSeparator:function(b){if(b==null){return null}var a=b.indexOf(XFORMS_SEPARATOR_1);if(a!=-1){return b.substring(a)}else{return""}},getLocalName:function(a){if(a.nodeType==1){return a.tagName.indexOf(":")==-1?a.tagName:a.tagName.substr(a.tagName.indexOf(":")+1)}else{return null}},addSuffixToIdsAndRemoveDisabled:function(g,f,d){g.removeAttribute("disabled");var h=f;for(var j=0;j<d;j++){h+=XFORMS_SEPARATOR_2+"1"}if(g.id){g.id=ORBEON.util.Utils.appendRepeatSuffix(g.id,h);ORBEON.xforms.Globals.idToElement[g.id]=g}if(g.htmlFor){g.htmlFor=ORBEON.util.Utils.appendRepeatSuffix(g.htmlFor,h)}if(g.name){var k=ORBEON.util.Utils.appendRepeatSuffix(g.name,h);if(g.tagName.toLowerCase()=="input"&&g.type.toLowerCase()=="radio"&&ORBEON.xforms.Globals.isRenderingEngineTrident){var l=document.createElement("<"+g.tagName+" name='"+k+"'>");for(var b=0;b<g.attributes.length;b++){var c=g.attributes[b];if(c.nodeName.toLowerCase()!="name"&&c.nodeName.toLowerCase()!="height"&&c.nodeValue){l.setAttribute(c.nodeName,c.nodeValue)}}YAHOO.util.Event.addListener(l,"focus",ORBEON.xforms.Events.focus);YAHOO.util.Event.addListener(l,"blur",ORBEON.xforms.Events.blur);YAHOO.util.Event.addListener(l,"change",ORBEON.xforms.Events.change);g.replaceNode(l)}else{g.name=k}}for(var e=0;e<g.childNodes.length;e++){var a=g.childNodes[e];if(a.nodeType==ELEMENT_TYPE){if(a.id&&a.id.indexOf("repeat-end-")==0){d--}ORBEON.util.Utils.addSuffixToIdsAndRemoveDisabled(a,f,d);if(a.id&&a.id.indexOf("repeat-begin-")==0){d++}}}},getClassForRepeatId:function(b){var c=1;var a=b;while(true){a=ORBEON.xforms.Globals.repeatTreeChildToParent[a];if(a==null){break}c=(c==4)?1:c+1}return"xforms-repeat-selected-item-"+c},stringReplace:function(c,d,b){function a(h,k,g){switch(h.nodeType){case ELEMENT_TYPE:for(var f=0;f<h.attributes.length;f++){var j=new String(h.attributes[f].value).replace(k,g);if(j!=h.attributes[f].value){ORBEON.util.Dom.setAttribute(h,h.attributes[f].name,j)}}for(var f=0;f<h.childNodes.length;f++){a(h.childNodes[f],k,g)}break;case TEXT_TYPE:var j=new String(h.nodeValue).replace(k,g);if(j!=h.nodeValue){h.nodeValue=j}break}}d=d.replace(new RegExp("\\$","g"),"\\$");b=b.replace(new RegExp("\\$","g"),"$$$$");var e=new RegExp(d,"g");a(c,e,b)},appendRepeatSuffix:function(b,a){if(a==""){return b}if(a.charAt(0)==XFORMS_SEPARATOR_2){a=a.substring(1)}b+=b.indexOf(XFORMS_SEPARATOR_1)==-1?XFORMS_SEPARATOR_1:XFORMS_SEPARATOR_2;b+=a;return b},findRepeatDelimiter:function(k,f){var a="";var g=k;while(true){var h=ORBEON.xforms.Globals.repeatTreeChildToParent[g];if(h==null){break}var e=ORBEON.xforms.Globals.repeatTreeChildToParent[h];a=(e==null?XFORMS_SEPARATOR_1:XFORMS_SEPARATOR_2)+ORBEON.xforms.Globals.repeatIndexes[h]+a;g=h}var b="repeat-begin-"+k+a;var d=ORBEON.util.Dom.getElementById(b);if(!d){return null}var j=d;var c=0;while(true){while(j.nodeType!=ELEMENT_TYPE||!ORBEON.util.Dom.hasClass(j,"xforms-repeat-delimiter")){j=j.nextSibling;if(!j){return null}}c++;if(c==f){break}j=j.nextSibling}return j},fitsInViewport:function(e){var a=YAHOO.util.Dom.getDocumentScrollTop();var b=YAHOO.util.Dom.getDocumentScrollLeft();var d=a+YAHOO.util.Dom.getViewportHeight();var f=b+YAHOO.util.Dom.getViewportWidth();var g=new YAHOO.util.Region(a,f,d,b);var c=YAHOO.util.Dom.getRegion(e);return g.top<=c.top&&g.left<=c.left&&c.bottom<=g.bottom&&c.right<=g.right}};ORBEON.util.Test={executeWithInitialInstance:function(a,b){ORBEON.testing.executeCausingAjaxRequest(a,function(){ORBEON.xforms.Document.dispatchEvent("main-model","restore-instance")},function(){b.call(a)})},executeCausingAjaxRequest:function(a,b,d){function c(){if(ORBEON.xforms.Globals.requestInProgress||ORBEON.xforms.Globals.eventQueue.length>0){setTimeout(c,100)}else{a.resume(function(){d.call(a)})}}b.call(a);setTimeout(c,100);a.wait(20000)},startFirebugLite:function(){if(!window.firebug){var a=document.createElement("script");a.setAttribute("src","http://getfirebug.com/releases/lite/1.2/firebug-lite-compressed.js");document.body.appendChild(a);(function(){if(window.firebug){firebug.init()}else{setTimeout(arguments.callee)}})()}}};ORBEON.xforms.Document={dispatchEvent:function(k,g,b,f,c,h,e){if(b==null){for(var j=0;j<document.forms.length;j++){var d=document.forms[j];if(ORBEON.util.Dom.hasClass(d,"xforms-form")){b=d;break}}}var a=new ORBEON.xforms.Server.Event(b,k,null,null,g,f,c,e);ORBEON.xforms.Server.fireEvents([a],h==undefined?false:h)},getValue:function(a){var b=ORBEON.util.Dom.getElementById(a);return ORBEON.xforms.Controls.getCurrentValue(b)},setValue:function(c,e){var a=""+e;var d=ORBEON.util.Dom.getElementById(c);if(d==null){throw"ORBEON.xforms.Document.setValue: can't find control id '"+c+"'"}ORBEON.xforms.Controls.setCurrentValue(d,a);var b=new ORBEON.xforms.Server.Event(null,d.id,null,a,"xxforms-value-change-with-focus-change");ORBEON.xforms.Server.fireEvents([b],false)},isReloading:function(){return ORBEON.xforms.Globals.isReloading},getRepeatIndex:function(a){return ORBEON.xforms.Globals.repeatIndexes[a]},setOfflineEncryptionPassword:function(a){ORBEON.xforms.Offline.init();a=encode_utf8(a);if(a.length==1){a+=a}md5_init();for(var b=0;a<a.length;b+=2){md5_update(a.charCodeAt(b))}md5_finish();var d=byteArrayToHex(digestBits);md5_init();for(b=1;b<a.length;b+=2){md5_update(a.charCodeAt(b))}md5_finish();var e=byteArrayToHex(digestBits);a=d+e;a=a.substring(32);var c=ORBEON.xforms.Offline.gearsDatabase.execute("select * from Current_Password");if(c.isValidRow()){var f=c.fieldByName("encrypted_password");if(f!=a){throw"Invalid password"}}else{ORBEON.xforms.Offline.gearsDatabase.execute("insert into Current_Password (encrypted_password) values (?)",[a])}document.cookie="orbeon.forms.encryption.password="+a+"; path=/; secure";ORBEON.xforms.Offline.encryptionKey=null},changeOfflineEncryptionPassword:function(h,g){ORBEON.xforms.Offline.init();ORBEON.xforms.Document.setOfflineEncryptionPassword(h);var d=ORBEON.xforms.Offline.getEncryptionKey();ORBEON.xforms.Offline.gearsDatabase.execute("delete from Current_Password");ORBEON.xforms.Document.setOfflineEncryptionPassword(g);var f=ORBEON.xforms.Offline.getEncryptionKey();var b=ORBEON.xforms.Offline.gearsDatabase.execute("select url, event_response, offline_events from Offline_Forms");while(b.isValidRow()){var a=b.fieldByName("url");var c=b.fieldByName("event_response");var e=b.fieldByName("offline_events");c=ORBEON.xforms.Offline._decrypt(c,d);c=ORBEON.xforms.Offline._encrypt(c,f);e=ORBEON.xforms.Offline._decrypt(e,d);e=ORBEON.xforms.Offline._encrypt(e,f);ORBEON.xforms.Offline.gearsDatabase.execute("update Offline_Forms set event_response = ?, offline_events = ? where url= ?",[c,e,a]).close();b.next()}b.close()},isOfflineAvailable:function(){ORBEON.xforms.Offline.init();return ORBEON.xforms.Offline.hasGears},isFormOffline:function(b){ORBEON.xforms.Offline.init();var c=ORBEON.xforms.Offline.gearsDatabase.execute("select * from Offline_Forms where url = ?",[b]);var a=c.isValidRow();c.close();return a},getOfflineControlValues:function(a){var b=ORBEON.xforms.Offline.gearsDatabase.execute("select control_values from Offline_Forms where url = ?",[a]);if(!b.isValidRow()){return null}var c=b.fieldByName("control_values");c=ORBEON.xforms.Offline._deserializerControlValues(c);return c},takeOfflineFromSummary:function(d,c){ORBEON.xforms.Offline.init();var b=false;var a=window.setInterval(function(){if(b){window.clearInterval(a);ORBEON.xforms.Offline.loadFormInIframe(d,function(f){var e=window.setInterval(function(){if(!f.contentWindow.ORBEON.xforms.Offline.isOnline){window.clearInterval(e);if(c){c(f.contentWindow)}}},100);f.contentWindow.ORBEON.xforms.Document.dispatchEvent("#document","xxforms-offline")})}},100);ORBEON.xforms.Offline.formStore.capture(d,function(f,g,e){b=true})},takeOnlineFromSummary:function(b,c,a){ORBEON.xforms.Offline.init();ORBEON.xforms.Offline.loadFormInIframe(b,function(d){if(a){d.contentWindow.ORBEON.xforms.Events.ajaxResponseProcessedEvent.subscribe(function(){a(d.contentWindow)})}d.contentWindow.ORBEON.xforms.Offline.takeOnline(c)})},getFromClientState:function(e,d){var a=ORBEON.xforms.Globals.formClientState[e];var b=a.value.split("&");for(var c=0;c<b.length;c=c+2){if(b[c]==d){return unescape(b[c+1])}}return null},storeInClientState:function(g,d,f){var a=ORBEON.xforms.Globals.formClientState[g];var b=a.value==""?new Array():a.value.split("&");var e=false;for(var c=0;c<b.length;c=c+2){if(b[c]==d){b[c+1]=escape(f);e=true;break}}if(!e){b.push(d);b.push(escape(f))}a.value=b.join("&")}};ORBEON.xforms.Controls={isRelevant:function(a){return !ORBEON.util.Dom.hasClass(a,"xforms-disabled")&&!ORBEON.util.Dom.hasClass(a,"xforms-disabled-subsequent")},isReadonly:function(a){return ORBEON.util.Dom.hasClass(a,"xforms-readonly")},isRequired:function(a){return ORBEON.util.Dom.hasClass(a,"xforms-required")},isValid:function(a){return !ORBEON.util.Dom.hasClass(a,"xforms-invalid")},getForm:function(b){if(typeof b.form=="undefined"){var a=b;while(a.tagName.toLowerCase()!="form"){a=a.parentNode}return a}else{return b.form}},getCurrentValue:function(j){if(ORBEON.util.Dom.hasClass(j,"xforms-type-time")){var h=YAHOO.util.Dom.getElementsByClassName("xforms-input-input",null,j)[0].value;var t=ORBEON.util.DateTime.magicTimeToJSDate(h);return t==null?h:ORBEON.util.DateTime.jsDateToISOTime(t)}else{if(ORBEON.util.Dom.hasClass(j,"xforms-type-date")){var a;if(ORBEON.util.Dom.hasClass(j,"xforms-input-appearance-minimal")){var m=YAHOO.util.Dom.getElementsByClassName("xforms-input-appearance-minimal","img",j)[0];a=ORBEON.util.Dom.getAttribute(m,"alt")}else{a=YAHOO.util.Dom.getElementsByClassName("xforms-input-input",null,j)[0].value}var f=ORBEON.util.DateTime.magicDateToJSDate(a);return f==null?a:ORBEON.util.DateTime.jsDateToISODate(f)}else{if(ORBEON.util.Dom.hasClass(j,"xforms-type-dateTime")){var z=YAHOO.util.Dom.getElementsByClassName("xforms-type-date",null,j)[0].value;var b=ORBEON.util.DateTime.magicDateToJSDate(z);var k=YAHOO.util.Dom.getElementsByClassName("xforms-type-time",null,j)[0].value;var o=ORBEON.util.DateTime.magicTimeToJSDate(k);if(b==null||o==null){return z==""&&k==""?"":z+"T"+k}else{return ORBEON.util.DateTime.jsDateToISODateTime(b,o)}}else{if((ORBEON.util.Dom.hasClass(j,"xforms-input")&&!ORBEON.util.Dom.hasClass(j,"xforms-type-boolean")&&!ORBEON.util.Dom.hasClass(j,"xforms-static"))||ORBEON.util.Dom.hasClass(j,"xforms-secret")){var n=j.tagName.toLowerCase()=="input"?j:j.getElementsByTagName("input")[0];return n.value}else{if(ORBEON.util.Dom.hasClass(j,"xforms-select1-open")){return YAHOO.util.Dom.getElementsByClassName("xforms-select1-open-input",null,j)[0].value}else{if(ORBEON.util.Dom.hasClass(j,"xforms-select-appearance-full")||ORBEON.util.Dom.hasClass(j,"xforms-select1-appearance-full")||(ORBEON.util.Dom.hasClass(j,"xforms-input")&&ORBEON.util.Dom.hasClass(j,"xforms-type-boolean"))){var d=j.getElementsByTagName("input");var A="";for(var r=0;r<d.length;r++){var n=d[r];if(n.checked){if(A!=""){A+=" "}A+=n.value}}if(A==""&&ORBEON.util.Dom.hasClass(j,"xforms-input")&&ORBEON.util.Dom.hasClass(j,"xforms-type-boolean")){A="false"}return A}else{if(ORBEON.util.Dom.hasClass(j,"xforms-select-appearance-compact")||ORBEON.util.Dom.hasClass(j,"xforms-select1-appearance-minimal")||ORBEON.util.Dom.hasClass(j,"xforms-select1-appearance-compact")||ORBEON.util.Dom.hasClass(j,"xforms-input-appearance-minimal")||ORBEON.util.Dom.hasClass(j,"xforms-input-appearance-compact")){var e=ORBEON.util.Utils.isNewXHTMLLayout()?j.getElementsByTagName("select")[0].options:j.options;var B="";for(var g=0;g<e.length;g++){var p=e[g];if(p.selected){if(B!=""){B+=" "}B+=p.value}}return B}else{if(ORBEON.util.Dom.hasClass(j,"xforms-textarea")&&!ORBEON.util.Dom.hasClass(j,"xforms-mediatype-text-html")){var q=j.tagName.toLowerCase()=="textarea"?j:j.getElementsByTagName("textarea")[0];return q.value}else{if(ORBEON.util.Dom.hasClass(j,"xforms-textarea")&&ORBEON.util.Dom.hasClass(j,"xforms-mediatype-text-html")){if(ORBEON.util.Properties.htmlEditor.get()=="yui"){return ORBEON.widgets.RTE.getValue(j)}else{var y=FCKeditorAPI.GetInstance(j.name);return y.GetXHTML()}}else{if(ORBEON.util.Dom.hasClass(j,"xforms-output")||(ORBEON.util.Dom.hasClass(j,"xforms-input")&&ORBEON.util.Dom.hasClass(j,"xforms-static"))){if(ORBEON.util.Dom.hasClass(j,"xforms-mediatype-image")){var s=ORBEON.util.Dom.getChildElementByIndex(j,0);return s.src}else{if(ORBEON.util.Dom.hasClass(j,"xforms-output-appearance-xxforms-download")){return null}else{if(ORBEON.util.Dom.hasClass(j,"xforms-mediatype-text-html")){return j.innerHTML}else{var x=ORBEON.util.Utils.isNewXHTMLLayout()?j.getElementsByTagName("span")[0]:j;return ORBEON.util.Dom.getStringValue(x)}}}}else{if(ORBEON.util.Dom.hasClass(j,"xforms-select-appearance-xxforms-tree")||ORBEON.util.Dom.hasClass(j,"xforms-select1-appearance-xxforms-tree")){var u=ORBEON.util.Dom.hasClass(j,"xforms-select1-appearance-xxforms-tree");var c=ORBEON.xforms.Globals.treeYui[j.id];var l="";for(var w in c._nodes){var v=c._nodes[w];if(u){if(YAHOO.util.Dom.hasClass(v.getLabelEl(),"xforms-tree-label-selected")){return v.data.value}}else{if(v.checkState==2){if(l!=""){l+=" "}l+=v.data.value}}}return l}else{if(ORBEON.util.Dom.hasClass(j,"xforms-range")){return ORBEON.xforms.Globals.sliderYui[j.id].previousVal/200}}}}}}}}}}}}},setCurrentValue:function(y,K,t,r,q,p){var I=ORBEON.util.Dom.hasClass(y,"xforms-static");if(ORBEON.util.Dom.hasClass(y,"xforms-output-appearance-xxforms-download")){var d=ORBEON.util.Dom.getElementsByName(y,"a")[0];if(K==""){d.setAttribute("href","#");YAHOO.util.Dom.addClass(d,"xforms-readonly")}else{d.setAttribute("href",K);YAHOO.util.Dom.removeClass(d,"xforms-readonly")}}else{if(ORBEON.util.Dom.hasClass(y,"xforms-output")||I){if(ORBEON.util.Dom.hasClass(y,"xforms-mediatype-image")){var b=ORBEON.util.Utils.isNewXHTMLLayout()?YAHOO.util.Dom.getElementsByClassName("xforms-output-output",null,y)[0]:ORBEON.util.Dom.getChildElementByIndex(y,0);b.src=K}else{var A=ORBEON.util.Utils.isNewXHTMLLayout()?YAHOO.util.Dom.getElementsByClassName("xforms-output-output",null,y)[0]:y;if(ORBEON.util.Dom.hasClass(y,"xforms-mediatype-text-html")){A.innerHTML=K}else{ORBEON.util.Dom.setStringValue(A,K)}}}else{if(ORBEON.xforms.Globals.changedIdsRequest[y.id]!=null){}else{if(ORBEON.util.Dom.hasClass(y,"xforms-trigger")||ORBEON.util.Dom.hasClass(y,"xforms-submit")){}else{if(ORBEON.util.Dom.hasClass(y,"xforms-select1-open")){if(y.value!=K){y.value=K;y.getElementsByTagName("input")[0].value=K;y.previousValue=K}}else{if(ORBEON.util.Dom.hasClass(y,"xforms-type-time")){var E=y.getElementsByTagName("input")[0];var V=ORBEON.util.DateTime.magicTimeToJSDate(K);E.value=V==null?K:ORBEON.util.DateTime.jsDateToformatDisplayTime(V)}else{if(ORBEON.util.Dom.hasClass(y,"xforms-type-date")){var V=ORBEON.util.DateTime.magicDateToJSDate(K);var h=V==null?K:ORBEON.util.DateTime.jsDateToformatDisplayDate(V);if(ORBEON.util.Dom.hasClass(y,"xforms-input-appearance-minimal")){var z=y.getElementsByTagName("img")[0];ORBEON.util.Dom.setAttribute(z,"alt",h)}else{var E=y.getElementsByTagName("input")[0];E.value=h}}else{if(ORBEON.util.Dom.hasClass(y,"xforms-type-dateTime")){if(ORBEON.xforms.Controls.getCurrentValue(y)!=K){var T=K.indexOf("T");var v=K.substring(0,T);var R=ORBEON.util.DateTime.magicDateToJSDate(v);var H=y.getElementsByTagName("input")[0];H.value=R==null?v:ORBEON.util.DateTime.jsDateToformatDisplayDate(R);var S=K.substring(T+1);var s=ORBEON.util.DateTime.magicTimeToJSDate(S);var F=y.getElementsByTagName("input")[1];F.value=s==null?S:ORBEON.util.DateTime.jsDateToformatDisplayTime(s)}}else{if((ORBEON.util.Dom.hasClass(y,"xforms-input")&&!ORBEON.util.Dom.hasClass(y,"xforms-type-boolean"))||ORBEON.util.Dom.hasClass(y,"xforms-secret")){var a=y.tagName.toLowerCase()=="input"?y:y.getElementsByTagName("input")[0];if(y.value!=K){y.previousValue=K;y.valueSetByXForms++;y.value=K}if(a.value!=K){a.value=K}if(t!=null){if(t==""){a.removeAttribute("size")}else{a.size=t}}if(r!=null){if(r==""){a.removeAttribute("maxlength")}else{a.maxLength=r}}if(q!=null){if(r==""){a.removeAttribute("autocomplete")}else{a.autocomplete=q}}}else{if(ORBEON.util.Dom.hasClass(y,"xforms-select-appearance-full")||ORBEON.util.Dom.hasClass(y,"xforms-select1-appearance-full")||(ORBEON.util.Dom.hasClass(y,"xforms-input")&&ORBEON.util.Dom.hasClass(y,"xforms-type-boolean"))){var D=ORBEON.util.Dom.hasClass(y,"xforms-select-appearance-full")?K.split(" "):new Array(K);var J=y.getElementsByTagName("input");for(var j=0;j<J.length;j++){var o=J[j];o.checked=xformsArrayContains(D,o.value)}ORBEON.xforms.Controls._setRadioCheckboxClasses(y)}else{if(ORBEON.util.Dom.hasClass(y,"xforms-select-appearance-compact")||ORBEON.util.Dom.hasClass(y,"xforms-select1-appearance-compact")||ORBEON.util.Dom.hasClass(y,"xforms-select1-appearance-minimal")||ORBEON.util.Dom.hasClass(y,"xforms-input-appearance-compact")||ORBEON.util.Dom.hasClass(y,"xforms-input-appearance-minimal")){var D=ORBEON.util.Dom.hasClass(y,"xforms-select-appearance-compact")?K.split(" "):new Array(K);var O=ORBEON.util.Utils.isNewXHTMLLayout()?y.getElementsByTagName("select")[0]:y;var x=O.options;if(x!=null){for(var M=0;M<x.length;M++){var L=x[M];try{L.selected=xformsArrayContains(D,L.value)}catch(Q){}}}}else{if(ORBEON.util.Dom.hasClass(y,"xforms-textarea")&&!ORBEON.util.Dom.hasClass(y,"xforms-mediatype-text-html")){var f=y.tagName.toLowerCase()=="textarea"?y:y.getElementsByTagName("textarea")[0];f.value=K;if(r!=null){if(r==""){f.removeAttribute("cols")}else{f.cols=r}}if(q!=null){if(r==""){f.removeAttribute("rows")}else{f.rows=q}}if(ORBEON.util.Dom.hasClass(y,"xforms-textarea-appearance-xxforms-autosize")){ORBEON.xforms.Controls.autosizeTextarea(y)}}else{if(ORBEON.util.Dom.hasClass(y,"xforms-textarea")&&ORBEON.util.Dom.hasClass(y,"xforms-mediatype-text-html")){if(ORBEON.util.Properties.htmlEditor.get()=="yui"){ORBEON.widgets.RTE.setValue(y,K)}else{var m=FCKeditorAPI.GetInstance(y.name);m.EditorDocument.body.innerHTML=K;y.value=K;y.previousValue=K}}else{if(ORBEON.util.Dom.hasClass(y,"xforms-select-appearance-xxforms-tree")){var U=K.split(" ");var g=ORBEON.xforms.Globals.treeYui[y.id];for(var n in g._nodes){var G=g._nodes[n];if(G.children.length==0){var C=xformsArrayContains(U,G.data.value);if(C){G.check()}else{G.uncheck()}}}}else{if(ORBEON.util.Dom.hasClass(y,"xforms-select1-appearance-xxforms-tree")){var g=ORBEON.xforms.Globals.treeYui[y.id];ORBEON.xforms.Controls.treeOpenSelectedVisible(g,[K]);var k=ORBEON.xforms.Controls.getCurrentValue(y);var c=g.getNodeByProperty("value",k);var l=g.getNodeByProperty("value",K);if(c!=null){YAHOO.util.Dom.removeClass(c.getLabelEl(),"xforms-tree-label-selected")}if(l!=null){YAHOO.util.Dom.addClass(l.getLabelEl(),"xforms-tree-label-selected")}}else{if(ORBEON.util.Dom.hasClass(y,"xforms-upload")){var N=YAHOO.util.Dom.getElementsByClassName("xforms-upload-info",null,y)[0];var B=YAHOO.util.Dom.getElementsByClassName("xforms-upload-filename",null,y)[0];var u=YAHOO.util.Dom.getElementsByClassName("xforms-upload-mediatype",null,y)[0];var P=YAHOO.util.Dom.getElementsByClassName("xforms-upload-size",null,y)[0];if(t=="empty"){ORBEON.util.Dom.removeClass(y,"xforms-upload-state-file");ORBEON.util.Dom.addClass(y,"xforms-upload-state-empty")}if(t=="file"){ORBEON.util.Dom.removeClass(y,"xforms-upload-state-empty");ORBEON.util.Dom.addClass(y,"xforms-upload-state-file");ORBEON.util.Dom.clearUploadControl(y)}if(r!=null){ORBEON.util.Dom.setStringValue(B,r)}if(q!=null){ORBEON.util.Dom.setStringValue(u,q)}if(p!=null){var w=p>1024*1024?Math.round(p/(1024*1024)*10)/10+" MB":p>1024?Math.round(p/1024*10)/10+" KB":p+" B";ORBEON.util.Dom.setStringValue(P,w)}}else{if(typeof(y.value)=="string"){y.value=K;y.previousValue=K}}}}}}}}}}}}}}}}}},_setRadioCheckboxClasses:function(c){var b=c.getElementsByTagName("input");for(var d=0;d<b.length;d++){var a=b[d];var e=a.parentNode.parentNode;if(a.checked){ORBEON.util.Dom.addClass(e,"xforms-selected");ORBEON.util.Dom.removeClass(e,"xforms-deselected")}else{ORBEON.util.Dom.addClass(e,"xforms-deselected");ORBEON.util.Dom.removeClass(e,"xforms-selected")}}},_classNameToId:{label:"$$l",hint:"$$t",help:"$$p","help-image":"$$i",alert:"$$a"},_classNameToRegexp:{label:"\\$\\$l",hint:"\\$\\$t",help:"\\$\\$p","help-image":"\\$\\$i",alert:"\\$\\$a"},_getControlLHHA:function(b,d){if(ORBEON.util.Utils.isNewXHTMLLayout()){var a=YAHOO.util.Dom.getElementsByClassName("xforms-"+d,null,b);if(a.length>0){return a[0]}}var c=ORBEON.util.Utils.appendToEffectiveId(b.id,ORBEON.xforms.Controls._classNameToId[d]);return YAHOO.util.Dom.get(c)},getControlForLHHA:function(a,c){var b=ORBEON.xforms.Controls._classNameToId[c];return a.id.indexOf(b)!=-1?YAHOO.util.Dom.get(a.id.replace(new RegExp(ORBEON.xforms.Controls._classNameToRegexp[c],"g"),"")):a.parentNode},_setMessage:function(e,b,c){var d=ORBEON.xforms.Controls._getControlLHHA(e,b);if(d!=null){d.innerHTML=c;var a=ORBEON.xforms.Controls._getControlLHHA(e,"help-image");if(c==""){ORBEON.util.Dom.addClass(d,"xforms-disabled-subsequent");if(b=="xforms-help"){ORBEON.util.Dom.addClass(a,"xforms-disabled-subsequent")}}else{if(ORBEON.xforms.Controls.isRelevant(e)){ORBEON.util.Dom.removeClass(d,"xforms-disabled");ORBEON.util.Dom.removeClass(d,"xforms-disabled-subsequent");if(b=="xforms-help"){ORBEON.util.Dom.removeClass(a,"xforms-disabled");ORBEON.util.Dom.removeClass(a,"xforms-disabled-subsequent")}}}}},getLabelMessage:function(d){if(ORBEON.util.Dom.hasClass(d,"xforms-trigger")||ORBEON.util.Dom.hasClass(d,"xforms-submit")){if(d.tagName.toLowerCase()=="input"){return d.alt}else{return d.innerHTML}}else{if(ORBEON.util.Dom.hasClass(d,"xforms-dialog")){var c=ORBEON.util.Dom.getChildElementByIndex(d,0);return c.innerHTML}else{if(ORBEON.util.Dom.hasClass(d,"xforms-group-appearance-xxforms-fieldset")){var b=ORBEON.util.Dom.getChildElementByIndex(d,0);if(b!=null){return b.innerHTML}}else{var a=ORBEON.xforms.Controls._getControlLHHA(d,"label");return a.innerHTML}}}},setLabelMessage:function(f,c){if(ORBEON.util.Dom.hasClass(f,"xforms-trigger")||ORBEON.util.Dom.hasClass(f,"xforms-submit")){var d=ORBEON.util.Utils.isNewXHTMLLayout()?YAHOO.util.Dom.getFirstChild(f):f;if(d.tagName.toLowerCase()=="input"){d.alt=c}else{d.innerHTML=c}}else{if(ORBEON.util.Dom.hasClass(f,"xforms-dialog")){var e=ORBEON.util.Dom.getChildElementByIndex(f,0);e.innerHTML=c}else{if(ORBEON.util.Dom.hasClass(f,"xforms-group-appearance-xxforms-fieldset")){var b=ORBEON.util.Dom.getChildElementByIndex(f,0);if(b!=null){b.innerHTML=c}}else{if(ORBEON.util.Dom.hasClass(f,"xforms-output-appearance-xxforms-download")){var a=YAHOO.util.Dom.getChildren(f)[0];a.innerHTML=c}else{ORBEON.xforms.Controls._setMessage(f,"label",c)}}}}},getHelpMessage:function(b){var a=ORBEON.xforms.Controls._getControlLHHA(b,"help");return a==null?"":ORBEON.util.Dom.getStringValue(a)},setHelpMessage:function(c,b){b=ORBEON.util.String.escapeHTMLMinimal(b);ORBEON.xforms.Controls._setMessage(c,"help",b);ORBEON.xforms.Controls._setTooltipMessage(c,b,ORBEON.xforms.Globals.helpTooltipForControl);var a=ORBEON.xforms.Controls._getControlLHHA(c,"help-image");ORBEON.util.Dom.removeClass(a,"xforms-disabled")},setValid:function(e,c){var d;var a=ORBEON.util.Dom.hasClass(e,"xforms-visited");if(c!=null){d=c!="false";if(d){ORBEON.util.Dom.removeClass(e,"xforms-invalid");ORBEON.util.Dom.removeClass(e,"xforms-invalid-visited")}else{ORBEON.util.Dom.addClass(e,"xforms-invalid");if(a){ORBEON.util.Dom.addClass(e,"xforms-invalid-visited")}}}else{d=ORBEON.xforms.Controls.isValid(e)}var b=ORBEON.xforms.Controls._getControlLHHA(e,"alert");if(b!=null){if(d){ORBEON.util.Dom.removeClass(b,"xforms-alert-active");ORBEON.util.Dom.removeClass(b,"xforms-alert-active-visited");ORBEON.util.Dom.addClass(b,"xforms-alert-inactive")}else{ORBEON.util.Dom.removeClass(b,"xforms-alert-inactive");ORBEON.util.Dom.addClass(b,"xforms-alert-active");if(a){ORBEON.util.Dom.addClass(b,"xforms-alert-active-visited")}}}var f=ORBEON.xforms.Globals.alertTooltipForControl[e.id];if(c&&f!=null){if(f!=true){f.destroy()}ORBEON.xforms.Globals.alertTooltipForControl[e.id]=null}},setDisabledOnFormElement:function(a,b){if(b){a.setAttribute("disabled","disabled")}else{a.removeAttribute("disabled")}},setRelevant:function(g,c){if(ORBEON.util.Dom.hasClass(g,"xforms-group-begin-end")){var k=false;if(c){var f=0;var j=g;while(true){j=YAHOO.util.Dom.getPreviousSibling(j);if(j==null){break}if(YAHOO.util.Dom.hasClass(j,"xforms-group-begin-end")){if(j.id.indexOf("group-end")==0){f++}if(j.id.indexOf("group-begin")==0){f--;if(f<0&&YAHOO.util.Dom.hasClass(j,"xforms-disabled")){k=true;break}}}}}if(c){ORBEON.util.Dom.removeClass(g,"xforms-disabled")}else{ORBEON.util.Dom.addClass(g,"xforms-disabled")}if(!(c&&k)){var f=1;var h=0;var j=g;while(true){j=YAHOO.util.Dom.getNextSibling(j);if(j==null){break}if(YAHOO.util.Dom.hasClass(j,"xforms-group-begin-end")){if(j.id.indexOf("group-begin")==0){f++;if(YAHOO.util.Dom.hasClass(j,"xforms-disabled")||h>0){h++}}else{if(j.id.indexOf("group-end")==0){f--;if(f==0){break}if(h>0){h--}}}}else{if(c&&h==0){ORBEON.util.Dom.removeClass(j,"xforms-disabled");ORBEON.util.Dom.removeClass(j,"xforms-disabled-subsequent");ORBEON.util.Dom.nudgeAferDelay(j)}if(!c){ORBEON.util.Dom.addClass(j,"xforms-disabled-subsequent")}}}}}else{var a=[g,ORBEON.xforms.Controls._getControlLHHA(g,"label"),ORBEON.xforms.Controls._getControlLHHA(g,"alert")];if(!c||(c&&ORBEON.xforms.Controls.getHelpMessage(g)!="")){a.push(ORBEON.xforms.Controls._getControlLHHA(g,"help"));a.push(ORBEON.xforms.Controls._getControlLHHA(g,"help-image"))}if(!c||(c&&ORBEON.xforms.Controls.getHintMessage(g)!="")){a.push(ORBEON.xforms.Controls._getControlLHHA(g,"hint"))}for(var b=0;b<a.length;b++){var e=a[b];if(e!=null){if(c){ORBEON.util.Dom.removeClass(e,"xforms-disabled");ORBEON.util.Dom.removeClass(e,"xforms-disabled-subsequent");ORBEON.util.Dom.nudgeAferDelay(e)}else{ORBEON.util.Dom.addClass(e,"xforms-disabled-subsequent")}}}var d=!c||ORBEON.xforms.Controls.isReadonly(g);function l(n){var m=n.tagName.toLowerCase();if(m=="input"||m=="textarea"||m=="select"||m=="button"){ORBEON.xforms.Controls.setDisabledOnFormElement(n,d)}return false}l(g);YAHOO.util.Dom.getElementsBy(l,null,g)}},setRepeatIterationRelevance:function(b,c,a){var d=ORBEON.util.Utils.findRepeatDelimiter(b,c).nextSibling;while(!(d.nodeType==ELEMENT_TYPE&&(ORBEON.util.Dom.hasClass(d,"xforms-repeat-delimiter")||ORBEON.util.Dom.hasClass(d,"xforms-repeat-begin-end")))){if(d.nodeType==ELEMENT_TYPE){if(a){ORBEON.util.Dom.removeClass(d,"xforms-disabled");ORBEON.util.Dom.removeClass(d,"xforms-disabled-subsequent")}else{ORBEON.util.Dom.addClass(d,"xforms-disabled-subsequent")}}d=d.nextSibling}},setReadonly:function(b,a){if(a){ORBEON.util.Dom.addClass(b,"xforms-readonly")}else{ORBEON.util.Dom.removeClass(b,"xforms-readonly")}if(ORBEON.util.Dom.hasClass(b,"xforms-group-begin-end")){if(a){ORBEON.util.Dom.addClass(b,"xforms-readonly")}else{ORBEON.util.Dom.removeClass(b,"xforms-readonly")}}else{if((ORBEON.util.Dom.hasClass(b,"xforms-input"))||ORBEON.util.Dom.hasClass(b,"xforms-secret")||ORBEON.util.Dom.hasClass(b,"xforms-select1-appearance-full")||ORBEON.util.Dom.hasClass(b,"xforms-select-appearance-full")){if(a){ORBEON.util.Dom.addClass(b,"xforms-readonly")}else{ORBEON.util.Dom.removeClass(b,"xforms-readonly")}var e=b.getElementsByTagName("input");for(var j=0;j<e.length;j++){var f=e[j];ORBEON.xforms.Controls.setDisabledOnFormElement(f,a)}if(b.tagName.toLowerCase()=="input"){ORBEON.xforms.Controls.setDisabledOnFormElement(b,a)}}else{if(ORBEON.util.Dom.hasClass(b,"xforms-select-appearance-compact")||ORBEON.util.Dom.hasClass(b,"xforms-select1-appearance-minimal")||ORBEON.util.Dom.hasClass(b,"xforms-select1-appearance-compact")||ORBEON.util.Dom.hasClass(b,"xforms-input-appearance-minimal")||ORBEON.util.Dom.hasClass(b,"xforms-input-appearance-compact")){var g=ORBEON.util.Utils.isNewXHTMLLayout()?b.getElementsByTagName("select")[0]:b;ORBEON.xforms.Controls.setDisabledOnFormElement(g,a)}else{if(ORBEON.util.Dom.hasClass(b,"xforms-output")||ORBEON.util.Dom.hasClass(b,"xforms-group")){if(a){ORBEON.util.Dom.addClass(b,"xforms-readonly")}else{ORBEON.util.Dom.removeClass(b,"xforms-readonly")}}else{if(ORBEON.util.Dom.hasClass(b,"xforms-select1-appearance-xxforms-autocomplete")){var f=ORBEON.util.Dom.getChildElementByIndex(b,0);ORBEON.xforms.Controls.setDisabledOnFormElement(f,a)}else{if(ORBEON.util.Dom.hasClass(b,"xforms-textarea")&&ORBEON.util.Dom.hasClass(b,"xforms-mediatype-text-html")){if(ORBEON.util.Properties.htmlEditor.get()=="yui"){ORBEON.widgets.RTE.setReadonly(b,a)}else{var d=FCKeditorAPI.GetInstance(b.name);if(a){d.ToolbarSet.Collapse()}else{d.ToolbarSet.Expand()}}}else{if(ORBEON.util.Dom.hasClass(b,"xforms-upload")){ORBEON.xforms.Controls.setDisabledOnFormElement(ORBEON.util.Dom.getChildElementByClass(b,"xforms-upload-select"),a)}else{if(ORBEON.util.Dom.hasClass(b,"xforms-textarea")){var h=ORBEON.util.Utils.isNewXHTMLLayout()?b.getElementsByTagName("textarea")[0]:b;ORBEON.xforms.Controls.setDisabledOnFormElement(h,a)}else{if((ORBEON.util.Dom.hasClass(b,"xforms-trigger")&&!ORBEON.util.Dom.hasClass(b,"xforms-trigger-appearance-minimal"))||ORBEON.util.Dom.hasClass(b,"xforms-submit")){var c=ORBEON.util.Dom.getElementByTagName(b,"button");ORBEON.xforms.Controls.setDisabledOnFormElement(c,a)}else{if(ORBEON.util.Dom.hasClass(b,"xforms-trigger-appearance-minimal")){if(a){ORBEON.util.Dom.addClass(b,"xforms-trigger-readonly")}else{ORBEON.util.Dom.removeClass(b,"xforms-trigger-readonly")}}}}}}}}}}}},getAlertMessage:function(b){var a=ORBEON.xforms.Controls._getControlLHHA(b,"alert");return a.innerHTML},setAlertMessage:function(b,a){ORBEON.xforms.Controls._setMessage(b,"alert",a);ORBEON.xforms.Controls._setTooltipMessage(b,a,ORBEON.xforms.Globals.alertTooltipForControl)},getHintMessage:function(c){if(ORBEON.util.Dom.hasClass(c,"xforms-trigger")||ORBEON.util.Dom.hasClass(c,"xforms-submit")){var b=ORBEON.util.Dom.getElementByTagName(c,["a","button"]);return b.title}else{var a=ORBEON.xforms.Controls._getControlLHHA(c,"hint");return a==null?"":a.innerHTML}},setHintMessage:function(c,b){if(ORBEON.util.Dom.hasClass(c,"xforms-trigger")||ORBEON.util.Dom.hasClass(c,"xforms-submit")){if(ORBEON.xforms.Globals.hintTooltipForControl[c.id]==null){var a=ORBEON.util.Dom.getElementByTagName(c,["a","button"]);a.title=b}}else{ORBEON.xforms.Controls._setMessage(c,"hint",b)}ORBEON.xforms.Controls._setTooltipMessage(c,b,ORBEON.xforms.Globals.hintTooltipForControl)},_setTooltipMessage:function(c,b,d){var a=d[c.id];if(a){if(a==true){if(b!=""){d[c.id]=null}}else{if(b==""){a.cfg.setProperty("disabled",true)}else{a.cfg.setProperty("text",b);a.cfg.setProperty("disabled",false)}}}},setFocus:function(h){var d=ORBEON.util.Dom.getElementById(h);ORBEON.xforms.Globals.currentFocusControlId=h;ORBEON.xforms.Globals.currentFocusControlElement=d;ORBEON.xforms.Globals.maskFocusEvents=true;if(ORBEON.util.Dom.hasClass(d,"xforms-select-appearance-full")||ORBEON.util.Dom.hasClass(d,"xforms-select1-appearance-full")||(ORBEON.util.Dom.hasClass(d,"xforms-input")&&ORBEON.util.Dom.hasClass(d,"xforms-type-boolean"))){var b=ORBEON.util.Dom.getElementsByName(d,"input");if(b.length>0){var a=0;var e=false;for(;a<b.length;a++){var j=b[a];if(j&&j.checked){e=true;break}}b[e?a:0].focus()}}else{if(ORBEON.util.Dom.hasClass(d,"xforms-textarea")&&ORBEON.util.Dom.hasClass(d,"xforms-mediatype-text-html")){if(ORBEON.util.Properties.htmlEditor.get()=="yui"){ORBEON.widgets.RTE.setFocus(d)}else{}}else{var g=["input","textarea","select","button","a"];var c=ORBEON.util.Dom.getElementByTagName(d,g);if(c!=null&&!ORBEON.util.Dom.isAncestorOrSelfHidden(c)){c.focus()}}}if(typeof ORBEON.xforms.Globals.serverValue[h]=="undefined"){var f=ORBEON.xforms.Controls.getCurrentValue(d);ORBEON.xforms.Globals.serverValue[h]=f}},updateInvalidVisitedOnNextAjaxResponse:function(a){if(!ORBEON.util.Dom.hasClass(a,"xforms-visited")){ORBEON.xforms.Events.runOnNext(ORBEON.xforms.Events.ajaxResponseProcessedEvent,function(){if(ORBEON.util.Dom.hasClass(a,"xforms-invalid")){ORBEON.util.Dom.addClass(a,"xforms-invalid-visited")}var b=ORBEON.xforms.Controls._getControlLHHA(a,"alert");if(b!=null&&ORBEON.util.Dom.hasClass(b,"xforms-alert-active")){ORBEON.util.Dom.addClass(b,"xforms-alert-active-visited")}})}},updateRequiredEmpty:function(b,a){if(ORBEON.util.Dom.hasClass(b,"xforms-required")){if(a==""){ORBEON.util.Dom.addClass(b,"xforms-required-empty");ORBEON.util.Dom.removeClass(b,"xforms-required-filled");return true}else{ORBEON.util.Dom.addClass(b,"xforms-required-filled");ORBEON.util.Dom.removeClass(b,"xforms-required-empty");return false}}else{ORBEON.util.Dom.removeClass(b,"xforms-required-filled");ORBEON.util.Dom.removeClass(b,"xforms-required-empty");return false}},autosizeTextarea:function(a){if(a.tagName.toLowerCase()!="textarea"){a=a.getElementsByTagName("textarea")[0]}var d=a.scrollHeight;var b=a.clientHeight;if(a.rows==-1){a.rows=2}if(ORBEON.xforms.Globals.isFF3OrNewer){a.style.height=0;d=a.scrollHeight;a.style.height=null}var e=b/a.rows;var c=0;if(d>b){while(d>=b){a.rows=a.rows+1;if(a.clientHeight<=b){break}b=a.clientHeight;c++}}else{if(d<b){while(a.rows>XFORMS_WIDE_TEXTAREA_MIN_ROWS&&d<b-e){a.rows=a.rows-1;if(a.clientHeight>=b){break}b=a.clientHeight;c--}}}},updateHTMLAreaClasses:function(a){var b=a.previousSibling;while(b.nodeType!=ORBEON.util.Dom.ELEMENT_TYPE){b=a.previousSibling}b.className=a.className},updateLoadingPosition:function(f){var a;var e=ORBEON.xforms.Globals.formLoadingLoadingInitialRightTop[f][0];var g=document.documentElement.scrollLeft||document.body.scrollLeft;a=g+YAHOO.util.Dom.getViewportWidth()-e;var h;var d=document.documentElement.scrollTop||document.body.scrollTop;var c=ORBEON.xforms.Globals.formLoadingLoadingInitialRightTop[f][1];h=d+ORBEON.util.Properties.loadingMinTopPadding.get()>c?d+ORBEON.util.Properties.loadingMinTopPadding.get():c;var b=ORBEON.xforms.Globals.formLoadingLoadingOverlay[f];b.cfg.setProperty("x",a);b.cfg.setProperty("y",h)},treeOpenSelectedVisible:function(d,b){for(var e in d._nodes){var c=d._nodes[e];if(xformsArrayContains(b,c.data.value)){var a=c.parent;while(a!=null){a.expand();a=a.parent}}}},showHelp:function(k){var d=ORBEON.xforms.Controls.getForm(k);if(ORBEON.xforms.Globals.formHelpPanel[d.id]==null){for(var q=0;q<d.childNodes.length;q++){var a=d.childNodes[q];if(ORBEON.util.Dom.isElement(a)&&ORBEON.util.Dom.hasClass(a,"xforms-help-panel")){YAHOO.util.Dom.generateId(a);ORBEON.util.Dom.removeClass(a,"xforms-initially-hidden");var t=new YAHOO.widget.Panel(a.id,{modal:false,fixedcenter:false,underlay:"shadow",visible:false,constraintoviewport:true,draggable:true,effect:{effect:YAHOO.widget.ContainerEffect.FADE,duration:0.3}});t.render();t.element.style.display="none";ORBEON.xforms.Globals.formHelpPanel[d.id]=t;var j=ORBEON.util.Dom.getChildElementByClass(a,"bd");ORBEON.xforms.Globals.formHelpPanelMessageDiv[d.id]=YAHOO.util.Dom.getElementsByClassName("xforms-help-panel-message",null,j)[0];var s=YAHOO.util.Dom.getElementsByClassName("xforms-help-panel-close",null,j)[0];var c=ORBEON.util.Dom.getChildElementByIndex(s,0);ORBEON.xforms.Globals.formHelpPanelCloseButton[d.id]=c;YAHOO.util.Event.addListener(c,"click",ORBEON.xforms.Events.helpDialogButtonClose,d.id);t.beforeHideEvent.subscribe(ORBEON.xforms.Events.helpDialogXClose,d.id);break}}}ORBEON.xforms.Globals.formHelpPanelMessageDiv[d.id].innerHTML=ORBEON.xforms.Controls.getHelpMessage(k);var e=YAHOO.util.Dom.getRegion(ORBEON.xforms.Globals.formHelpPanel[d.id].element);var f;if(e.top==null){f=true}else{var r=YAHOO.util.Dom.getViewportWidth();var l=YAHOO.util.Dom.getViewportHeight();var p=document.body.scrollLeft;var o=document.body.scrollTop;var m=e.top>=o&&e.bottom<=o+l;var h=e.left>=p&&e.right<=p+r;f=!m||!h}if(f){var n=ORBEON.util.Utils.isNewXHTMLLayout()?k:k.parentNode;var b=ORBEON.util.Dom.getChildElementByClass(n,"xforms-help-image");ORBEON.xforms.Globals.formHelpPanel[d.id].element.style.display="block";ORBEON.xforms.Globals.formHelpPanel[d.id].cfg.setProperty("context",[b,"bl","tl"]);ORBEON.xforms.Globals.formHelpPanel[d.id].show();ORBEON.xforms.Globals.formHelpPanel[d.id].cfg.setProperty("zIndex",ORBEON.xforms.Globals.lastDialogZIndex++)}var g=ORBEON.xforms.Globals.formHelpPanelMessageDiv[d.id].parentNode;if(g.scrollHeight<=g.clientHeight){ORBEON.xforms.Globals.formHelpPanelCloseButton[d.id].focus()}},showDialog:function(c,d){var a=ORBEON.util.Dom.getElementById(c);var b=ORBEON.xforms.Globals.dialogs[c];if(ORBEON.xforms.Globals.currentFocusControlId!=null){var e=ORBEON.util.Dom.getElementById(ORBEON.xforms.Globals.currentFocusControlId);if(e!=null){e.blur()}}if(YAHOO.util.Dom.hasClass(a,"xforms-initially-hidden")){ORBEON.util.Dom.removeClass(a,"xforms-initially-hidden");b.render()}ORBEON.util.Dom.addClass(b.innerElement,"yui-module");ORBEON.util.Dom.addClass(b.innerElement,"yui-overlay");ORBEON.util.Dom.addClass(b.innerElement,"yui-panel");b.element.style.display="block";b.show();b.cfg.setProperty("zIndex",ORBEON.xforms.Globals.lastDialogZIndex++);if(d==null){b.center()}else{b.cfg.setProperty("context",[d,"tl","bl"]);b.align()}},getWidget:function(b){for(var c in ORBEON.widgets){var a=ORBEON.widgets[c];if(a.extending!=null&&a.appliesToControl(b)){return a}}},deleteControl:function(a){ORBEON.xforms.Globals.serverValue[a.id]=null;ORBEON.xforms.Globals.hintTooltipForControl[a.id]=null;ORBEON.xforms.Globals.alertTooltipForControl[a.id]=null;ORBEON.xforms.Globals.helpTooltipForControl[a.id]=null;ORBEON.xforms.Globals.dialogs[a.id]=null;ORBEON.xforms.Globals.dialogMinimalLastMouseOut[a.id]=null}};ORBEON.xforms.Events={_findParentXFormsControl:function(c){while(true){if(!c){return null}if(c.xformsElement){return c.xformsElement}else{if(c.ownerDocument&&c.ownerDocument.xformsElement){return c.ownerDocument.xformsElement}else{if(c.tagName!=null&&c.tagName.toLowerCase()=="iframe"){for(var a in ORBEON.xforms.Globals.dialogs){var b=ORBEON.xforms.Globals.dialogs[a];if(b.iframe==c){return b.element}}}else{if(c.className!=null){if(c.id&&ORBEON.util.String.endsWith(c.id,"_container")&&ORBEON.util.Dom.hasClass(c,"xforms-textarea")&&ORBEON.util.Dom.hasClass(c,"xforms-mediatype-text-html")&&ORBEON.util.Properties.htmlEditor.get()=="yui"){return ORBEON.util.Dom.getChildElementByClass(c,"xforms-textarea")}else{if(ORBEON.util.Dom.hasClass(c,"xforms-control")){return c.id==""?null:c}else{if(ORBEON.util.Dom.hasClass(c,"xforms-dialog")||ORBEON.util.Dom.hasClass(c,"xforms-help-image")||ORBEON.util.Dom.hasClass(c,"xforms-alert")){return c}}}}}}}c=c.parentNode}},focus:function(b){var h=YAHOO.util.Event.getTarget(b);if(YAHOO.lang.isUndefined(document.addEventListener)){YAHOO.util.Dom.generateId(h);var j=ORBEON.xforms.Globals.changeListeners[h.id];var f=YAHOO.lang.isUndefined(j)||j!=h;if(f){YAHOO.util.Event.addListener(h,"change",ORBEON.xforms.Events.change);ORBEON.xforms.Globals.changeListeners[h.id]=h}}if(!ORBEON.xforms.Globals.maskFocusEvents){var c=ORBEON.xforms.Events._findParentXFormsControl(h);var g=ORBEON.xforms.Globals.currentFocusControlId!=null?ORBEON.util.Dom.getElementByIdNoCache(ORBEON.xforms.Globals.currentFocusControlId):null;if(c!=null){if(typeof ORBEON.xforms.Globals.serverValue[c.id]=="undefined"&&!ORBEON.util.Dom.hasClass(c,"xforms-select-appearance-compact")){var d=ORBEON.xforms.Controls.getCurrentValue(c);ORBEON.xforms.Globals.serverValue[c.id]=d}}var k=new Array();if(c!=null&&g!=c&&!ORBEON.util.Dom.hasClass(c,"xforms-dialog")){ORBEON.widgets.RTE.focusOnAnyFormControl(c);var e=false;if(g!=null){if(ORBEON.util.Dom.hasClass(g,"xforms-textarea")&&ORBEON.util.Dom.hasClass(g,"xforms-mediatype-text-html")&&ORBEON.util.Properties.htmlEditor.get()=="fck"){var a=FCKeditorAPI.GetInstance(g.name);g.value=a.GetXHTML();e=true}else{if(ORBEON.util.Dom.hasClass(g,"xforms-select1-appearance-xxforms-tree")||ORBEON.util.Dom.hasClass(g,"xforms-select-appearance-xxforms-tree")){e=true}}if(e){xformsValueChanged(g,null)}k.push(new ORBEON.xforms.Server.Event(null,g.id,null,null,"DOMFocusOut"))}k.push(new ORBEON.xforms.Server.Event(null,c.id,null,null,"DOMFocusIn"));ORBEON.xforms.Globals.currentFocusControlId=c.id;ORBEON.xforms.Globals.currentFocusControlElement=c;ORBEON.xforms.Server.fireEvents(k,true)}}else{ORBEON.xforms.Globals.maskFocusEvents=false}},blur:function(b){if(!ORBEON.xforms.Globals.maskFocusEvents){var a=ORBEON.xforms.Events._findParentXFormsControl(YAHOO.util.Event.getTarget(b));if(a!=null){ORBEON.xforms.Controls.updateInvalidVisitedOnNextAjaxResponse(a);if(!ORBEON.util.Dom.hasClass(a,"xforms-dialog")){ORBEON.xforms.Globals.currentFocusControlId=a.id;ORBEON.xforms.Globals.currentFocusControlElement=a}if(ORBEON.widgets.YUICalendar.appliesToControl(a)){ORBEON.widgets.YUICalendar.blur(b,a)}}}},change:function(f){var g=ORBEON.xforms.Events._findParentXFormsControl(YAHOO.util.Event.getTarget(f));if(g!=null){ORBEON.xforms.Controls.updateInvalidVisitedOnNextAjaxResponse(g);if(ORBEON.util.Dom.hasClass(g,"xforms-upload")){var f=new ORBEON.xforms.Server.Event(null,g.id,null,null,"xforms-select");ORBEON.xforms.Server.fireEvents([f],false)}else{if(ORBEON.xforms.Globals.changedIdsRequest[g.id]!=null){ORBEON.xforms.Globals.changedIdsRequest[g.id]=0}if(ORBEON.util.Dom.hasClass(g,"xforms-select1-appearance-compact")){var a=ORBEON.util.Utils.isNewXHTMLLayout()?YAHOO.util.Dom.getElementsByClassName("","select",g)[0]:g;if(a.value==""){a.options[0].selected=true}else{var h=false;for(var e=0;e<a.options.length;e++){var d=a.options[e];if(d.selected){if(h){d.selected=false}else{h=true}}}}}else{if(ORBEON.util.Dom.hasClass(g,"xforms-type-time")||(ORBEON.util.Dom.hasClass(g,"xforms-type-date")&&!ORBEON.util.Dom.hasClass(g,"xforms-input-appearance-minimal"))||ORBEON.util.Dom.hasClass(g,"xforms-type-dateTime")){function c(k,j,m){var l=j(k.value);if(l!=null){k.value=m(l)}}c(YAHOO.util.Dom.getElementsByClassName("xforms-input-input",null,g)[0],ORBEON.util.Dom.hasClass(g,"xforms-type-time")?ORBEON.util.DateTime.magicTimeToJSDate:ORBEON.util.DateTime.magicDateToJSDate,ORBEON.util.Dom.hasClass(g,"xforms-type-time")?ORBEON.util.DateTime.jsDateToformatDisplayTime:ORBEON.util.DateTime.jsDateToformatDisplayDate);if(ORBEON.util.Dom.hasClass(g,"xforms-type-dateTime")){c(YAHOO.util.Dom.getElementsByClassName("xforms-input-input",null,g)[1],ORBEON.util.DateTime.magicTimeToJSDate,ORBEON.util.DateTime.jsDateToformatDisplayTime)}}}var b=ORBEON.xforms.Controls.getCurrentValue(g);var f=new ORBEON.xforms.Server.Event(null,g.id,null,b,"xxforms-value-change-with-focus-change");ORBEON.xforms.Server.fireEvents([f],false)}}},_isChangingKey:function(b,a){return;!YAHOO.lang.isUndefined(a)&&a!=9&&a!=16&&a!=17&&a!=18&&(ORBEON.util.Dom.hasClass(b,"xforms-input")||ORBEON.util.Dom.hasClass(b,"xforms-secret")||ORBEON.util.Dom.hasClass(b,"xforms-textarea"))},keydown:function(a){var b=ORBEON.xforms.Events._findParentXFormsControl(YAHOO.util.Event.getTarget(a));if(b!=null){if(ORBEON.xforms.Events._isChangingKey(b,a.keyCode)){ORBEON.xforms.Globals.changedIdsRequest[b.id]=ORBEON.xforms.Globals.changedIdsRequest[b.id]==null?1:ORBEON.xforms.Globals.changedIdsRequest[b.id]+1}if(ORBEON.widgets.JSCalendar.appliesToControl(b)){ORBEON.widgets.JSCalendar.keydown(a,b)}else{if(ORBEON.widgets.YUICalendar.appliesToControl(b)){ORBEON.widgets.YUICalendar.keydown(a,b)}}}},keypress:function(b){var c=ORBEON.xforms.Events._findParentXFormsControl(YAHOO.util.Event.getTarget(b));if(c!=null){if(ORBEON.util.Dom.hasClass(c,"xforms-select1-open")||(ORBEON.util.Dom.hasClass(c,"xforms-input")&&!ORBEON.util.Dom.hasClass(c,"xforms-type-boolean"))||ORBEON.util.Dom.hasClass(c,"xforms-secret")){if(b.keyCode==10||b.keyCode==13){YAHOO.util.Event.preventDefault(b);var a=[new ORBEON.xforms.Server.Event(null,c.id,null,ORBEON.xforms.Controls.getCurrentValue(c),"xxforms-value-change-with-focus-change"),new ORBEON.xforms.Server.Event(null,c.id,null,null,"DOMActivate")];ORBEON.xforms.Server.fireEvents(a,false)}}}},keyup:function(a){var b=ORBEON.xforms.Events._findParentXFormsControl(YAHOO.util.Event.getTarget(a));if(b!=null){if(ORBEON.util.Dom.hasClass(b,"xforms-select1-open")){ORBEON.xforms.Globals.autoCompleteLastKeyCode[b.id]=a.keyCode}if(ORBEON.xforms.Events._isChangingKey(b,a.keyCode)){ORBEON.xforms.Globals.changedIdsRequest[b.id]--}if(ORBEON.util.Dom.hasClass(b,"xforms-incremental")){var a=new ORBEON.xforms.Server.Event(null,b.id,null,ORBEON.xforms.Controls.getCurrentValue(b),"xxforms-value-change-with-focus-change");ORBEON.xforms.Server.fireEvents([a],false)}if(ORBEON.util.Dom.hasClass(b,"xforms-textarea-appearance-xxforms-autosize")){ORBEON.xforms.Controls.autosizeTextarea(b)}}},resize:function(c){for(var b=0;b<ORBEON.xforms.Globals.autosizeTextareas.length;b++){var a=ORBEON.xforms.Globals.autosizeTextareas[b];ORBEON.xforms.Controls.autosizeTextarea(a)}},_showToolTip:function(c,e,g,d,h,f,a){if(YAHOO.lang.isObject(c[e.id])){if(!YAHOO.util.Dom.inDocument(c[e.id].orbeonControl,document)){c[e.id].destroy();c[e.id]=null}}if(c[e.id]==null){if(h!=""){var j=new YAHOO.widget.Tooltip(e.id+d,{context:g.id,text:h,showDelay:f,effect:{effect:YAHOO.widget.ContainerEffect.FADE,duration:0.2},zIndex:1000});j.orbeonControl=e;var b=ORBEON.util.Dom.getElementById(g.id);j.onContextMouseMove.call(b,a,j);j.onContextMouseOver.call(b,a,j);c[e.id]=j}else{c[e.id]=true}}},mouseover:function(d){var g=ORBEON.xforms.Events._findParentXFormsControl(YAHOO.util.Event.getTarget(d));if(g!=null){if(!ORBEON.util.Dom.hasClass(document.body,"xforms-disable-hint-as-tooltip")){var c=ORBEON.xforms.Controls.getHintMessage(g);if(YAHOO.util.Dom.hasClass(g,"xforms-trigger")||ORBEON.util.Dom.hasClass(g,"xforms-submit")){var b=ORBEON.util.Dom.getElementByTagName(g,["a","button"]);b.title=""}ORBEON.xforms.Events._showToolTip(ORBEON.xforms.Globals.hintTooltipForControl,g,g,"-orbeon-hint-tooltip",c,200,d)}if(ORBEON.util.Dom.hasClass(g,"xforms-alert-active")&&!ORBEON.util.Dom.hasClass(document.body,"xforms-disable-alert-as-tooltip")){var f=ORBEON.xforms.Controls.getControlForLHHA(g,"alert");if(f){if(!(YAHOO.util.Dom.hasClass(f,"xforms-control")||YAHOO.util.Dom.hasClass(f,"xforms-group"))){f=YAHOO.util.Dom.getAncestorByClassName(f,"xforms-control")}if(f){var c=ORBEON.xforms.Controls.getAlertMessage(f);YAHOO.util.Dom.generateId(g);ORBEON.xforms.Events._showToolTip(ORBEON.xforms.Globals.alertTooltipForControl,f,g,"-orbeon-alert-tooltip",c,10,d)}}}else{if(ORBEON.util.Dom.hasClass(g,"xforms-dialog-appearance-minimal")){ORBEON.xforms.Globals.dialogMinimalLastMouseOut[g.id]=-1}}if(ORBEON.util.Properties.helpTooltip.get()&&ORBEON.util.Dom.hasClass(g,"xforms-help-image")){var a=g.nextSibling;if(!ORBEON.util.Dom.isElement(a)){a=a.nextSibling}var f=ORBEON.xforms.Controls.getControlForLHHA(g,"help-image");if(f){if(YAHOO.util.Dom.hasClass(f,"xforms-input-input")){f=YAHOO.util.Dom.getAncestorByClassName(f,"xforms-control")}var c=ORBEON.xforms.Controls.getHelpMessage(f);YAHOO.util.Dom.generateId(g);ORBEON.xforms.Events._showToolTip(ORBEON.xforms.Globals.helpTooltipForControl,f,g,"-orbeon-help-tooltip",c,0,d)}}var e=g;while(e!=null&&e!=document){if(ORBEON.util.Dom.hasClass(e,"xforms-dialog-appearance-minimal")){ORBEON.xforms.Globals.dialogMinimalLastMouseOut[e.id]=-1;break}e=e.parentNode}}},mouseout:function(b){var c=ORBEON.xforms.Events._findParentXFormsControl(YAHOO.util.Event.getTarget(b));if(c!=null){var a=ORBEON.xforms.Globals.hintTooltipForControl[c.id];if(!ORBEON.util.Dom.hasClass(document.body,"xforms-disable-hint-as-tooltip")&&YAHOO.lang.isObject(a)){a.onContextMouseOut.call(c.id,b,a)}}},click:function(m){if(m.button!=0&&m.button!=1){return}ORBEON.xforms.Events.clickEvent.fire(m);var b=YAHOO.util.Event.getTarget(m);if(YAHOO.lang.isObject(b)&&YAHOO.lang.isBoolean(b.disabled)&&b.disabled){return}var r=ORBEON.xforms.Events._findParentXFormsControl(b);if(r!=null&&ORBEON.util.Dom.hasClass(r,"xforms-output")){ORBEON.xforms.Events.focus(m)}else{if(r!=null&&(ORBEON.util.Dom.hasClass(r,"xforms-trigger")||ORBEON.util.Dom.hasClass(r,"xforms-submit"))){YAHOO.util.Event.preventDefault(m);if(ORBEON.util.Dom.hasClass(r,"xxforms-offline-save")){ORBEON.xforms.Offline.storeEvents(ORBEON.xforms.Offline.memoryOfflineEvents);ORBEON.xforms.Offline.memoryOfflineEvents=[]}if(ORBEON.util.Dom.hasClass(r,"xxforms-online")){ORBEON.xforms.Offline.takeOnline()}if(!ORBEON.util.Dom.hasClass(r,"xforms-readonly")){ORBEON.xforms.Events.focus(m);var m=new ORBEON.xforms.Server.Event(null,r.id,null,null,"DOMActivate");ORBEON.xforms.Server.fireEvents([m],false);if(ORBEON.util.Dom.hasClass(r,"xforms-trigger-appearance-modal")){r.blur();ORBEON.util.Utils.displayModalProgressPanel(ORBEON.xforms.Controls.getForm(r).id)}}}else{if(r!=null&&(ORBEON.util.Dom.hasClass(r,"xforms-select1-appearance-full")||ORBEON.util.Dom.hasClass(r,"xforms-select-appearance-full")||(ORBEON.util.Dom.hasClass(r,"xforms-input")&&ORBEON.util.Dom.hasClass(r,"xforms-type-boolean")))){ORBEON.xforms.Controls._setRadioCheckboxClasses(r);var m=new ORBEON.xforms.Server.Event(null,r.id,null,ORBEON.xforms.Controls.getCurrentValue(r),"xxforms-value-change-with-focus-change");ORBEON.xforms.Server.fireEvents([m],false)}else{if(r!=null&&ORBEON.util.Dom.hasClass(b,"xforms-type-date")){if(ORBEON.util.Properties.datePicker.get()=="jscalendar"){ORBEON.widgets.JSCalendar.click(m,r)}else{ORBEON.widgets.YUICalendar.click(m,r)}}else{if(r!=null&&ORBEON.util.Dom.hasClass(r,"xforms-upload")&&ORBEON.util.Dom.hasClass(b,"xforms-upload-remove")){var m=new ORBEON.xforms.Server.Event(null,r.id,null,"","xxforms-value-change-with-focus-change");ORBEON.xforms.Server.fireEvents([m],false)}else{if(r!=null&&ORBEON.util.Dom.hasClass(r,"xforms-select1-appearance-xxforms-menu")){var h=[];var t=b;while(true){if(t.tagName.toLowerCase()=="li"){var e=0;while(true){var k=t.previousSibling;if(k==null){break}t=k;if(t.nodeType==ELEMENT_TYPE&&t.tagName.toLowerCase()=="li"){e++}}h.push(e)}else{if(t.tagName.toLowerCase()=="div"&&ORBEON.util.Dom.hasClass(t,"yuimenubar")){break}}t=t.parentNode}h=h.reverse();var n=ORBEON.xforms.Globals.menuItemsets[r.id];var q=0;for(var a=0;a<h.length;a++){var s=h[a];n=n[s+q];q=3}var f=n[1];var m=new ORBEON.xforms.Server.Event(null,r.id,null,f,"xxforms-value-change-with-focus-change");ORBEON.xforms.Server.fireEvents([m],false);ORBEON.xforms.Globals.menuYui[r.id].clearActiveItem()}else{if(r!=null&&ORBEON.util.Dom.hasClass(r,"xforms-help-image")){var j=ORBEON.xforms.Controls.getControlForLHHA(r,"help-image");if(ORBEON.util.Properties.helpHandler.get()){var m=new ORBEON.xforms.Server.Event(null,j.id,null,null,"xforms-help");ORBEON.xforms.Server.fireEvents([m],false)}else{ORBEON.xforms.Controls.showHelp(j)}}else{var l=b;while(l!=null&&!(ORBEON.util.Dom.isElement(l)&&l.tagName.toLowerCase()=="form")){var p=0;var g=false;var o=l;while(o!=null){if(ORBEON.util.Dom.isElement(o)){if(o.id.indexOf("repeat-begin-")==0){var c=ORBEON.xforms.Controls.getForm(o);var d=o.id.substring("repeat-begin-".length);d+=d.indexOf(XFORMS_SEPARATOR_1)==-1?XFORMS_SEPARATOR_1:XFORMS_SEPARATOR_2;d+=p;var m=new ORBEON.xforms.Server.Event(c,d,null,null,"DOMFocusIn");ORBEON.xforms.Server.fireEvents([m]);g=true;break}else{if(ORBEON.util.Dom.hasClass(o,"xforms-repeat-delimiter")){p++}}}o=o.previousSibling}if(g){break}l=l.parentNode}}}}}}}}},_resize:function(){var b=[ORBEON.xforms.Globals.hintTooltipForControl,ORBEON.xforms.Globals.helpTooltipForControl,ORBEON.xforms.Globals.alertTooltipForControl];for(var a=0;a<3;a++){var e=b[a];for(var d in e){var c=e[d];if(c!=null&&c!=true){if(YAHOO.lang.isObject(c.element)&&c.element.style.visibility=="hidden"){c.element.style.top=0;c.element.style.left=0}}}}},scrollOrResize:function(){for(var b in ORBEON.xforms.Globals.formLoadingLoadingOverlay){var a=ORBEON.xforms.Globals.formLoadingLoadingOverlay[b];if(a){ORBEON.xforms.Controls.updateLoadingPosition(b)}}ORBEON.xforms.Events._resize()},sliderValueChange:function(c){var d=ORBEON.util.Dom.getElementById(this.id);if(ORBEON.util.Utils.isNewXHTMLLayout()){d=d.parentNode}var b=c/200;var a=new ORBEON.xforms.Server.Event(null,d.id,null,String(b),"xxforms-value-change-with-focus-change");ORBEON.xforms.Server.fireEvents([a],false)},menuClick:function(a,e,b){var f=b.menu;var d=b.value;var c=new ORBEON.xforms.Server.Event(null,f.id,null,d,"xxforms-value-change-with-focus-change");ORBEON.xforms.Server.fireEvents([c],false)},dialogClose:function(d,b,f){if(!ORBEON.xforms.Globals.maskDialogCloseEvents){var a=f;var c=ORBEON.util.Dom.getElementById(a);var e=new ORBEON.xforms.Server.Event(null,c.id,null,null,"xxforms-dialog-close");ORBEON.xforms.Server.fireEvents([e],false)}},dialogShow:function(d,b,e){if(ORBEON.xforms.Globals.isRenderingEngineTrident){var a=e;var c=ORBEON.util.Dom.getElementById(a);c.className=c.className}},helpDialogButtonClose:function(a,b){var c=ORBEON.xforms.Globals.formHelpPanel[b];c.hide()},helpDialogXClose:function(b,a,c){var d=ORBEON.xforms.Globals.formHelpPanel[c];d.element.style.display="none"},treeClickFocus:function(c){var b=ORBEON.util.Dom.hasClass(c,"xforms-incremental");if(ORBEON.xforms.Globals.currentFocusControlId!=c.id){var a={target:c};ORBEON.xforms.Events.focus(a)}ORBEON.xforms.Globals.currentFocusControlId=c.id;ORBEON.xforms.Globals.currentFocusControlElement=c},treeClickValueUpdated:function(b){if(ORBEON.util.Dom.hasClass(b,"xforms-incremental")){var a=new ORBEON.xforms.Server.Event(null,b.id,null,ORBEON.xforms.Controls.getCurrentValue(b),"xxforms-value-change-with-focus-change");ORBEON.xforms.Server.fireEvents([a],false)}},treeCheckClick:function(){var a=this.tree;var c=ORBEON.util.Dom.getElementById(a.id);ORBEON.xforms.Events.treeClickFocus(c);c.value="";for(var d in a._nodes){var b=a._nodes[d];if(b.checkState==2){if(c.value!=""){c.value+=" "}c.value+=b.data.value}}ORBEON.xforms.Events.treeClickValueUpdated(c)},treeLabelClick:function(a){var d=!YAHOO.lang.isUndefined(a._type)&&(a._type=="TextNode"||a._type=="TaskNode")?a:a.node;var e=this;var g=document.getElementById(e.id);if(ORBEON.util.Utils.isNewXHTMLLayout()){g=g.parentNode}var b=ORBEON.util.Dom.hasClass(g,"xforms-select");if(b){if(d.checked){d.uncheck()}else{d.check()}d.onCheckClick()}else{var c=ORBEON.xforms.Controls.getCurrentValue(g);var f=e.getNodeByProperty("value",c);if(f!=null){YAHOO.util.Dom.removeClass(f.getLabelEl(),"xforms-tree-label-selected")}if(d!=null){YAHOO.util.Dom.addClass(d.getLabelEl(),"xforms-tree-label-selected")}ORBEON.xforms.Events.treeClickFocus(g);g.value=d.data.value;ORBEON.xforms.Events.treeClickValueUpdated(g)}},errorShowHideDetails:function(){var b=this.parentNode.parentNode.parentNode;var a=ORBEON.util.Dom.getChildElementByClass(b,"xforms-error-panel-details-hidden");var c=ORBEON.util.Dom.getChildElementByClass(b,"xforms-error-panel-details-shown");if(this.className=="xforms-error-panel-show-details"){ORBEON.util.Dom.addClass(a,"xforms-disabled-subsequent");ORBEON.util.Dom.removeClass(c,"xforms-disabled");ORBEON.util.Dom.removeClass(c,"xforms-disabled-subsequent")}else{ORBEON.util.Dom.removeClass(a,"xforms-disabled");ORBEON.util.Dom.removeClass(a,"xforms-disabled-subsequent");ORBEON.util.Dom.addClass(c,"xforms-disabled-subsequent")}},errorPanelClosed:function(e,c,g){var d=ORBEON.xforms.Globals.formErrorPanel[g];var b=d.errorDetailsDiv.parentNode.parentNode;var a=ORBEON.util.Dom.getChildElementByClass(b,"xforms-error-panel-details-hidden");var f=ORBEON.util.Dom.getChildElementByClass(b,"xforms-error-panel-details-shown");ORBEON.util.Dom.removeClass(a,"xforms-disabled");ORBEON.util.Dom.removeClass(a,"xforms-disabled-subsequent");ORBEON.util.Dom.addClass(f,"xforms-disabled-subsequent")},errorCloseClicked:function(b,a){a.hide()},errorReloadClicked:function(b,a){ORBEON.xforms.Globals.isReloading=true;window.location.reload(true)},dialogMinimalBodyClick:function(a,b){if(b.element.style.display=="block"){var c=YAHOO.util.Event.getTarget(a);var d=false;while(c!=null&&c!=document){if(ORBEON.util.Dom.hasClass(c,"xforms-dialog-appearance-minimal")){d=true;break}c=c.parentNode}if(!d){var a=new ORBEON.xforms.Server.Event(null,b.id,null,null,"xxforms-dialog-close");ORBEON.xforms.Server.fireEvents([a],false)}}},dialogMinimalCheckMouseIn:function(b){var c=new Date().getTime();if(b.element.style.display=="block"&&ORBEON.xforms.Globals.dialogMinimalLastMouseOut[b.element.id]!=-1&&c-ORBEON.xforms.Globals.dialogMinimalLastMouseOut[b.element.id]>=ORBEON.util.Properties.delayBeforeCloseMinimalDialog.get()){var a=new ORBEON.xforms.Server.Event(null,b.element.id,null,null,"xxforms-dialog-close");ORBEON.xforms.Server.fireEvents([a],false)}},sendHeartBeatIfNeeded:function(g){var f=new Date().getTime();if((f-ORBEON.xforms.Globals.lastEventSentTime)>=g){var b=ORBEON.util.Dom.getElementById("xforms-heartbeat");if(b==null){var e;for(var a=0;a<document.forms.length;a++){var d=document.forms[a];if(ORBEON.util.Dom.hasClass(d,"xforms-form")){e=d;break}}var b=document.createElement("div");b.className="xforms-heartbeat";b.id="xforms-heartbeat";e.appendChild(b)}var c=new ORBEON.xforms.Server.Event(null,b.id,null,null,"xxforms-session-heartbeat");ORBEON.xforms.Server.fireEvents([c],false)}},runOnNext:function(a,b,c,e){function d(){a.unsubscribe(d);if(e){b.call(c)}else{b(c)}}a.subscribe(d)},orbeonLoadedEvent:new YAHOO.util.CustomEvent("orbeonLoaded"),ajaxResponseProcessedEvent:new YAHOO.util.CustomEvent("ajaxResponseProcessed"),clickEvent:new YAHOO.util.CustomEvent("clickEvent"),errorEvent:new YAHOO.util.CustomEvent("errorEvent"),yuiCalendarCreated:new YAHOO.util.CustomEvent("yuiCalendarCreated")};ORBEON.xforms.action={Message:{_messageQueue:[],_messageDialog:null,clinit:function(){YAHOO.util.Event.onDOMReady(function(){YAHOO.widget.SimpleDialog.prototype.registerForm=function(){};this._messageDialog=new YAHOO.widget.SimpleDialog("xforms-message-dialog",{width:"30em",fixedcenter:true,modal:true,close:false,visible:false,draggable:false,buttons:[{text:"Close",handler:{fn:function(){this._messageDialog.hide();this._messageQueue.shift();if(this._messageQueue.length>0){this._showMessage()}},scope:this},isDefault:false}]});this._messageDialog.setHeader("Message");this._messageDialog.render(document.body);var b=YAHOO.util.Dom.get("xforms-message-dialog");var a=YAHOO.util.Dom.getElementsByClassName("bd",null,b)[0];a.setAttribute("aria-live","polite");a.setAttribute("role","alert")},this,true)},_showMessage:function(){this._messageDialog.setBody(this._messageQueue[0]);this._messageDialog.show()},execute:function(a){var b=ORBEON.util.Dom.getStringValue(a);if(ORBEON.util.Dom.getAttribute(a,"level")=="modal"){this._messageQueue.push(b);if(this._messageQueue.length==1){this._showMessage()}}}}};ORBEON.xforms.action.Message.clinit();ORBEON.xforms.XBL={_BaseClass:function(){var a=function(){};a.prototype={container:null}}(),declareClass:function(b,a){var d=null;var c=false;b.instance=function(j){var h=!YAHOO.lang.isUndefined(b.prototype.init);var g=j==null||!YAHOO.util.Dom.inDocument(j,document)?null:(YAHOO.util.Dom.hasClass(j,a)?j:YAHOO.util.Dom.getAncestorByClassName(j,a));if(!c){c=true;if(h){var k=this.prototype.init;this.prototype.init=function(){if(!this.initialized){k.call(this);this.initialized=true}}}var f=this.prototype.destroy;this.prototype.destroy=function(){if(!YAHOO.lang.isUndefined(f)){f.call(this)}b._instances[this.container.id]=null}}if(g==null){if(d==null){d={};for(methodName in b.prototype){d[methodName]=function(){}}}return d}else{if(YAHOO.lang.isUndefined(this._instances)){this._instances={}}var e=this._instances[g.id];if(YAHOO.lang.isUndefined(e)||YAHOO.lang.isNull(e)||e.container!=g){e=new b(g);e.container=g;if(h){e.initialized=false;e.init()}this._instances[g.id]=e}return e}}}};ORBEON.widgets.Base=function(){return{extending:null,appliesToControl:function(a){},click:function(a,b){},blur:function(a,b){},keydown:function(a,b){}}}();ORBEON.widgets.JSCalendar=function(){function a(g){if(ORBEON.util.Dom.hasClass(g.activeDiv,"day")){var d;if(!YAHOO.lang.isNull(g.params.inputField)){var b=g.params.inputField;var c=ORBEON.util.DateTime.magicDateToJSDate(b.value);b.value=ORBEON.util.DateTime.jsDateToformatDisplayDate(c);d=b.parentNode}else{var e=g.params.imageField;e.alt=ORBEON.util.DateTime.jsDateToformatDisplayDate(g.date);d=e.parentNode}var f=new ORBEON.xforms.Server.Event(null,d.id,null,ORBEON.xforms.Controls.getCurrentValue(d),"xxforms-value-change-with-focus-change");ORBEON.xforms.Server.fireEvents([f],false)}}return{extending:ORBEON.widgets.Base,appliesToControl:function(b){return(ORBEON.util.Dom.hasClass(b,"xforms-type-date")||ORBEON.util.Dom.hasClass(b,"xforms-type-dateTime"))&&ORBEON.util.Properties.datePicker.get()=="jscalendar"},click:function(d,e){var g=ORBEON.util.Dom.getChildElementByIndex(e,0);var b={imageField:g,ifFormat:"%m/%d/%Y",showsTime:false,button:e.id,singleClick:true,step:1,onUpdate:a,electric:false};if(ORBEON.util.Dom.hasClass(g,"xforms-input-appearance-minimal")){b.imageField=g;var f=ORBEON.util.Dom.getAttribute(g,"alt");b.date=f}else{b.inputField=g}Calendar.setup(b);var c=e.onclick;e.onclick=null;c()},blur:function(b,c){},keydown:function(b,c){calendar.hide()}}}();ORBEON.widgets.YUICalendar=function(){var h={en:{properties:{MONTHS_LONG:["January","February","March","April","May","June","July","August","September","October","November","December"],WEEKDAYS_SHORT:["Su","Mo","Tu","We","Th","Fr","Sa"],START_WEEKDAY:0},navigator:{month:"Month",year:"Year",submit:"OK",cancel:"Cancel",invalidYear:"Year needs to be a number"}},fr:{properties:{MONTHS_LONG:["Janvier","F\xe9vrier","Mars","Avril","Mai","Juin","Juillet","Ao\xfbt","Septembre","Octobre","Novembre","D\xe9cembre"],WEEKDAYS_SHORT:["Di","Lu","Ma","Me","Je","Ve","Sa"],START_WEEKDAY:1},navigator:{month:"Moi",year:"Ann\xe9e",submit:"OK",cancel:"Annuler",invalidYear:"L'ann\xe9e est invalide"}},es:{properties:{MONTHS_LONG:["Enero","Febrero","Marzo","Abril","Mayo","Junio","Julio","Agosto","Septiembre","Octubre","Noviembre","Diciembre"],WEEKDAYS_SHORT:["Do","Lu","Ma","Mi","Ju","Vi","S\xe1"],START_WEEKDAY:1},navigator:{month:"Mes",year:"A\xf1o",submit:"OK",cancel:"Aancelar",invalidYear:"A\xf1o debe ser un n\xfamero"}},nl:{properties:{MONTHS_LONG:["Januari","Februari","Maart","April","Mei","Juni","Juli","Augustus","September","Oktober","November","December"],WEEKDAYS_SHORT:["Zo","Ma","Di","Wo","Do","Vr","Za"],START_WEEKDAY:1},navigator:{month:"Maand",year:"Jaar",submit:"OK",cancel:"Annuleren",invalidYear:"Jaar dient een getal te zijn"}}};var a=null;var n=null;var d=null;var f=null;var b=null;var e=false;function m(){e=true}function g(){e=false}function l(){YAHOO.util.Event.addListener(n,"mouseover",m);YAHOO.util.Event.addListener(n,"mouseout",g)}function j(){var o=a.getSelectedDates()[0];b.value=ORBEON.util.DateTime.jsDateToformatDisplayDate(o);if(ORBEON.util.Dom.hasClass(f,"xforms-input-appearance-minimal")){b.alt=b.value}var p=new ORBEON.xforms.Server.Event(null,f.id,null,ORBEON.xforms.Controls.getCurrentValue(f),"xxforms-value-change-with-focus-change");ORBEON.xforms.Server.fireEvents([p],false);k()}function k(){f=null;b=null;e=false;d.cfg.setProperty("visible",false);ORBEON.xforms.Events.clickEvent.unsubscribe(c)}function c(q,s){var r=s[0];var p=YAHOO.util.Event.getTarget(r);var o=YAHOO.util.Dom.getAncestorByClassName(p,"yui-calcontainer");if(YAHOO.lang.isNull(o)){k()}}return{extending:ORBEON.widgets.Base,appliesToControl:function(o){return(ORBEON.util.Dom.hasClass(o,"xforms-type-date")||ORBEON.util.Dom.hasClass(o,"xforms-type-dateTime"))&&ORBEON.util.Properties.datePicker.get()=="yui"},click:function(p,y){if(n==null){n=ORBEON.util.Dom.getElementById("orbeon-calendar-div");if(n==null){n=document.createElement("div");n.id="orbeon-calendar-div";document.body.appendChild(n)}d=new YAHOO.widget.Overlay(n,{constraintoviewport:true});d.setBody("");d.render(document.body)}YAHOO.util.Dom.setStyle(n,"z-index",ORBEON.xforms.Globals.lastDialogZIndex++);if(a==null){var v=ORBEON.util.Properties.datePickerTwoMonths.get();var D=YAHOO.util.Dom.generateId(YAHOO.util.Dom.getElementsByClassName("bd",null,n)[0]);a=v?new YAHOO.widget.CalendarGroup(D):new YAHOO.widget.Calendar(D);a.renderEvent.subscribe(l,a,true);a.selectEvent.subscribe(j,a,true);window.yuiCalendar=a;a.renderEvent.subscribe(function(){var E=YAHOO.util.Dom.getElementsByClassName("calnavleft",null,n)[0];var G=document.createElement("a");G.innerHTML="Previous Year";G.href="#";YAHOO.util.Dom.addClass(G,"calyearleft");YAHOO.util.Dom.insertBefore(G,E);YAHOO.util.Event.addListener(G,"click",function(I){YAHOO.util.Event.preventDefault(I);setTimeout(function(){a.previousYear();var J=YAHOO.util.Dom.getElementsByClassName("calyearleft","a",n);if(J&&J[0]){J[0].focus()}},0)});var H=YAHOO.util.Dom.getElementsByClassName("calnavright",null,n)[0];var F=document.createElement("a");F.innerHTML="Next Year";F.href="#";YAHOO.util.Dom.addClass(F,"calyearright");YAHOO.util.Dom.insertBefore(F,H);YAHOO.util.Event.addListener(F,"click",function(I){YAHOO.util.Event.preventDefault(I);setTimeout(function(){a.nextYear();var J=YAHOO.util.Dom.getElementsByClassName("calyearright","a",n);if(J&&J[0]){J[0].focus()}},0)})})}var q=ORBEON.util.Dom.getAttribute(document.documentElement,"lang");if(q==null||q==""){q="en"}q=q.substring(0,2);var t=h[q];for(var C in t.properties){a.cfg.setProperty(C,t.properties[C])}var A=ORBEON.util.Properties.datePickerNavigator.get();if(A){a.cfg.setProperty("navigator",{strings:t.navigator,monthFormat:YAHOO.widget.Calendar.SHORT,initialFocus:"year"})}ORBEON.xforms.Events.clickEvent.subscribe(c);f=y;var u=ORBEON.util.DateTime.magicDateToJSDate(ORBEON.xforms.Controls.getCurrentValue(f));if(u==null){a.cfg.setProperty("selected","",false)}else{var o=(u.getMonth()+1)+"/"+u.getDate()+"/"+u.getFullYear();a.cfg.setProperty("selected",o,false)}var w=YAHOO.util.Dom.getAncestorByClassName(f,"xbl-fr-date");var B=w!=null;var s=B?YAHOO.util.Dom.getElementsByClassName("xbl-fr-date-mindate",null,w)[0]:null;a.cfg.setProperty("mindate",s==null?null:ORBEON.util.DateTime.magicDateToJSDate(ORBEON.xforms.Controls.getCurrentValue(s)));var x=B?YAHOO.util.Dom.getElementsByClassName("xbl-fr-date-maxdate",null,w)[0]:null;a.cfg.setProperty("maxdate",x==null?null:ORBEON.util.DateTime.magicDateToJSDate(ORBEON.xforms.Controls.getCurrentValue(x)));var z=B?YAHOO.util.Dom.getElementsByClassName("xbl-fr-date-pagedate",null,w)[0]:null;var r=z==null?null:ORBEON.util.DateTime.magicDateToJSDate(ORBEON.xforms.Controls.getCurrentValue(z));a.cfg.setProperty("pagedate",r==null?(u==null?new Date():u):r);ORBEON.xforms.Events.yuiCalendarCreated.fire({yuiCalendar:a,control:f});a.cfg.applyConfig();a.render();b=YAHOO.util.Dom.getElementsByClassName("xforms-input-input",null,y)[0];d.cfg.setProperty("constraintoviewport",false);d.cfg.setProperty("context",[b.id,YAHOO.widget.Overlay.TOP_LEFT,YAHOO.widget.Overlay.BOTTOM_LEFT]);if(!ORBEON.util.Utils.fitsInViewport(d.element)){d.cfg.setProperty("context",[b.id,YAHOO.widget.Overlay.BOTTOM_LEFT,YAHOO.widget.Overlay.TOP_LEFT]);if(!ORBEON.util.Utils.fitsInViewport(d.element)){d.cfg.setProperty("constraintoviewport",true);d.cfg.setProperty("context",[b.id,YAHOO.widget.Overlay.TOP_LEFT,YAHOO.widget.Overlay.TOP_RIGHT])}}d.cfg.setProperty("visible",true)},blur:function(o,p){if(!e){k()}},keydown:function(o,p){k()}}}();ORBEON.widgets.RTE=function(){rteEditors={};isIncremental={};editorWithFocus=null;renderedCustomEvents={};function b(e){var d=new ORBEON.xforms.Server.Event(null,e,null,ORBEON.widgets.RTE.getValue(ORBEON.util.Dom.getElementById(e)),"xxforms-value-change-with-focus-change");ORBEON.xforms.Server.fireEvents([d],true)}function a(e){var d=ORBEON.xforms.Globals.currentFocusControlId;if(d!=e){if(rteEditors[d]!=null){ORBEON.xforms.Events.blur({target:ORBEON.util.Dom.getElementById(d)})}ORBEON.xforms.Events.focus({target:ORBEON.util.Dom.getElementById(e)})}ORBEON.xforms.Events.keydown({target:ORBEON.util.Dom.getElementById(d)});ORBEON.xforms.Events.keyup({target:ORBEON.util.Dom.getElementById(d)})}var c={extending:ORBEON.widgets.Base,init:function(g){var h;if(typeof YUI_RTE_CUSTOM_CONFIG!="undefined"){h=YUI_RTE_CUSTOM_CONFIG}else{h={toolbar:{collapse:true,titlebar:false,draggable:false,buttonType:"advanced",buttons:[{group:"fontstyle",label:"Font Name and Size",buttons:[{type:"select",label:"Arial",value:"fontname",disabled:true,menu:[{text:"Arial",checked:true},{text:"Arial Black"},{text:"Comic Sans MS"},{text:"Courier New"},{text:"Lucida Console"},{text:"Tahoma"},{text:"Times New Roman"},{text:"Trebuchet MS"},{text:"Verdana"}]},{type:"spin",label:"13",value:"fontsize",range:[9,75],disabled:true}]},{type:"separator"},{group:"textstyle",label:"Font Style",buttons:[{type:"push",label:"Bold CTRL + SHIFT + B",value:"bold"},{type:"push",label:"Italic CTRL + SHIFT + I",value:"italic"},{type:"push",label:"Underline CTRL + SHIFT + U",value:"underline"},{type:"separator"},{type:"push",label:"Subscript",value:"subscript",disabled:true},{type:"push",label:"Superscript",value:"superscript",disabled:true}]},{type:"separator"},{group:"textstyle2",label:"&nbsp;",buttons:[{type:"color",label:"Font Color",value:"forecolor",disabled:true},{type:"color",label:"Background Color",value:"backcolor",disabled:true},{type:"separator"},{type:"push",label:"Remove Formatting",value:"removeformat",disabled:true},{type:"push",label:"Show/Hide Hidden Elements",value:"hiddenelements"}]},{type:"separator"},{group:"undoredo",label:"Undo/Redo",buttons:[{type:"push",label:"Undo",value:"undo",disabled:true},{type:"push",label:"Redo",value:"redo",disabled:true}]},{type:"separator"},{group:"alignment",label:"Alignment",buttons:[{type:"push",label:"Align Left CTRL + SHIFT + [",value:"justifyleft"},{type:"push",label:"Align Center CTRL + SHIFT + |",value:"justifycenter"},{type:"push",label:"Align Right CTRL + SHIFT + ]",value:"justifyright"},{type:"push",label:"Justify",value:"justifyfull"}]},{type:"separator"},{group:"parastyle",label:"Paragraph Style",buttons:[{type:"select",label:"Normal",value:"heading",disabled:true,menu:[{text:"Normal",value:"none",checked:true},{text:"Header 1",value:"h1"},{text:"Header 2",value:"h2"},{text:"Header 3",value:"h3"},{text:"Header 4",value:"h4"},{text:"Header 5",value:"h5"},{text:"Header 6",value:"h6"}]}]},{type:"separator"},{group:"indentlist2",label:"Indenting and Lists",buttons:[{type:"push",label:"Indent",value:"indent",disabled:true},{type:"push",label:"Outdent",value:"outdent",disabled:true},{type:"push",label:"Create an Unordered List",value:"insertunorderedlist"},{type:"push",label:"Create an Ordered List",value:"insertorderedlist"}]},{type:"separator"},{group:"insertitem",label:"Insert Item",buttons:[{type:"push",label:"Insert Image",value:"insertimage"},{type:"push",label:"HTML Link CTRL + SHIFT + L",value:"createlink",disabled:true}]}]}}}var d=ORBEON.util.Utils.isNewXHTMLLayout()?g.getElementsByTagName("textarea")[0]:g;d.disabled=ORBEON.util.Dom.hasClass(g,"xforms-readonly");var f=new YAHOO.widget.Editor(d,h);var e=function(){f.on("editorKeyUp",function(){a(g.id)});f.on("afterNodeChange",function(){a(g.id)});f.removeListener("afterNodeChange",e)};f.on("afterNodeChange",e);rteEditors[g.id]=f;isIncremental[g.id]=ORBEON.util.Dom.hasClass(g,"xforms-incremental");f.on("editorContentLoaded",function(){if(!ORBEON.util.Utils.isNewXHTMLLayout()){var k=g.parentNode;k.className+=" "+g.className}var j=ORBEON.xforms.Controls.getCurrentValue(g);ORBEON.xforms.Globals.serverValue[g.id]=j;if(YAHOO.lang.isObject(renderedCustomEvents[g.id])){renderedCustomEvents[g.id].fire()}renderedCustomEvents[g.id]=true});f.render()},focusOnAnyFormControl:function(e){var d=ORBEON.xforms.Globals.currentFocusControlId;if(rteEditors[e.id]==null&&rteEditors[d]!=null){ORBEON.xforms.Events.change({target:ORBEON.util.Dom.getElementById(d)});ORBEON.xforms.Events.blur({target:ORBEON.util.Dom.getElementById(d)})}},setValue:function(f,e){if(!ORBEON.util.Dom.hasClass(f,"xforms-incremental")||ORBEON.xforms.Globals.currentFocusControlId!=f.id){var d=rteEditors[f.id];d.setEditorHTML(e)}},getValue:function(f){var d=rteEditors[f.id];var e=d.getEditorHTML();if(e=="<br>"){e=""}return e},setFocus:function(e){var d=rteEditors[e.id]},onRendered:function(d,e){if(renderedCustomEvents[d.id]===true){e()}else{if(renderedCustomEvents[d.id]===undefined){renderedCustomEvents[d.id]=new YAHOO.util.CustomEvent("rteRendered")}renderedCustomEvents[d.id].subscribe(e)}},setReadonly:function(f,d){var e=rteEditors[f.id];e.set("disabled",d)}};return c}();ORBEON.xforms.Init={_specialControlsInitFunctions:null,_getSpecialControlsInitFunctions:function(){ORBEON.xforms.Init._specialControlsInitFunctions=ORBEON.xforms.Init._specialControlsInitFunctions||{select1:{compact:ORBEON.xforms.Init._list,"{http://orbeon.org/oxf/xml/xforms}autocomplete":ORBEON.xforms.Init._autoComplete,"{http://orbeon.org/oxf/xml/xforms}menu":ORBEON.xforms.Init._menu,"{http://orbeon.org/oxf/xml/xforms}tree":ORBEON.xforms.Init._tree},select:{compact:ORBEON.xforms.Init._list,"{http://orbeon.org/oxf/xml/xforms}tree":ORBEON.xforms.Init._tree},range:{"":ORBEON.xforms.Init._range},textarea:{"{http://orbeon.org/oxf/xml/xforms}autosize":ORBEON.xforms.Init._widetextArea,"text/html":ORBEON.xforms.Init._htmlArea},dialog:{"":ORBEON.xforms.Init._dialog,full:ORBEON.xforms.Init._dialog,minimal:ORBEON.xforms.Init._dialog}};return ORBEON.xforms.Init._specialControlsInitFunctions},registerDraggableListenersOnRepeatElements:function(e){return;var a=YAHOO.util.Dom.getElementsByClassName("xforms-dnd",null,e);for(var d=0;d<a.length;d++){var b=a[d];var c=b.tagName.toLowerCase();if(c=="div"||c=="tr"||c=="td"||c=="li"){ORBEON.xforms.Init.registerDraggableListenersOnRepeatElement(b)}}},registerDraggableListenersOnRepeatElement:function(b){var a=new ORBEON.xforms.DnD.DraggableItem(b);if(ORBEON.util.Dom.hasClass(b,"xforms-dnd-vertical")){a.setXConstraint(0,0)}else{if(ORBEON.util.Dom.hasClass(b,"xforms-dnd-horizontal")){a.setYConstraint(0,0)}}},document:function(){ORBEON.xforms.Globals={isMac:navigator.userAgent.toLowerCase().indexOf("macintosh")!=-1,isRenderingEngineGecko:YAHOO.env.ua.gecko,isFF3OrNewer:YAHOO.env.ua.gecko>=1.9,isRenderingEnginePresto:YAHOO.env.ua.opera,isRenderingEngineWebCore:YAHOO.env.ua.webkit,isRenderingEngineWebCore13:YAHOO.env.ua.webkit<=312,isRenderingEngineTrident:YAHOO.env.ua.ie,ns:{},resourcesBaseURL:{},xformsServerURL:{},eventQueue:[],eventsFirstEventTime:0,discardableTimerIds:{},requestForm:null,requestIgnoreErrors:false,requestInProgress:false,requestDocument:"",requestTryCount:0,executeEventFunctionQueued:0,maskFocusEvents:false,maskDialogCloseEvents:false,currentFocusControlId:null,currentFocusControlElement:null,htmlAreaNames:[],repeatTreeChildToParent:{},repeatIndexes:{},repeatTreeParentToAllChildren:{},inputCalendarCommitedValue:{},yuiCalendar:null,tooltipLibraryInitialized:false,changedIdsRequest:{},serverValue:{},autoCompleteLastKeyCode:{},autoCompleteOpen:{},loadingOtherPage:false,activeControl:null,autosizeTextareas:[],fckEditorLoading:false,fckEditorsToLoad:[],dialogs:{},dialogMinimalLastMouseOut:{},hintTooltipForControl:{},alertTooltipForControl:{},helpTooltipForControl:{},debugDiv:null,debugLastTime:new Date().getTime(),lastEventSentTime:new Date().getTime(),pageLoadedRegistered:true,menuItemsets:{},menuYui:{},treeYui:{},sliderYui:{},idToElement:{},isReloading:false,lastDialogZIndex:5,formLoadingLoadingOverlay:{},formLoadingLoadingInitialRightTop:{},formErrorPanel:{},formHelpPanel:{},formHelpPanelMessageDiv:{},formHelpPanelCloseButton:{},formLoadingNone:{},formUUID:{},formStaticState:{},formDynamicState:{},formServerEvents:{},formClientState:{},modalProgressPanel:null,changeListeners:{},topLevelListenerRegistered:ORBEON.xforms.Globals.topLevelListenerRegistered==null?false:ORBEON.xforms.Globals.topLevelListenerRegistered};(function(){var ag=ORBEON.xforms.Globals.isRenderingEngineTrident?ORBEON.util.IEDom:ORBEON.util.MozDom;for(var ah in ag){ORBEON.util.Dom[ah]=ag[ah]}}());ORBEON.util.Dom.addClass(document.body,"yui-skin-sam");if(ORBEON.util.Properties.offlineSupport.get()){ORBEON.xforms.Offline.pageLoad()}for(var b=0;b<document.forms.length;b++){var M=document.forms[b];if(ORBEON.util.Dom.hasClass(M,"xforms-form")){var Z=document.forms[b].id;ORBEON.xforms.Globals.ns[Z]=Z.substring(0,Z.indexOf("xforms-form"));ORBEON.xforms.Init._setBasePaths(Z,document.getElementsByTagName("script"),ORBEON.util.Properties.resourcesVersioned.get()=="true");ORBEON.util.Dom.removeClass(M,"xforms-initially-hidden");ORBEON.xforms.Init.registerDraggableListenersOnRepeatElements(M);ORBEON.xforms.Globals.formErrorPanel[Z]=null;ORBEON.xforms.Globals.formLoadingNone[Z]=null;var V=0;for(var ab=0;ab<M.childNodes.length;ab++){if(V==3){break}var F=M.childNodes[ab];if(F.className=="xforms-loading-loading"){F.style.display="block";ORBEON.xforms.Globals.formLoadingLoadingOverlay[Z]=new YAHOO.widget.Overlay(F,{visible:false,monitorresize:true});ORBEON.xforms.Globals.formLoadingLoadingInitialRightTop[Z]=[YAHOO.util.Dom.getViewportWidth()-YAHOO.util.Dom.getX(F),YAHOO.util.Dom.getY(F)];F.style.right="auto";V++}else{if(ORBEON.util.Dom.isElement(F)&&ORBEON.util.Dom.hasClass(F,"xforms-error-panel")){YAHOO.util.Dom.generateId(F);ORBEON.util.Dom.removeClass(F,"xforms-initially-hidden");var L=new YAHOO.widget.Panel(F.id,{width:"700px",modal:true,fixedcenter:false,underlay:"shadow",visible:false,constraintoviewport:true,draggable:true});L.render();L.beforeHideEvent.subscribe(ORBEON.xforms.Events.errorPanelClosed,Z);ORBEON.xforms.Globals.formErrorPanel[Z]=L;var O=ORBEON.util.Dom.getChildElementByClass(F,"hd");var A=ORBEON.util.Dom.getChildElementByClass(F,"bd");var ae=ORBEON.util.Dom.getChildElementByClass(A,"xforms-error-panel-details-hidden");var y=ORBEON.util.Dom.getChildElementByIndex(ORBEON.util.Dom.getChildElementByIndex(ae,0),0);YAHOO.util.Dom.generateId(y);var aa=ORBEON.util.Dom.getChildElementByClass(A,"xforms-error-panel-details-shown");var ac=ORBEON.util.Dom.getChildElementByIndex(ORBEON.util.Dom.getChildElementByIndex(aa,0),0);YAHOO.util.Dom.generateId(ac);L.errorTitleDiv=O;L.errorDetailsDiv=ORBEON.util.Dom.getChildElementByClass(aa,"xforms-error-panel-details");YAHOO.util.Event.addListener(y.id,"click",ORBEON.xforms.Events.errorShowHideDetails);YAHOO.util.Event.addListener(ac.id,"click",ORBEON.xforms.Events.errorShowHideDetails);var h=YAHOO.util.Dom.getElementsByClassName("xforms-error-panel-close",null,F);if(h.length!=0){YAHOO.util.Dom.generateId(h[0]);YAHOO.util.Event.addListener(h[0].id,"click",ORBEON.xforms.Events.errorCloseClicked,L)}var Y=YAHOO.util.Dom.getElementsByClassName("xforms-error-panel-reload",null,F);if(Y.length!=0){YAHOO.util.Dom.generateId(Y[0]);YAHOO.util.Event.addListener(Y[0].id,"click",ORBEON.xforms.Events.errorReloadClicked,L)}V++}else{if(F.className=="xforms-loading-none"){ORBEON.xforms.Globals.formLoadingNone[Z]=F;V++}}}}var f=M.elements;var l;var P;for(var x=0;x<f.length;x++){var r=f[x];if(r.name.indexOf("$uuid")!=-1){ORBEON.xforms.Globals.formUUID[Z]=r}else{if(r.name.indexOf("$static-state")!=-1){ORBEON.xforms.Globals.formStaticState[Z]=r}else{if(r.name.indexOf("$dynamic-state")!=-1){ORBEON.xforms.Globals.formDynamicState[Z]=r}else{if(r.name.indexOf("$server-events")!=-1){ORBEON.xforms.Globals.formServerEvents[Z]=r}else{if(r.name.indexOf("$client-state")!=-1){ORBEON.xforms.Globals.formClientState[Z]=r;if(r.value==""){ORBEON.xforms.Document.storeInClientState(Z,"initial-dynamic-state",ORBEON.xforms.Globals.formDynamicState[Z].value)}}else{if(r.name.indexOf("$repeat-tree")!=-1){l=r}else{if(r.name.indexOf("$repeat-indexes")!=-1){P=r;break}}}}}}}}var I=l.value;var q=I.split(",");for(var W=0;W<q.length;W++){var S=q[W].split(" ");var N=S[0];if(S.length>1){var n=S[S.length-1];ORBEON.xforms.Globals.repeatTreeChildToParent[N]=n}}for(var j in ORBEON.xforms.Globals.repeatTreeChildToParent){var n=ORBEON.xforms.Globals.repeatTreeChildToParent[j];while(n!=null){if(!ORBEON.xforms.Globals.repeatTreeParentToAllChildren[n]){ORBEON.xforms.Globals.repeatTreeParentToAllChildren[n]=new Array()}ORBEON.xforms.Globals.repeatTreeParentToAllChildren[n].push(j);n=ORBEON.xforms.Globals.repeatTreeChildToParent[n]}}var z=P.value;var G=z.split(",");for(var W=0;W<G.length;W++){var S=G[W].split(" ");var N=S[0];var H=S[S.length-1];ORBEON.xforms.Globals.repeatIndexes[N]=H}if(ORBEON.xforms.Document.getFromClientState(Z,"load-did-run")==null){ORBEON.xforms.Document.storeInClientState(Z,"load-did-run","true");ORBEON.xforms.Document.storeInClientState(Z,"request-sequence-number","1")}else{if(ORBEON.util.Properties.revisitHandling.get()=="reload"){ORBEON.xforms.Globals.isReloading=true;window.location.reload(true)}else{var af=new ORBEON.xforms.Server.Event(M,null,null,null,"xxforms-all-events-required");ORBEON.xforms.Server.fireEvents([af],false)}}if(!(window.orbeonInitData===undefined)){var Q=window.orbeonInitData[Z];var E=ORBEON.xforms.Init._getSpecialControlsInitFunctions();for(var g in Q.controls){if(E[g]){var ad=Q.controls[g];for(var p in ad){var u=E[g][p];if(u){var o=ad[p];for(var w=0;w<o.length;w++){var C=ORBEON.util.Dom.getElementById(o[w]);u(C)}}}}}var a=Q.keylisteners;if(YAHOO.lang.isArray(a)){for(var e=0;e<a.length;e++){var J=a[e];J.isDocumentListener=J.observer=="#document";J.isDialogListener=false;if(!J.isDocumentListener){J.observerElement=YAHOO.util.Dom.get(J.observer);J.isDialogListener=YAHOO.util.Dom.hasClass(J.observerElement,"xforms-dialog")}if(J.isDocumentListener||J.isDialogListener){J.observerElement=document}J.form=M;var d={};if(YAHOO.lang.isString(J.modifier)){var K=J.modifier.split(" ");for(var U=0;U<K.length;U++){var m=K[U];if(m.toLowerCase()=="control"){d.ctrl=true}if(m.toLowerCase()=="shift"){d.shift=true}if(m.toLowerCase()=="alt"){d.alt=true}}}d.keys=[];var D=J.text.toUpperCase();for(var X=0;X<D.length;X++){d.keys.push(D.charCodeAt(X))}var B=new YAHOO.util.KeyListener(J.observerElement,d,{scope:J,correctScope:false,fn:function(ai,ai,ag){var ah=ag.observer;var aj=["text",ag.text];if(!YAHOO.lang.isUndefined(ag.modifier)){aj.push("modifiers");aj.push(ag.modifier)}var ai=new ORBEON.xforms.Server.Event(ag.form,ah,null,null,"keypress",null,null,null,null,null,aj);ORBEON.xforms.Server.fireEvents([ai],false)}});if(J.isDialogListener){var t=ORBEON.xforms.Globals.dialogs[J.observer];var R=t.cfg.getProperty("keylisteners");if(YAHOO.lang.isUndefined(R)){R=[]}R.push(B);t.cfg.setProperty("keylisteners",R)}else{B.enable()}}}var k=Q["server-events"];if(YAHOO.lang.isArray(k)){for(var v=0;v<k.length;v++){var T=k[v];var c=!YAHOO.lang.isUndefined(T.discardable)&&T.discardable;ORBEON.xforms.Server.createDelayedServerEvent(T.event,T.delay,T["show-progress"],T["progress-message"],c,M.id)}}}}}if(!ORBEON.xforms.Globals.topLevelListenerRegistered){if(YAHOO.lang.isUndefined(document.addEventListener)){YAHOO.util.Event.addListener(document,"focusin",ORBEON.xforms.Events.focus);YAHOO.util.Event.addListener(document,"focusout",ORBEON.xforms.Events.blur)}else{document.addEventListener("focus",ORBEON.xforms.Events.focus,true);document.addEventListener("blur",ORBEON.xforms.Events.blur,true);document.addEventListener("change",ORBEON.xforms.Events.change,true)}}if(!ORBEON.xforms.Globals.topLevelListenerRegistered){YAHOO.util.Event.addListener(document,"keypress",ORBEON.xforms.Events.keypress);YAHOO.util.Event.addListener(document,"keydown",ORBEON.xforms.Events.keydown);YAHOO.util.Event.addListener(document,"keyup",ORBEON.xforms.Events.keyup);YAHOO.util.Event.addListener(document,"mouseover",ORBEON.xforms.Events.mouseover);YAHOO.util.Event.addListener(document,"mouseout",ORBEON.xforms.Events.mouseout);YAHOO.util.Event.addListener(document,"click",ORBEON.xforms.Events.click);YAHOO.util.Event.addListener(window,"resize",ORBEON.xforms.Events.resize);YAHOO.widget.Overlay.windowScrollEvent.subscribe(ORBEON.xforms.Events.scrollOrResize);YAHOO.widget.Overlay.windowResizeEvent.subscribe(ORBEON.xforms.Events.scrollOrResize)}if(typeof xformsPageLoadedServer!="undefined"&&!ORBEON.xforms.Globals.fckEditorLoading){xformsPageLoadedServer()}if(window.parent.childWindowOrbeonReady){window.parent.childWindowOrbeonReady();window.parent.childWindowOrbeonReady=null}ORBEON.xforms.Globals.topLevelListenerRegistered=true;if(ORBEON.util.Properties.sessionHeartbeat.get()){var s=ORBEON.util.Properties.sessionHeartbeatDelay.get();if(s>0){window.setInterval(function(){ORBEON.xforms.Events.sendHeartBeatIfNeeded(s)},s/10)}}window.setTimeout(function(){ORBEON.xforms.Events.orbeonLoadedEvent.fire()},ORBEON.util.Properties.internalShortDelay.get())},profileDocument:function(){console.profile("XForms initialization");ORBEON.xforms.Init.document();console.profileEnd()},insertedElement:function(a){if(a.nodeType==ORBEON.util.Dom.ELEMENT_TYPE){if(ORBEON.util.Dom.hasClass(a,"xforms-select1-appearance-xxforms-autocomplete")){ORBEON.xforms.Init._autoComplete(a)}else{if(ORBEON.util.Dom.hasClass(a,"xforms-textarea")&&ORBEON.util.Dom.hasClass(a,"xforms-mediatype-text-html")){ORBEON.xforms.Init._htmlArea(a)}else{if(ORBEON.util.Dom.hasClass(a,"xforms-dialog")){ORBEON.xforms.Init._dialog(a)}}}for(var c=0;c<a.childNodes.length;c++){var b=a.childNodes[c];if(b.nodeType==ORBEON.util.Dom.ELEMENT_TYPE){ORBEON.xforms.Init.insertedElement(b)}}}},_setBasePaths:function(c,f,g){var e=null;var d=null;for(var k=0;k<f.length;k++){var l=f[k];var b=ORBEON.util.Dom.getAttribute(l,"src");if(b!=null){var a=b.indexOf(PATH_TO_JAVASCRIPT_1);if(a!=-1){var h=b.substr(0,a);e=h;if(g){d=h.substring(0,h.lastIndexOf("/"))+XFORMS_SERVER_PATH}else{d=h+XFORMS_SERVER_PATH}break}else{a=b.indexOf(PATH_TO_JAVASCRIPT_2);if(a!=-1){var h=b.substr(0,a);var n=b.substr(a);if(g){var o=/^(\/[^\/]+)(\/[^\/]+)(\/.*)$/.exec(n);var j=o[2];e=h+j;d=h+XFORMS_SERVER_PATH}else{e=h;d=h+XFORMS_SERVER_PATH}break}}}}if(e==null){if(!(window.orbeonInitData===undefined)){var m=window.orbeonInitData[c];if(m&&m.paths){e=m.paths["resources-base"];d=m.paths["xforms-server"]}}}ORBEON.xforms.Globals.resourcesBaseURL[c]=e;ORBEON.xforms.Globals.xformsServerURL[c]=d},_autoComplete:function(f){var e=ORBEON.util.Dom.getChildElementByIndex(f,0);var a=ORBEON.util.Dom.getChildElementByIndex(f,1);var c=new Array();for(var d=1;d<a.options.length;d++){c.push(a.options[d].value)}var b=ORBEON.util.Dom.hasClass(f,"xforms-select1-open-autocomplete-nofilter");ORBEON.xforms.Globals.autoCompleteOpen[f.id]=actb(e,c,b)},_widetextArea:function(a){ORBEON.xforms.Globals.autosizeTextareas.push(a);ORBEON.xforms.Controls.autosizeTextarea(a)},_range:function(a){a.tabIndex=0;ORBEON.xforms.Globals.serverValue[a.id]="0";var b;if(ORBEON.util.Utils.isNewXHTMLLayout()){b=YAHOO.util.Dom.getElementsByClassName("xforms-range-background","div",a)[0]}else{b=a}var d=YAHOO.util.Dom.getElementsByClassName("xforms-range-thumb","div",a)[0];d.id=ORBEON.util.Utils.appendToEffectiveId(a.id,"$$thumb");var c=YAHOO.widget.Slider.getHorizSlider(b.id,d.id,0,200);c.subscribe("change",ORBEON.xforms.Events.sliderValueChange);ORBEON.xforms.Globals.sliderYui[a.id]=c},_addToTree:function(o,q,l,p){for(var n=p;n<q.length;n++){var f=q[n];var b=f[0];var m=f[1];var h=2;var j="ygtvlabel";var e=false;for(var c=[f[2],f[3]],g=0;g<2;g++){var k=c[g];if(!YAHOO.lang.isUndefined(k)&&!YAHOO.lang.isArray(k)){h++;if(YAHOO.lang.isBoolean(k)){e=k}else{if(!YAHOO.lang.isUndefined(k["class"])){j+=" "+k["class"]}}}else{break}}var d={label:b,value:m,labelStyle:j};var a;if(o.xformsAllowMultipleSelection){a=new YAHOO.widget.TaskNode(d,l,false);a.onCheckClick=ORBEON.xforms.Events.treeCheckClick}else{a=new YAHOO.widget.TextNode(d,l,false)}ORBEON.xforms.Init._addToTree(o,f,a,h);if(e){if(o.value!=""){o.value+=" "}o.value+=m}}},_initTreeDivFromArray:function(k,g,l){var c=g.getRoot();ORBEON.xforms.Init._addToTree(k,l,c,0);if(k.xformsAllowMultipleSelection){var j=k.value.split(" ");var a=g.getNodesByProperty();if(a!=null){for(var d=0;d<a.length;d++){var b=a[d];var h=b.data.value;for(var f=0;f<j.length;f++){if(h==j[f]){b.check();break}}}}}var j=k.xformsAllowMultipleSelection?k.value.split(" "):[k.value];ORBEON.xforms.Controls.treeOpenSelectedVisible(g,j);g.draw();if(!k.xformsAllowMultipleSelection){var e=g.getNodeByProperty("value",k.value);if(e!=null){YAHOO.util.Dom.addClass(e.getLabelEl(),"xforms-tree-label-selected")}}},_tree:function(treeDiv){var controlId=treeDiv.id;var allowMultipleSelection=ORBEON.util.Dom.hasClass(treeDiv,"xforms-select");var showToolTip=ORBEON.util.Dom.hasClass(treeDiv,"xforms-show-tooltip");if(ORBEON.util.Utils.isNewXHTMLLayout()){treeDiv=treeDiv.getElementsByTagName("div")[0]}treeDiv.xformsAllowMultipleSelection=allowMultipleSelection;var treeString=ORBEON.util.Dom.getStringValue(treeDiv);var treeArray=ORBEON.util.String.eval(treeString);ORBEON.util.Dom.setStringValue(treeDiv,"");treeDiv.value="";var yuiTree=new YAHOO.widget.TreeView(treeDiv.id);ORBEON.xforms.Globals.treeYui[controlId]=yuiTree;if(!YAHOO.lang.isUndefined(treeArray)){ORBEON.xforms.Init._initTreeDivFromArray(treeDiv,yuiTree,treeArray)}ORBEON.xforms.Globals.serverValue[controlId]=treeDiv.value;yuiTree.subscribe("labelClick",ORBEON.xforms.Events.treeLabelClick);yuiTree.subscribe("enterKeyPressed",ORBEON.xforms.Events.treeLabelClick);yuiTree.subscribe("clickEvent",function(object){if(object.node.expanded){return false}});if(showToolTip){function addTreeToolTip(){var nodes=yuiTree.getNodesByProperty();if(nodes!=null){for(var nodeIndex=0;nodeIndex<nodes.length;nodeIndex++){var node=nodes[nodeIndex];if(node.children.length==0){continue}var contentEl=ORBEON.util.Dom.getElementById(node.contentElId);if(contentEl==null){continue}var iconEl=contentEl.previousSibling;var orbeonToolTip=new YAHOO.widget.Tooltip(contentEl.id+"-orbeon-tree-tooltip",{context:iconEl.id,text:(node.expanded?"Collapse ":"Expand ")+node.label,showDelay:100})}}}addTreeToolTip();yuiTree.subscribe("expandComplete",function(){addTreeToolTip()});yuiTree.subscribe("collapseComplete",function(){addTreeToolTip()})}ORBEON.util.Dom.removeClass(ORBEON.util.Utils.isNewXHTMLLayout()?treeDiv.parentNode:treeDiv,"xforms-initially-hidden")},_addToMenuItem:function(c,k,a){if(a.element.id==""){YAHOO.util.Dom.generateId(a.element)}a.clickEvent.subscribe(ORBEON.xforms.Events.menuClick,{menu:c,value:k[1]});if(k.length>3){var f=new YAHOO.widget.Menu(a.element.id+"menu");for(var j=3;j<k.length;j++){var g=k[j];var b=g[0];var h=g[1];var e=g[2];var d=new YAHOO.widget.MenuItem(b);f.addItem(d);ORBEON.xforms.Init._addToMenuItem(c,g,d)}a.cfg.setProperty("submenu",f)}},_menu:function(menu){var yuiMenuDiv=YAHOO.util.Dom.getElementsByClassName("yuimenubar",null,menu)[0];var valuesDiv=YAHOO.util.Dom.getElementsByClassName("xforms-initially-hidden",null,menu)[0];var menuString=ORBEON.util.Dom.getStringValue(valuesDiv);ORBEON.xforms.Globals.menuItemsets[menu.id]=ORBEON.util.String.eval(menuString);YAHOO.util.Dom.generateId(yuiMenuDiv);var yuiMenu=new YAHOO.widget.MenuBar(yuiMenuDiv.id,{autosubmenudisplay:true,hidedelay:750,lazyload:true});yuiMenu.render();ORBEON.xforms.Globals.menuYui[menu.id]=yuiMenu},_htmlArea:function(b){if(ORBEON.util.Properties.htmlEditor.get()=="yui"){ORBEON.widgets.RTE.init(b)}else{var a=new FCKeditor(b.name);if(!xformsArrayContains(ORBEON.xforms.Globals.htmlAreaNames,b.name)){ORBEON.xforms.Globals.htmlAreaNames.push(b.name)}var c=ORBEON.xforms.Globals.requestForm.id;a.BasePath=ORBEON.xforms.Globals.resourcesBaseURL[c]+ORBEON.util.Properties.fckEditorBasePath.get();a.ToolbarSet="OPS";var d=typeof USER_LANGUAGE;if(d!="undefined"){a.Config.AutoDetectLanguage=false;a.Config.DefaultLanguage=(USER_LANGUAGE!="")?USER_LANGUAGE:"en"}d=typeof FCK_CUSTOM_CONFIG;if(d!="undefined"){a.Config.CustomConfigurationsPath=a.BasePath+FCK_CUSTOM_CONFIG}if(ORBEON.xforms.Globals.fckEditorLoading){ORBEON.xforms.Globals.fckEditorsToLoad.push(a)}else{ORBEON.xforms.Globals.fckEditorLoading=true;a.ReplaceTextarea();ORBEON.xforms.Controls.updateHTMLAreaClasses(ORBEON.util.Dom.getElementById(a.InstanceName))}}},_list:function(d){var c="";if(ORBEON.util.Utils.isNewXHTMLLayout()){d=YAHOO.util.Dom.getElementsByClassName("","select",d)[0]}for(var a=0;a<d.options.length;a++){var b=d.options[a];if(b.selected){if(c!=""){c+=" "}c+=b.value}}ORBEON.xforms.Globals.serverValue[d.id]=c},_dialog:function(c){var h=ORBEON.util.Dom.hasClass(c,"xforms-dialog-modal");var f=ORBEON.util.Dom.hasClass(c,"xforms-dialog-close-true");var b=ORBEON.util.Dom.hasClass(c,"xforms-dialog-draggable-true");var a=ORBEON.util.Dom.hasClass(c,"xforms-dialog-visible-true");var d=ORBEON.util.Dom.hasClass(c,"xforms-dialog-appearance-minimal");if(ORBEON.xforms.Globals.dialogs[c.id]){ORBEON.xforms.Globals.dialogs[c.id].destroy()}var g;if(d){g=new YAHOO.widget.Dialog(c.id,{modal:h,close:false,visible:false,draggable:false,fixedcenter:false,constraintoviewport:true,underlay:"none",usearia:true});YAHOO.util.Event.addListener(document.body,"click",ORBEON.xforms.Events.dialogMinimalBodyClick,g)}else{g=new YAHOO.widget.Dialog(c.id,{modal:h,close:f,visible:false,draggable:b,fixedcenter:false,constraintoviewport:true,underlay:"none",usearia:true});g.showEvent.subscribe(ORBEON.xforms.Events.dialogShow,c.id);g.beforeHideEvent.subscribe(ORBEON.xforms.Events.dialogClose,c.id)}var e=ORBEON.xforms.Controls.getForm(g.element);if(g.element.parentNode!=e){e.appendChild(g.element)}ORBEON.xforms.Globals.dialogs[c.id]=g;if(a){ORBEON.xforms.Controls.showDialog(c.id,null)}}};ORBEON.xforms.Server={Event:function(a,l,e,k,f,d,b,c,g,j,h){this.form=YAHOO.lang.isObject(a)?a:YAHOO.lang.isString(l)?ORBEON.xforms.Controls.getForm(ORBEON.util.Dom.getElementById(l)):null;this.targetId=YAHOO.lang.isUndefined(l)?null:l;this.otherId=YAHOO.lang.isUndefined(e)?null:e;this.value=YAHOO.lang.isUndefined(k)?null:k;this.eventName=YAHOO.lang.isUndefined(f)?null:f;this.bubbles=YAHOO.lang.isUndefined(d)?null:d;this.cancelable=YAHOO.lang.isUndefined(b)?null:b;this.ignoreErrors=YAHOO.lang.isUndefined(c)?null:c;this.showProgress=YAHOO.lang.isBoolean(g)?g:true;this.progressMessage=YAHOO.lang.isUndefined(j)?null:j;this.additionalAttribs=YAHOO.lang.isUndefined(h)?null:h},exceptionWhenTalkingToServer:function(c,b){ORBEON.util.Utils.logMessage("JavaScript error");ORBEON.util.Utils.logMessage(c);var a="Exception in client-side code.";a+="<ul>";if(c.message!=null){a+="<li>Message: "+c.message+"</li>"}if(c.fileName!=null){a+="<li>File: "+c.fileName+"</li>"}if(c.lineNumber!=null){a+="<li>Line number: "+c.lineNumber+"</li>"}a+="</ul>";ORBEON.xforms.Server.showError("Exception in client-side code",a,b)},showError:function(d,b,c){ORBEON.xforms.Events.errorEvent.fire({title:d,details:b});if(!ORBEON.xforms.Globals.requestIgnoreErrors&&ORBEON.util.Properties.showErrorDialog.get()=="true"){var a=ORBEON.xforms.Globals.formErrorPanel[c];if(a){a.element.style.display="block";a.errorTitleDiv.innerHTML=d;a.errorDetailsDiv.innerHTML=b;a.show();a.center()}}},fireEvents:function(b,f){if(!ORBEON.xforms.Offline.isOnline){var a=[];for(var c=0;c<b.length;c++){var e=b[c];if(e.eventName=="xxforms-value-change-with-focus-change"){a.push(e);ORBEON.xforms.Offline.controlValues[e.targetId]=e.value}}if(a.length>0){ORBEON.xforms.Offline.memoryOfflineEvents=ORBEON.xforms.Offline.memoryOfflineEvents.concat(a);ORBEON.xforms.Globals.executeEventFunctionQueued++;window.setTimeout(function(){ORBEON.xforms.Globals.executeEventFunctionQueued--;if(ORBEON.xforms.Globals.executeEventFunctionQueued==0){ORBEON.xforms.Offline.evaluateMIPs()}},ORBEON.util.Properties.internalShortDelay.get())}}else{var d=new Date().getTime();if(ORBEON.xforms.Globals.eventQueue.length==0){ORBEON.xforms.Globals.eventsFirstEventTime=d}for(var c=0;c<b.length;c++){ORBEON.xforms.Globals.eventQueue.push(b[c])}ORBEON.xforms.Globals.executeEventFunctionQueued++;if(f&&!(d-ORBEON.xforms.Globals.eventsFirstEventTime>ORBEON.util.Properties.delayBeforeForceIncrementalRequest.get())){window.setTimeout(function(){ORBEON.xforms.Server.executeNextRequest(false)},ORBEON.util.Properties.delayBeforeForceIncrementalRequest.get())}else{window.setTimeout(function(){ORBEON.xforms.Server.executeNextRequest(true)},ORBEON.util.Properties.internalShortDelay.get())}ORBEON.xforms.Globals.lastEventSentTime=new Date().getTime()}},createDelayedServerEvent:function(g,d,h,c,b,f){var a=window.setTimeout(function(){var j=new ORBEON.xforms.Server.Event(ORBEON.util.Dom.getElementById(f),null,null,g,"server-events",null,null,null,h,c);ORBEON.xforms.Server.fireEvents([j])},d);if(b){var e=ORBEON.xforms.Globals.discardableTimerIds;e[f]=e[f]||[];e[f].push(a)}},_debugEventQueue:function(){ORBEON.util.Utils.logMessage("Event queue:");for(var a=0;a<ORBEON.xforms.Globals.eventQueue.length;a++){var b=ORBEON.xforms.Globals.eventQueue[a];ORBEON.util.Utils.logMessage(" "+a+" - name: "+b.eventName+" | targetId: "+b.targetId+" | value: "+b.value)}},executeNextRequest:function(v){v=typeof(v)=="boolean"&&v==true;ORBEON.xforms.Globals.executeEventFunctionQueued--;var h=false;if(!ORBEON.xforms.Globals.requestInProgress&&ORBEON.xforms.Globals.eventQueue.length>0&&(v||ORBEON.xforms.Globals.executeEventFunctionQueued==0)){var b={};var k=ORBEON.util.Properties.clientEventsFilter.get().split(" ");for(var j=0;j<k.length;j++){b[k[j]]=true}var f=false;if(ORBEON.util.Properties.clientEventMode.get()=="deferred"){var H=null;var z=false;eventLoop:for(var j=0;j<ORBEON.xforms.Globals.eventQueue.length;j++){var B=ORBEON.xforms.Globals.eventQueue[j];if(B.eventName=="DOMActivate"){f=true;break eventLoop}if(B.targetId!=null&&b[B.eventName]==null){var G=ORBEON.util.Dom.getElementById(B.targetId);if(G==null){f=true;break eventLoop}else{if(ORBEON.util.Dom.hasClass(G,"xxforms-events-mode-default")){f=true;break eventLoop}var n=G.parentNode;var q=false;while(n!=null){if(n.nodeType==ELEMENT_TYPE&&ORBEON.util.Dom.hasClass(n,"xxforms-events-mode-default")){q=true;if(z){f=true;break eventLoop}if(H==null){H=n}else{if(H!=n){f=true;break eventLoop}}break}n=n.parentNode}if(!q){z=true;if(H!=null){f=true;break eventLoop}}}}}}else{var f=true}if(f){var p={};var g=[];for(var j=0;j<ORBEON.xforms.Globals.eventQueue.length;j++){var B=ORBEON.xforms.Globals.eventQueue[j];if(b[B.eventName]==null){if(B.eventName=="xxforms-value-change-with-focus-change"){if(p[B.targetId]==null){if(ORBEON.util.Dom.hasClass(ORBEON.util.Dom.getElementById(B.targetId),"xforms-upload")||(ORBEON.xforms.Globals.serverValue[B.targetId]!="undefined"&&ORBEON.xforms.Globals.serverValue[B.targetId]!=B.value)){p[B.targetId]=B;ORBEON.xforms.Globals.serverValue[B.targetId]=B.value;g.push(B)}}else{p[B.targetId].value=B.value;ORBEON.xforms.Globals.serverValue[B.targetId]=B.value}}else{p={};g.push(B)}}}ORBEON.xforms.Globals.eventQueue=g;if(ORBEON.xforms.Globals.eventQueue.length>0){ORBEON.xforms.Globals.requestForm=ORBEON.xforms.Globals.eventQueue[0].form;var w=ORBEON.xforms.Globals.requestForm.id;for(var u in ORBEON.xforms.Globals.changedIdsRequest){if(ORBEON.xforms.Globals.changedIdsRequest[u]==0){ORBEON.xforms.Globals.changedIdsRequest[u]=null}}ORBEON.xforms.Globals.requestIgnoreErrors=true;var y=false;var x=false;var t;var s=false;for(var j=0;j<ORBEON.xforms.Globals.eventQueue.length;j++){var B=ORBEON.xforms.Globals.eventQueue[j];if(!B.ignoreErrors){ORBEON.xforms.Globals.requestIgnoreErrors=false}if(B.eventName=="xxforms-all-events-required"||B.eventName=="xxforms-offline"){y=true}if(B.eventName!="xxforms-session-heartbeat"){s=true}if(B.showProgress){x=true}if(YAHOO.lang.isString(B.progressMessage)){t=j==0?B.progressMessage:t==B.progressMessage?B.progressMessage:null}else{t=null}if(B.eventName=="DOMActivate"){var D=ORBEON.util.Dom.getElementById(B.targetId);if(D&&ORBEON.util.Dom.hasClass(D,"xxforms-offline")){y=true}}}ORBEON.xforms.Globals.requestInProgress=true;if(s){var d=ORBEON.xforms.Globals.discardableTimerIds[w]||[];for(var r=0;r<d.length;r++){var l=d[r];window.clearTimeout(l)}ORBEON.xforms.Globals.discardableTimerIds[w]=[]}if(x){var a=ORBEON.util.Properties.delayBeforeDisplayLoading.get();if(a==0){xformsDisplayLoading(t)}else{window.setTimeout(function(){xformsDisplayLoading(t)},a)}}var E=[];E.push('<!DOCTYPE xxforms:event-request [<!ENTITY nbsp "&#160;">]>\n');var o="    ";E.push('<xxforms:event-request xmlns:xxforms="http://orbeon.org/oxf/xml/xforms">\n');E.push(o);E.push("<xxforms:uuid>");E.push(ORBEON.xforms.Globals.formUUID[w].value);E.push("</xxforms:uuid>\n");var F=ORBEON.xforms.Document.getFromClientState(w,"request-sequence-number");ORBEON.xforms.Document.storeInClientState(w,"request-sequence-number",parseInt(F)+1);E.push(o);E.push("<xxforms:request-sequence-number>");E.push(F);E.push("</xxforms:request-sequence-number>\n");var m=ORBEON.xforms.Globals.formStaticState[w].value;if(m!=null&&m!=""){E.push(o);E.push("<xxforms:static-state>");E.push(m);E.push("</xxforms:static-state>\n")}var A=ORBEON.xforms.Globals.formDynamicState[w].value;if(A!=null&&A!=""){E.push(o);E.push("<xxforms:dynamic-state>");E.push(A);E.push("</xxforms:dynamic-state>\n")}if(y){E.push(o);E.push("<xxforms:initial-dynamic-state>");E.push(ORBEON.xforms.Document.getFromClientState(w,"initial-dynamic-state"));E.push("</xxforms:initial-dynamic-state>\n")}var c=[];for(var C=0;C<ORBEON.xforms.Globals.eventQueue.length;C++){var B=ORBEON.xforms.Globals.eventQueue[C];if(ORBEON.xforms.Controls.getForm(B.form)==ORBEON.xforms.Globals.requestForm){if(B.eventName=="server-events"){E.push(o);E.push("<xxforms:server-events>");E.push(B.value);E.push("</xxforms:server-events>");c.unshift(C)}}}E.push(o);E.push("<xxforms:action>\n");for(var C=0;C<ORBEON.xforms.Globals.eventQueue.length;C++){var B=ORBEON.xforms.Globals.eventQueue[C];if(ORBEON.xforms.Controls.getForm(B.form)==ORBEON.xforms.Globals.requestForm&&B.eventName!="server-events"){E.push(o+o);E.push("<xxforms:event");E.push(' name="'+B.eventName+'"');if(B.targetId!=null){E.push(' source-control-id="'+B.targetId+'"')}if(B.otherId!=null){E.push(' other-control-id="'+B.otherId+'"')}if(B.additionalAttribs!=null){for(var e=0;e<B.additionalAttribs.length-1;e+=2){E.push(" "+B.additionalAttribs[e]+'="'+B.additionalAttribs[e+1]+'"')}}E.push(">");if(B.value!=null){if(typeof B.value=="string"){B.value=B.value.replace(XFORMS_REGEXP_AMPERSAND,"&amp;");B.value=B.value.replace(XFORMS_REGEXP_OPEN_ANGLE,"&lt;")}E.push(B.value)}E.push("</xxforms:event>\n");c.unshift(C)}}E.push(o);E.push("</xxforms:action>\n");E.push("</xxforms:event-request>");for(var C=0;C<c.length;C++){ORBEON.xforms.Globals.eventQueue.splice(c[C],1)}h=true;ORBEON.xforms.Globals.requestTryCount=0;ORBEON.xforms.Globals.requestDocument=E.join("");ORBEON.xforms.Server.asyncRequest()}}}if(!h&&ORBEON.xforms.Globals.eventQueue.length==0){xformsDisplayIndicator("none")}},asyncRequest:function(){try{ORBEON.xforms.Globals.requestTryCount++;YAHOO.util.Connect.setDefaultPostHeader(false);YAHOO.util.Connect.initHeader("Content-Type","application/xml");var d={success:ORBEON.xforms.Server.handleResponseAjax,failure:ORBEON.xforms.Server.handleFailure};var a=ORBEON.util.Properties.delayBeforeAjaxTimeout.get();if(a!=-1){d.timeout=a}var c=ORBEON.xforms.Globals.requestForm.id;YAHOO.util.Connect.asyncRequest("POST",ORBEON.xforms.Globals.xformsServerURL[c],d,ORBEON.xforms.Globals.requestDocument)}catch(b){ORBEON.xforms.Globals.requestInProgress=false;var c=ORBEON.xforms.Globals.requestForm.id;ORBEON.xforms.Server.exceptionWhenTalkingToServer(b,c)}},handleFailure:function(e){if(e.responseXML&&e.responseXML.documentElement&&e.responseXML.documentElement.tagName.indexOf("error")!=-1){ORBEON.xforms.Globals.requestInProgress=false;ORBEON.xforms.Globals.requestDocument="";var c=ORBEON.xforms.Globals.requestForm.id;var d=ORBEON.util.Dom.getStringValue(ORBEON.util.Dom.getElementsByName(e.responseXML.documentElement,"title",null)[0]);var a=ORBEON.util.Dom.getStringValue(ORBEON.util.Dom.getElementsByName(e.responseXML.documentElement,"body",null)[0]);ORBEON.xforms.Server.showError(d,a,c)}else{var b=Math.min(ORBEON.util.Properties.retryDelayIncrement.get()*(ORBEON.xforms.Globals.requestTryCount-1),ORBEON.util.Properties.retryMaxDelay.get());if(b==0){ORBEON.xforms.Server.asyncRequest()}else{window.setTimeout(ORBEON.xforms.Server.asyncRequest,b)}}},handleUploadResponse:function(d){var c=YAHOO.util.Dom.getElementsByClassName("xforms-upload","span");for(var b=0;b<c.length;b++){var a=c[b];if(ORBEON.util.Dom.hasClass(a,"xforms-upload-state-empty")){ORBEON.util.Dom.clearUploadControl(a)}}ORBEON.xforms.Server.handleResponseAjax(d)},handleResponseAjax:function(f){var e=f.responseXML;if(!YAHOO.lang.isUndefined(f.getResponseHeader)&&YAHOO.lang.trim(f.getResponseHeader["Content-Type"])=="text/html"){if(dojox&&dojox.html&&dojox.html.set){var g=document.createElement("div");g.innerHTML=f.responseText;var b=ORBEON.util.Dom.getChildElementByIndex(g,0);var a=ORBEON.xforms.Globals.requestForm;while(a!=null&&a.className&&!ORBEON.util.Dom.hasClass(a,"orbeon-portlet-div")){a=a.parentNode}if(ORBEON.xforms.Globals.topLevelListenerRegistered){if(ORBEON.xforms.Globals.isRenderingEngineTrident){YAHOO.util.Event.removeListener(document,"focusin",ORBEON.xforms.Events.focus);YAHOO.util.Event.removeListener(document,"focusout",ORBEON.xforms.Events.blur);YAHOO.util.Event.removeListener(document,"change",ORBEON.xforms.Events.change)}else{document.removeEventListener("focus",ORBEON.xforms.Events.focus,true);document.removeEventListener("blur",ORBEON.xforms.Events.blur,true);document.removeEventListener("change",ORBEON.xforms.Events.change,true)}YAHOO.util.Event.removeListener(document,"keypress",ORBEON.xforms.Events.keypress);YAHOO.util.Event.removeListener(document,"keydown",ORBEON.xforms.Events.keydown);YAHOO.util.Event.removeListener(document,"keyup",ORBEON.xforms.Events.keyup);YAHOO.util.Event.removeListener(document,"mouseover",ORBEON.xforms.Events.mouseover);YAHOO.util.Event.removeListener(document,"mouseout",ORBEON.xforms.Events.mouseout);YAHOO.util.Event.removeListener(document,"click",ORBEON.xforms.Events.click);YAHOO.util.Event.removeListener(window,"resize",ORBEON.xforms.Events.resize);YAHOO.widget.Overlay.windowScrollEvent.unsubscribe(ORBEON.xforms.Events.scrollOrResize);YAHOO.widget.Overlay.windowResizeEvent.unsubscribe(ORBEON.xforms.Events.scrollOrResize);ORBEON.xforms.Globals.topLevelListenerRegistered=false}if(typeof xformsPageUnloadedServer!="undefined"){xformsPageUnloadedServer()}if(typeof xformsPageLoadedServer!="undefined"){xformsPageLoadedServer=undefined}while(a.childNodes.length>0){a.removeChild(a.firstChild)}dojox.html.set(a,f.responseText,{renderStyles:false,executeScripts:true,adjustPaths:true,referencePath:"/"});ORBEON.xforms.Init.document()}}else{if(!e||(e&&e.documentElement&&e.documentElement.tagName.toLowerCase()=="html")){var d=f.responseText.replace(/&lt;/g,"<").replace(/&gt;/g,">").replace(/&amp;/g,"&");e=ORBEON.util.Dom.stringToDom(d)}if(f.responseText!=""&&e&&e.documentElement&&e.documentElement.tagName.indexOf("event-response")!=-1){var c=ORBEON.xforms.Globals.requestForm.id;if(!ORBEON.xforms.Server.keepModelProgressPanelDisplayed(e)){ORBEON.util.Utils.hideModalProgressPanel()}ORBEON.xforms.Server.handleResponseDom(e,c);ORBEON.xforms.Globals.changedIdsRequest={};ORBEON.xforms.Events.ajaxResponseProcessedEvent.fire();ORBEON.xforms.Globals.requestInProgress=false;ORBEON.xforms.Globals.requestDocument="";ORBEON.xforms.Globals.executeEventFunctionQueued++;ORBEON.xforms.Server.executeNextRequest(false)}else{ORBEON.xforms.Server.handleFailure(f)}}},keepModelProgressPanelDisplayed:function(b){if(b&&b.documentElement&&b.documentElement.tagName.indexOf("event-response")!=-1){var a=false;YAHOO.util.Dom.getElementsBy(function(d){var c=ORBEON.util.Utils.getLocalName(d);var e=ORBEON.util.Dom.getAttribute(d,"target")==null;if((c=="submission"||c=="load")){if(ORBEON.util.Dom.getAttribute(d,"target")==null&&ORBEON.util.Dom.getAttribute(d,"show-progress")==null){a=true}}},null,b.documentElement);return a}return false},handleResponseDom:function(responseXML,formID){try{var responseRoot=responseXML.documentElement;var newDynamicStateTriggersReplace=false;var xmlNamespace=null;for(var j=0;j<responseRoot.attributes.length;j++){if(responseRoot.attributes[j].nodeValue==XXFORMS_NAMESPACE_URI){var attrName=responseRoot.attributes[j].name;xmlNamespace=attrName.substr(attrName.indexOf(":")+1);break}}if(ORBEON.xforms.Offline.lastRequestIsTakeOnline){ORBEON.xforms.Offline.lastRequestIsTakeOnline=false;var actionElements=ORBEON.util.Dom.getElementsByName(responseRoot,"action",xmlNamespace);var offlineElements=ORBEON.util.Dom.getElementsByName(actionElements[0],"offline",xmlNamespace);if(offlineElements.length==1){ORBEON.xforms.Offline.isOnline=false}else{ORBEON.xforms.Offline.gearsDatabase.execute("delete from Offline_Forms where url = ?",[window.location.href]).close();ORBEON.xforms.Offline.formStore.remove(window.location.href)}}for(var i=0;i<responseRoot.childNodes.length;i++){if(ORBEON.util.Utils.getLocalName(responseRoot.childNodes[i])=="dynamic-state"){var newDynamicState=ORBEON.util.Dom.getStringValue(responseRoot.childNodes[i]);ORBEON.xforms.Globals.formDynamicState[formID].value=newDynamicState}else{if(ORBEON.util.Utils.getLocalName(responseRoot.childNodes[i])=="static-state"){var newStaticState=ORBEON.util.Dom.getStringValue(responseRoot.childNodes[i]);ORBEON.xforms.Globals.formStaticState[formID].value=newStaticState}else{if(ORBEON.util.Utils.getLocalName(responseRoot.childNodes[i])=="action"){var actionElement=responseRoot.childNodes[i];for(var actionIndex=0;actionIndex<actionElement.childNodes.length;actionIndex++){var actionName=ORBEON.util.Utils.getLocalName(actionElement.childNodes[actionIndex]);switch(actionName){case"control-values":var controlValuesElement=actionElement.childNodes[actionIndex];var copyRepeatTemplateElements=ORBEON.util.Dom.getElementsByName(controlValuesElement,"copy-repeat-template",xmlNamespace);var copyRepeatTemplateElementsLength=copyRepeatTemplateElements.length;for(var j=0;j<copyRepeatTemplateElementsLength;j++){var copyRepeatTemplateElement=copyRepeatTemplateElements[j];var repeatId=ORBEON.util.Dom.getAttribute(copyRepeatTemplateElement,"id");var parentIndexes=ORBEON.util.Dom.getAttribute(copyRepeatTemplateElement,"parent-indexes");var startSuffix=Number(ORBEON.util.Dom.getAttribute(copyRepeatTemplateElement,"start-suffix"));var endSuffix=Number(ORBEON.util.Dom.getAttribute(copyRepeatTemplateElement,"end-suffix"));var templateNodes=new Array();var delimiterTagName=null;var templateRepeatEnd=ORBEON.util.Dom.getElementById("repeat-end-"+repeatId);var templateNode=templateRepeatEnd.previousSibling;var nestedRepeatLevel=0;while(!(nestedRepeatLevel==0&&templateNode.nodeType==ELEMENT_TYPE&&ORBEON.util.Dom.hasClass(templateNode,"xforms-repeat-delimiter"))){var nodeCopy=templateNode.cloneNode(true);if(templateNode.nodeType==ELEMENT_TYPE){delimiterTagName=templateNode.tagName;if(ORBEON.util.Dom.hasClass(templateNode,"xforms-repeat-begin-end")&&templateNode.id.indexOf("repeat-begin-")==0){nestedRepeatLevel--}if(ORBEON.util.Dom.hasClass(templateNode,"xforms-repeat-begin-end")&&templateNode.id.indexOf("repeat-end-")==0){nestedRepeatLevel++}var nodeCopyClasses=nodeCopy.className.split(" ");var nodeCopyNewClasses=new Array();for(var nodeCopyClassIndex=0;nodeCopyClassIndex<nodeCopyClasses.length;nodeCopyClassIndex++){var currentClass=nodeCopyClasses[nodeCopyClassIndex];if(currentClass!="xforms-repeat-template"){nodeCopyNewClasses.push(currentClass)}}nodeCopy.className=nodeCopyNewClasses.join(" ")}templateNodes.push(nodeCopy);templateNode=templateNode.previousSibling}var newDelimiter=document.createElement(delimiterTagName);newDelimiter.className="xforms-repeat-delimiter";templateNodes.push(newDelimiter);templateNodes=templateNodes.reverse();var afterInsertionPoint;if(parentIndexes==""){var repeatEnd=ORBEON.util.Dom.getElementById("repeat-end-"+repeatId);var cursor=repeatEnd.previousSibling;while(!(cursor.nodeType==ELEMENT_TYPE&&ORBEON.util.Dom.hasClass(cursor,"xforms-repeat-delimiter")&&!ORBEON.util.Dom.hasClass(cursor,"xforms-repeat-template"))){cursor=cursor.previousSibling}afterInsertionPoint=cursor}else{var repeatEnd=ORBEON.util.Dom.getElementById("repeat-end-"+ORBEON.util.Utils.appendRepeatSuffix(repeatId,parentIndexes));afterInsertionPoint=repeatEnd}for(var suffix=startSuffix;suffix<=endSuffix;suffix++){var nestedRepeatLevel=0;for(var templateNodeIndex=0;templateNodeIndex<templateNodes.length;templateNodeIndex++){var templateNode=templateNodes[templateNodeIndex];var newTemplateNode;if(startSuffix==endSuffix||suffix==endSuffix){newTemplateNode=templateNodes[templateNodeIndex]}else{newTemplateNode=templateNodes[templateNodeIndex].cloneNode(true)}if(newTemplateNode.nodeType==ELEMENT_TYPE){if(ORBEON.util.Dom.hasClass(newTemplateNode,"xforms-repeat-begin-end")&&templateNode.id.indexOf("repeat-end-")==0){nestedRepeatLevel--}ORBEON.util.Utils.addSuffixToIdsAndRemoveDisabled(newTemplateNode,parentIndexes==""?String(suffix):parentIndexes+XFORMS_SEPARATOR_2+suffix,nestedRepeatLevel);if(ORBEON.util.Dom.hasClass(newTemplateNode,"xforms-repeat-begin-end")&&templateNode.id.indexOf("repeat-begin-")==0){nestedRepeatLevel++}}afterInsertionPoint.parentNode.insertBefore(newTemplateNode,afterInsertionPoint);ORBEON.xforms.Init.insertedElement(newTemplateNode)}}ORBEON.xforms.Init.registerDraggableListenersOnRepeatElements()}var deleteRepeatTemplateElements=ORBEON.util.Dom.getElementsByName(controlValuesElement,"delete-repeat-elements",xmlNamespace);var deleteRepeatTemplateElementsLength=deleteRepeatTemplateElements.length;for(var j=0;j<deleteRepeatTemplateElementsLength;j++){var deleteElementElement=deleteRepeatTemplateElements[j];var deleteId=ORBEON.util.Dom.getAttribute(deleteElementElement,"id");var parentIndexes=ORBEON.util.Dom.getAttribute(deleteElementElement,"parent-indexes");var count=ORBEON.util.Dom.getAttribute(deleteElementElement,"count");var repeatEnd=ORBEON.util.Dom.getElementById("repeat-end-"+ORBEON.util.Utils.appendRepeatSuffix(deleteId,parentIndexes));var lastElementToDelete;lastElementToDelete=repeatEnd.previousSibling;if(parentIndexes==""){while(true){if(lastElementToDelete.nodeType==ELEMENT_TYPE&&ORBEON.util.Dom.hasClass(lastElementToDelete,"xforms-repeat-delimiter")&&!ORBEON.util.Dom.hasClass(lastElementToDelete,"xforms-repeat-template")){break}lastElementToDelete=lastElementToDelete.previousSibling}lastElementToDelete=lastElementToDelete.previousSibling}for(var countIndex=0;countIndex<count;countIndex++){var nestedRepeatLevel=0;while(true){var wasDelimiter=false;if(lastElementToDelete.nodeType==ELEMENT_TYPE){if(ORBEON.util.Dom.hasClass(lastElementToDelete,"xforms-repeat-begin-end")&&lastElementToDelete.id.indexOf("repeat-end-")==0){nestedRepeatLevel++}else{if(ORBEON.util.Dom.hasClass(lastElementToDelete,"xforms-repeat-begin-end")&&lastElementToDelete.id.indexOf("repeat-begin-")==0){nestedRepeatLevel--}else{wasDelimiter=nestedRepeatLevel==0&&ORBEON.util.Dom.hasClass(lastElementToDelete,"xforms-repeat-delimiter")}}}var previous=lastElementToDelete.previousSibling;if(lastElementToDelete.nodeType==ELEMENT_TYPE){YAHOO.util.Dom.getElementsByClassName("xforms-control",null,lastElementToDelete,function(control){ORBEON.xforms.Globals.serverValue[control.id]=null});if(YAHOO.util.Dom.hasClass(lastElementToDelete,"xforms-control")){ORBEON.xforms.Globals.serverValue[lastElementToDelete.id]=null}}lastElementToDelete.parentNode.removeChild(lastElementToDelete);lastElementToDelete=previous;if(wasDelimiter){break}}}}}}var controlsWithUpdatedItemsets={};for(var actionIndex=0;actionIndex<actionElement.childNodes.length;actionIndex++){if(ORBEON.util.Utils.getLocalName(actionElement.childNodes[actionIndex])=="control-values"){var itemsetsElement=actionElement.childNodes[actionIndex];for(var j=0;j<itemsetsElement.childNodes.length;j++){if(ORBEON.util.Utils.getLocalName(itemsetsElement.childNodes[j])=="itemset"){var itemsetElement=itemsetsElement.childNodes[j];var itemsetTree=ORBEON.util.String.eval(ORBEON.util.Dom.getStringValue(itemsetElement));if(itemsetTree==null){itemsetTree=[]}var controlId=ORBEON.util.Dom.getAttribute(itemsetElement,"id");var documentElement=ORBEON.util.Dom.getElementById(controlId);var documentElementClasses=documentElement.className.split(" ");controlsWithUpdatedItemsets[controlId]=true;if(ORBEON.util.Dom.hasClass(documentElement,"xforms-select1-open")){var newValues=new Array();for(var topIndex=0;topIndex<itemsetTree.length;topIndex++){newValues.push(itemsetTree[topIndex][1])}var textfield=ORBEON.util.Dom.getChildElementByIndex(documentElement,0);textfield.actb_keywords=newValues;var lastKeyCode=ORBEON.xforms.Globals.autoCompleteLastKeyCode[documentElement.id];if(lastKeyCode!=null){ORBEON.xforms.Globals.autoCompleteOpen[documentElement.id](lastKeyCode)}}else{if(ORBEON.util.Dom.hasClass(documentElement,"xforms-select-appearance-xxforms-tree")||ORBEON.util.Dom.hasClass(documentElement,"xforms-select1-appearance-xxforms-tree")){var yuiTree=ORBEON.xforms.Globals.treeYui[documentElement.id];var expandedValues=[];var nodes=yuiTree.getNodesByProperty();if(!YAHOO.lang.isNull(nodes)){for(var nodeIndex=0;nodeIndex<nodes.length;nodeIndex++){var node=nodes[nodeIndex];if(node.expanded){expandedValues.push(node.data.value)}}}var yuiRoot=yuiTree.getRoot();yuiTree.removeChildren(yuiRoot);yuiRoot.expand();ORBEON.xforms.Init._initTreeDivFromArray(documentElement,yuiTree,itemsetTree);for(var expandedValueIndex=0;expandedValueIndex<expandedValues.length;expandedValueIndex++){var expandedValue=expandedValues[expandedValueIndex];var nodeToExpand=yuiTree.getNodeByProperty("value",expandedValue);if(nodeToExpand!=null){nodeToExpand.expand()}}}else{if(ORBEON.util.Dom.hasClass(documentElement,"xforms-select1-appearance-compact")||ORBEON.util.Dom.hasClass(documentElement,"xforms-select-appearance-compact")||ORBEON.util.Dom.hasClass(documentElement,"xforms-select1-appearance-minimal")){var select=ORBEON.util.Utils.isNewXHTMLLayout()?documentElement.getElementsByTagName("select")[0]:documentElement;var options=select.options;var selectedValueCount=0;var selectedValues=new Array();for(var k=0;k<options.length;k++){if(options[k].selected){selectedValues[selectedValueCount]=options[k].value;selectedValueCount++}}function generateOption(label,value,clazz,selectedValues){var selected=xformsArrayContains(selectedValues,value);return'<option value="'+ORBEON.util.String.escapeAttribute(value)+'"'+(selected?' selected="selected"':"")+(clazz!=null?' class="'+ORBEON.util.String.escapeAttribute(clazz)+'"':"")+">"+label+"</option>"}var sb=new Array();for(var topIndex=0;topIndex<itemsetTree.length;topIndex++){var itemElement=itemsetTree[topIndex];var itemElementIndex=0;var label=itemElement[itemElementIndex++];var value=itemElement[itemElementIndex++];var clazz=null;if(!YAHOO.lang.isUndefined(itemElement[itemElementIndex])&&!YAHOO.lang.isArray(itemElement[itemElementIndex])){properties=itemElement[itemElementIndex++];if(!YAHOO.lang.isUndefined(properties["class"])){clazz=properties["class"]}}if(itemElement.length>itemElementIndex){sb[sb.length]='<optgroup label="'+ORBEON.util.String.escapeAttribute(label)+'"'+(clazz!=null?' class="'+ORBEON.util.String.escapeAttribute(clazz)+'"':"")+'">';while(itemElementIndex<itemElement.length){var itemElementOption=itemElement[itemElementIndex++];var subItemClazz=!YAHOO.lang.isUndefined(itemElementOption[2])&&!YAHOO.lang.isUndefined(itemElementOption[2]["class"])?itemElementOption[2]["class"]:null;sb[sb.length]=generateOption(itemElementOption[0],itemElementOption[1],subItemClazz,selectedValues)}sb[sb.length]="</optgroup>"}else{sb[sb.length]=generateOption(label,value,clazz,selectedValues)}}if(ORBEON.xforms.Globals.isRenderingEngineTrident){YAHOO.util.Event.removeListener(select,"change");var selectOpeningTag=select.outerHTML.substring(0,select.outerHTML.indexOf(">")+1);select.outerHTML=selectOpeningTag+sb.join("")+"</select>";select=YAHOO.util.Dom.get(controlId);if(ORBEON.util.Utils.isNewXHTMLLayout()){select=documentElement.getElementsByTagName("select")[0]}ORBEON.xforms.Globals.idToElement[controlId]=select}else{select.innerHTML=sb.join("")}}else{var template=ORBEON.util.Dom.hasClass(documentElement,"xforms-select")?ORBEON.util.Dom.getElementById("xforms-select-full-template"):ORBEON.util.Dom.getElementById("xforms-select1-full-template");template=ORBEON.util.Dom.getChildElementByIndex(template,0);var spanContainer=ORBEON.util.Utils.isNewXHTMLLayout()?documentElement.getElementsByTagName("span")[0]:documentElement;var valueToChecked={};while(true){var child=YAHOO.util.Dom.getFirstChild(spanContainer);if(child==null){break}var input=child.getElementsByTagName("input")[0];valueToChecked[input.value]=input.checked;spanContainer.removeChild(child)}var itemIndex=0;for(var k=0;k<itemsetTree.length;k++){var itemElement=itemsetTree[k];var templateClone=template.cloneNode(true);spanContainer.appendChild(templateClone);ORBEON.util.Utils.stringReplace(templateClone,"$xforms-template-label$",itemElement[0]);ORBEON.util.Utils.stringReplace(templateClone,"$xforms-template-value$",itemElement[1]);var itemEffectiveId=ORBEON.util.Utils.appendToEffectiveId(controlId,"$$e"+itemIndex);ORBEON.util.Utils.stringReplace(templateClone,"$xforms-item-effective-id$",itemEffectiveId);ORBEON.util.Utils.stringReplace(templateClone,"$xforms-effective-id$",controlId);if(!YAHOO.lang.isUndefined(itemElement[2])&&!YAHOO.lang.isUndefined(itemElement[2]["class"])){templateClone.className+=" "+itemElement[2]["class"]}var inputCheckboxOrRadio=templateClone.getElementsByTagName("input")[0];if(valueToChecked[itemElement[1]]==true){inputCheckboxOrRadio.checked=true}inputCheckboxOrRadio.removeAttribute("disabled");itemIndex++}}}}if(typeof xformsItemsetUpdatedListener!="undefined"){xformsItemsetUpdatedListener(controlId,itemsetTree)}}}}}var serverEventsIndex=-1;for(var actionIndex=0;actionIndex<actionElement.childNodes.length;actionIndex++){var actionName=ORBEON.util.Utils.getLocalName(actionElement.childNodes[actionIndex]);switch(actionName){case"control-values":var controlValuesElement=actionElement.childNodes[actionIndex];var controlElements=ORBEON.util.Dom.getElementsByName(controlValuesElement,"control",xmlNamespace);var controlElementsLength=controlElements.length;for(var j=0;j<controlElementsLength;j++){var controlElement=controlElements[j];var newControlValue=ORBEON.util.Dom.getStringValue(controlElement);var controlId=ORBEON.util.Dom.getAttribute(controlElement,"id");var staticReadonly=ORBEON.util.Dom.getAttribute(controlElement,"static");var relevant=ORBEON.util.Dom.getAttribute(controlElement,"relevant");var readonly=ORBEON.util.Dom.getAttribute(controlElement,"readonly");var required=ORBEON.util.Dom.getAttribute(controlElement,"required");var classes=ORBEON.util.Dom.getAttribute(controlElement,"class");var type=ORBEON.util.Dom.getAttribute(controlElement,"type");var documentElement=ORBEON.util.Dom.getElementById(controlId);if(documentElement==null){documentElement=ORBEON.util.Dom.getElementById("group-begin-"+controlId);if(documentElement==null){ORBEON.util.Utils.logMessage("Can't find element or iteration with ID '"+controlId+"'")}}var documentElementClasses=documentElement.className.split(" ");var isLeafControl=ORBEON.util.Dom.hasClass(documentElement,"xforms-control");var previousServerValue=ORBEON.xforms.Globals.serverValue[controlId];if(!ORBEON.util.Dom.hasClass(documentElement,"xforms-upload")){ORBEON.xforms.Globals.serverValue[controlId]=newControlValue}var isStaticReadonly=ORBEON.util.Dom.hasClass(documentElement,"xforms-static");if(!isStaticReadonly&&staticReadonly=="true"){if(isLeafControl){var parentElement=documentElement.parentNode;var newDocumentElement=document.createElement("span");newDocumentElement.setAttribute("id",controlId);newDocumentElement.className=documentElementClasses.join(" ")+" xforms-static";parentElement.replaceChild(newDocumentElement,documentElement);var cachedElement=ORBEON.xforms.Globals.idToElement[controlId];if(cachedElement!=null){ORBEON.xforms.Globals.idToElement[controlId]=newDocumentElement}var alertElement=ORBEON.xforms.Controls._getControlLHHA(newDocumentElement,"alert");if(alertElement!=null){parentElement.removeChild(alertElement)}var hintElement=ORBEON.xforms.Controls._getControlLHHA(newDocumentElement,"hint");if(hintElement!=null){parentElement.removeChild(hintElement)}documentElement=newDocumentElement}else{ORBEON.util.Dom.addClass(documentElement,"xforms-static")}isStaticReadonly=true;documentElementClasses=documentElement.className.split(" ")}if(relevant!=null){var isRelevant=relevant=="true";ORBEON.xforms.Controls.setRelevant(documentElement,isRelevant);if(ORBEON.util.Dom.hasClass(documentElement,"xforms-textarea-appearance-xxforms-autosize")){ORBEON.xforms.Controls.autosizeTextarea(documentElement)}}if(required!=null){var isRequired=required=="true";if(isRequired){ORBEON.util.Dom.addClass(documentElement,"xforms-required")}else{ORBEON.util.Dom.removeClass(documentElement,"xforms-required")}}var recreatedInput=false;if(type!=null&&ORBEON.util.Dom.hasClass(documentElement,"xforms-input")){var isDateType=false,isTimeType=false,isDateTimeType=false,isBooleanType=false,isStringType=false;if(type=="{http://www.w3.org/2001/XMLSchema}date"||type=="{http://www.w3.org/2002/xforms}date"){isDateType=true}else{if(type=="{http://www.w3.org/2001/XMLSchema}time"||type=="{http://www.w3.org/2002/xforms}time"){isTimeType=true}else{if(type=="{http://www.w3.org/2001/XMLSchema}dateTime"||type=="{http://www.w3.org/2002/xforms}dateTime"){isDateTimeType=true}else{if(type=="{http://www.w3.org/2001/XMLSchema}boolean"||type=="{http://www.w3.org/2002/xforms}boolean"){isBooleanType=true}else{isStringType=true}}}}var isRecognizedType=isDateType||isTimeType||isDateTimeType||isBooleanType||isStringType;recreatedInput=true;ORBEON.util.Dom.removeClass(documentElement,"xforms-type-string");ORBEON.util.Dom.removeClass(documentElement,"xforms-type-date");ORBEON.util.Dom.removeClass(documentElement,"xforms-type-time");ORBEON.util.Dom.removeClass(documentElement,"xforms-type-dateTime");ORBEON.util.Dom.removeClass(documentElement,"xforms-type-boolean");ORBEON.util.Dom.removeClass(documentElement,"xforms-incremental");var isMinimal=ORBEON.util.Dom.hasClass(documentElement,"xforms-input-appearance-minimal");var lastLabelPosition=-1;var childElements=YAHOO.util.Dom.getChildren(documentElement);for(var childIndex=0;childIndex<childElements.length;childIndex++){var childElement=childElements[childIndex];var childTagName=childElement.tagName.toLowerCase();if(!YAHOO.util.Dom.hasClass(childElement,"xforms-label")&&!YAHOO.util.Dom.hasClass(childElement,"xforms-help")&&!YAHOO.util.Dom.hasClass(childElement,"xforms-hint")&&!YAHOO.util.Dom.hasClass(childElement,"xforms-alert")&&!YAHOO.util.Dom.hasClass(childElement,"xforms-help-image")){documentElement.removeChild(childElement);if(lastLabelPosition==-1){lastLabelPosition=childIndex-1}}}function insertIntoDocument(nodes){if(ORBEON.util.Utils.isNewXHTMLLayout()){if(YAHOO.util.Dom.getChildren(documentElement).length==0){for(var nodeIndex=0;nodeIndex<nodes.length;nodeIndex++){documentElement.appendChild(nodes[nodeIndex])}}else{if(lastLabelPosition==-1){var firstChild=YAHOO.util.Dom.getFirstChild(documentElement);for(var nodeIndex=nodes.length-1;nodeIndex>=0;nodeIndex--){YAHOO.util.Dom.insertBefore(nodes[nodeIndex],firstChild)}}else{for(var nodeIndex=0;nodeIndex<nodes.length;nodeIndex++){YAHOO.util.Dom.insertAfter(nodes[nodeIndex],childElements[lastLabelPosition])}}}}else{for(var nodeIndex=0;nodeIndex<nodes.length;nodeIndex++){documentElement.appendChild(nodes[nodeIndex])}}}function createInput(typeClassName,inputIndex){var newInputElement=document.createElement("input");newInputElement.setAttribute("type","text");newInputElement.className="xforms-input-input "+typeClassName;newInputElement.name=ORBEON.util.Utils.appendToEffectiveId(controlId,"$xforms-input-"+inputIndex);newInputElement.id=newInputElement.name;return newInputElement}var inputLabelElement=ORBEON.xforms.Controls._getControlLHHA(documentElement,"label");if(isStringType){var newStringInput=createInput("xforms-type-string",1);insertIntoDocument([newStringInput]);ORBEON.util.Dom.addClass(documentElement,"xforms-type-string");if(inputLabelElement!=null){inputLabelElement.htmlFor=newStringInput.id}}else{if(isDateType&&!isMinimal){var newDateInput=createInput("xforms-type-date",1);insertIntoDocument([newDateInput]);ORBEON.util.Dom.addClass(documentElement,"xforms-type-date");if(inputLabelElement!=null){inputLabelElement.htmlFor=newDateInput.id}}else{if(isDateType&&isMinimal){var image=document.createElement("img");image.setAttribute("src",ORBEON.xforms.Globals.resourcesBaseURL[formID]+"/ops/images/xforms/calendar.png");image.className="xforms-input-input xforms-type-date xforms-input-appearance-minimal";insertIntoDocument([image]);ORBEON.util.Dom.addClass(documentElement,"xforms-type-date");if(inputLabelElement!=null){inputLabelElement.htmlFor=documentElement.id}}else{if(isTimeType){var newTimeInput=createInput("xforms-type-time",1);insertIntoDocument([newTimeInput]);ORBEON.util.Dom.addClass(documentElement,"xforms-type-time");if(inputLabelElement!=null){inputLabelElement.htmlFor=newTimeInput.id}}else{if(isDateTimeType){var newDateTimeInput=createInput("xforms-type-date",1);insertIntoDocument([newDateTimeInput,createInput("xforms-type-time",2)]);ORBEON.util.Dom.addClass(documentElement,"xforms-type-dateTime");if(inputLabelElement!=null){inputLabelElement.htmlFor=newDateTimeInput.id}}else{if(isBooleanType){var booleanTemplate=ORBEON.util.Dom.getElementById("xforms-select-full-template");booleanTemplate=ORBEON.util.Dom.getChildElementByIndex(booleanTemplate,0);var booleanTemplateClone=booleanTemplate.cloneNode(true);var templateLabelElement=booleanTemplateClone.getElementsByTagName("label")[0];var templateInputElement=booleanTemplateClone.getElementsByTagName("input")[0];templateLabelElement.parentNode.replaceChild(templateInputElement,templateLabelElement);var booleanInput=ORBEON.util.Dom.getElementByTagName(booleanTemplateClone,"input");booleanInput.removeAttribute("disabled");insertIntoDocument([booleanTemplateClone]);ORBEON.util.Utils.stringReplace(booleanTemplateClone,"$xforms-template-value$","true");var booleanEffectiveId=ORBEON.util.Utils.appendToEffectiveId(controlId,"$$e0");ORBEON.util.Utils.stringReplace(booleanTemplateClone,"$xforms-item-effective-id$",booleanEffectiveId);ORBEON.util.Utils.stringReplace(booleanTemplateClone,"$xforms-effective-id$",controlId);ORBEON.util.Dom.addClass(documentElement,"xforms-type-boolean");ORBEON.util.Dom.addClass(documentElement,"xforms-input-appearance-minimal");ORBEON.util.Dom.addClass(documentElement,"xforms-incremental");if(inputLabelElement!=null){inputLabelElement.htmlFor=booleanEffectiveId}}}}}}}}else{if(type!=null){var typePrefix="xforms-type-";var classesArray=documentElement.className.split(" ");for(var classIndex=0;classIndex<classesArray.length;classIndex++){var currentClass=classesArray[classIndex];if(currentClass.indexOf(typePrefix)==0){ORBEON.util.Dom.removeClass(documentElement,currentClass)}}var typeResult=/}(.*)/.exec(type);if(typeResult!=null&&typeResult.length>=2){ORBEON.util.Dom.addClass(documentElement,typePrefix+typeResult[1])}}}if(readonly!=null&&!isStaticReadonly){ORBEON.xforms.Controls.setReadonly(documentElement,readonly=="true")}if(classes!=null){var classesArray=classes.split(" ");for(var classIndex=0;classIndex<classesArray.length;classIndex++){var currentClass=classesArray[classIndex];if(currentClass.charAt(0)=="-"){ORBEON.util.Dom.removeClass(documentElement,currentClass.substring(1))}else{ORBEON.util.Dom.addClass(documentElement,currentClass.charAt(0)=="+"?currentClass.substring(1):currentClass)}}}if(isLeafControl){if(ORBEON.util.Dom.hasClass(documentElement,"xforms-upload")){var state=ORBEON.util.Dom.getAttribute(controlElement,"state");var filename=ORBEON.util.Dom.getAttribute(controlElement,"filename");var mediatype=ORBEON.util.Dom.getAttribute(controlElement,"mediatype");var size=ORBEON.util.Dom.getAttribute(controlElement,"size");ORBEON.xforms.Controls.setCurrentValue(documentElement,newControlValue,state,filename,mediatype,size)}else{if(ORBEON.util.Dom.hasClass(documentElement,"xforms-output")||ORBEON.util.Dom.hasClass(documentElement,"xforms-static")){ORBEON.xforms.Controls.setCurrentValue(documentElement,newControlValue)}else{if(ORBEON.util.Dom.hasClass(documentElement,"xforms-trigger")||ORBEON.util.Dom.hasClass(documentElement,"xforms-submit")){}else{var currentValue=ORBEON.xforms.Controls.getCurrentValue(documentElement);if(currentValue!=null){previousServerValue=ORBEON.util.String.normalizeSerializedHTML(previousServerValue);currentValue=ORBEON.util.String.normalizeSerializedHTML(currentValue);newControlValue=ORBEON.util.String.normalizeSerializedHTML(newControlValue);var isInput=ORBEON.util.Dom.hasClass(documentElement,"xforms-input");var inputSize=isInput?ORBEON.util.Dom.getAttribute(controlElement,"size"):null;var inputLength=isInput?ORBEON.util.Dom.getAttribute(controlElement,"maxlength"):null;var inputAutocomplete=isInput?ORBEON.util.Dom.getAttribute(controlElement,"autocomplete"):null;var isTextarea=ORBEON.util.Dom.hasClass(documentElement,"xforms-textarea");var textareaMaxlength=isTextarea?ORBEON.util.Dom.getAttribute(controlElement,"maxlength"):null;var textareaCols=isTextarea?ORBEON.util.Dom.getAttribute(controlElement,"cols"):null;var textareaRows=isTextarea?ORBEON.util.Dom.getAttribute(controlElement,"rows"):null;var doUpdate=recreatedInput||controlsWithUpdatedItemsets[controlId]||(currentValue!=newControlValue&&(previousServerValue==null||currentValue==previousServerValue))||(isInput&&(inputSize!=null||inputLength!=null||inputAutocomplete!=null))||(isTextarea&&(textareaMaxlength!=null||textareaCols!=null||textareaRows!=null));if(doUpdate){if(isInput){ORBEON.xforms.Controls.setCurrentValue(documentElement,newControlValue,inputSize,inputLength,inputAutocomplete)}else{if(isTextarea&&ORBEON.util.Dom.hasClass(documentElement,"xforms-mediatype-text-html")){ORBEON.xforms.Controls.setCurrentValue(documentElement,newControlValue)}else{if(isTextarea){ORBEON.xforms.Controls.setCurrentValue(documentElement,newControlValue,textareaMaxlength,textareaCols,textareaRows)}else{ORBEON.xforms.Controls.setCurrentValue(documentElement,newControlValue)}}}ORBEON.xforms.Globals.serverValue[documentElement.id]=ORBEON.xforms.Controls.getCurrentValue(documentElement)}}}}}if(typeof xformsValueChangedListener!="undefined"){xformsValueChangedListener(controlId,newControlValue)}if(ORBEON.util.Dom.hasClass(documentElement,"xforms-output")&&relevant==null){ORBEON.util.Dom.addClass(documentElement,"xforms-visited");if(ORBEON.util.Dom.hasClass(documentElement,"xforms-invalid")){ORBEON.util.Dom.addClass(documentElement,"xforms-invalid-visited")}}}var isRequiredEmpty;if(!isStaticReadonly&&!YAHOO.util.Dom.hasClass(documentElement,"xforms-group")){isRequiredEmpty=ORBEON.xforms.Controls.updateRequiredEmpty(documentElement,newControlValue)}else{isRequiredEmpty=false}var newLabel=ORBEON.util.Dom.getAttribute(controlElement,"label");if(newLabel!=null){ORBEON.xforms.Controls.setLabelMessage(documentElement,newLabel)}var newHint=ORBEON.util.Dom.getAttribute(controlElement,"hint");if(newHint!=null){ORBEON.xforms.Controls.setHintMessage(documentElement,newHint)}var newHelp=ORBEON.util.Dom.getAttribute(controlElement,"help");if(newHelp!=null){ORBEON.xforms.Controls.setHelpMessage(documentElement,newHelp)}var newAlert=ORBEON.util.Dom.getAttribute(controlElement,"alert");if(newAlert!=null){ORBEON.xforms.Controls.setAlertMessage(documentElement,newAlert)}var newValid=ORBEON.util.Dom.getAttribute(controlElement,"valid");if(newValid!=null){ORBEON.xforms.Controls.setValid(documentElement,newValid)}if(ORBEON.util.Dom.hasClass(documentElement,"xforms-textarea")&&ORBEON.util.Dom.hasClass(documentElement,"xforms-mediatype-text-html")&&ORBEON.util.Properties.htmlEditor.get()=="fck"){ORBEON.xforms.Controls.updateHTMLAreaClasses(documentElement)}}var innerElements=ORBEON.util.Dom.getElementsByName(controlValuesElement,"inner-html",xmlNamespace);var innerElementsLength=innerElements.length;for(var j=0;j<innerElementsLength;j++){var innerElement=innerElements[j];var innerHTML=ORBEON.util.Dom.getStringValue(innerElement);var controlId=ORBEON.util.Dom.getAttribute(innerElement,"id");var documentElement=document.getElementById(controlId);if(documentElement!=null){documentElement.innerHTML=innerHTML}else{function insertBetweenDelimiters(prefix){var SPECIAL_ELEMENTS={table:{opening:"<table>",closing:"</table>",level:1},thead:{opening:"<table><thead>",closing:"</thead></table>",level:2},tbody:{opening:"<table><tbody>",closing:"</tbody></table>",level:2},tr:{opening:"<table><tr>",closing:"</tr></table>",level:2}};var delimiterBegin=document.getElementById(prefix+"-begin-"+controlId);if(delimiterBegin!=null){while(delimiterBegin.nextSibling.nodeType!=ELEMENT_TYPE||delimiterBegin.nextSibling.id!=prefix+"-end-"+controlId){delimiterBegin.parentNode.removeChild(delimiterBegin.nextSibling)}var delimiterEnd=delimiterBegin.nextSibling;var specialElementSpec=SPECIAL_ELEMENTS[delimiterBegin.parentNode.tagName.toLowerCase()];var dummyElement=document.createElement(specialElementSpec==null?delimiterBegin.parentNode.tagName:"div");dummyElement.innerHTML=specialElementSpec==null?innerHTML:specialElementSpec.opening+innerHTML+specialElementSpec.closing;var dummyParent=specialElementSpec==null?dummyElement:specialElementSpec.level==1?YAHOO.util.Dom.getFirstChild(dummyElement):specialElementSpec.level==2?YAHOO.util.Dom.getFirstChild(YAHOO.util.Dom.getFirstChild(dummyElement)):null;while(dummyParent.firstChild!=null){YAHOO.util.Dom.insertBefore(dummyParent.firstChild,delimiterEnd)}return true}else{return false}}if(!insertBetweenDelimiters("group")){if(!insertBetweenDelimiters("repeat")){insertBetweenDelimiters("xforms-case")}}}if(!YAHOO.util.Dom.inDocument(ORBEON.xforms.Globals.currentFocusControlElement,document)){var focusControl=document.getElementById(ORBEON.xforms.Globals.currentFocusControlId);if(focusControl!=null){ORBEON.xforms.Controls.setFocus(focusControl)}}}var attributeElements=ORBEON.util.Dom.getElementsByName(controlValuesElement,"attribute",xmlNamespace);var attributeElementslength=attributeElements.length;for(var j=0;j<attributeElementslength;j++){var attributeElement=attributeElements[j];var newAttributeValue=ORBEON.util.Dom.getStringValue(attributeElement);var forAttribute=ORBEON.util.Dom.getAttribute(attributeElement,"for");var nameAttribute=ORBEON.util.Dom.getAttribute(attributeElement,"name");var htmlElement=ORBEON.util.Dom.getElementById(forAttribute);if(htmlElement!=null){ORBEON.util.Dom.setAttribute(htmlElement,nameAttribute,newAttributeValue)}}var textElements=ORBEON.util.Dom.getElementsByName(controlValuesElement,"text",xmlNamespace);var textElementslength=textElements.length;for(var j=0;j<textElementslength;j++){var textElement=textElements[j];var newTextValue=ORBEON.util.Dom.getStringValue(textElement);var forAttribute=ORBEON.util.Dom.getAttribute(textElement,"for");var htmlElement=ORBEON.util.Dom.getElementById(forAttribute);if(htmlElement!=null&&htmlElement.tagName.toLowerCase()=="title"){document.title=newTextValue}}var repeatIterationElements=ORBEON.util.Dom.getElementsByName(controlValuesElement,"repeat-iteration",xmlNamespace);var repeatIterationElementslength=repeatIterationElements.length;for(var j=0;j<repeatIterationElementslength;j++){var repeatIterationElement=repeatIterationElements[j];var repeatId=ORBEON.util.Dom.getAttribute(repeatIterationElement,"id");var iteration=ORBEON.util.Dom.getAttribute(repeatIterationElement,"iteration");var relevant=ORBEON.util.Dom.getAttribute(repeatIterationElement,"relevant");if(relevant!=null){ORBEON.xforms.Controls.setRepeatIterationRelevance(repeatId,iteration,relevant=="true"?true:false)}}var divsElements=ORBEON.util.Dom.getElementsByName(controlValuesElement,"div",xmlNamespace);var divElementslength=divsElements.length;for(var j=0;j<divElementslength;j++){var divElement=divsElements[j];var controlId=ORBEON.util.Dom.getAttribute(divElement,"id");var visible=ORBEON.util.Dom.getAttribute(divElement,"visibility")=="visible";var neighbor=ORBEON.util.Dom.getAttribute(divElement,"neighbor");var yuiDialog=ORBEON.xforms.Globals.dialogs[controlId];var children=new Array();if(yuiDialog==null){var caseBeginId="xforms-case-begin-"+controlId;var caseBegin=ORBEON.util.Dom.getElementById(caseBeginId);var caseBeginParent=caseBegin.parentNode;var foundCaseBegin=false;for(var childId=0;caseBeginParent.childNodes.length;childId++){var cursor=caseBeginParent.childNodes[childId];if(!foundCaseBegin){if(cursor.id==caseBegin.id){foundCaseBegin=true}else{continue}}if(cursor.nodeType==ELEMENT_TYPE){if(cursor.id=="xforms-case-end-"+controlId){break}if(visible){ORBEON.util.Dom.addClass(cursor,"xforms-case-selected");ORBEON.util.Dom.removeClass(cursor,"xforms-case-deselected");ORBEON.util.Dom.removeClass(cursor,"xforms-case-deselected-subsequent");ORBEON.util.Dom.nudgeAferDelay(cursor)}else{ORBEON.util.Dom.addClass(cursor,"xforms-case-deselected-subsequent");ORBEON.util.Dom.removeClass(cursor,"xforms-case-selected")}children[children.length]=cursor}}}else{if(visible){ORBEON.xforms.Controls.showDialog(controlId,neighbor);children[0]=ORBEON.util.Dom.getElementById(controlId)}else{ORBEON.xforms.Globals.maskDialogCloseEvents=true;yuiDialog.hide();ORBEON.xforms.Globals.maskDialogCloseEvents=false;yuiDialog.element.style.display="none"}}if(children.length>0&&ORBEON.xforms.Globals.isRenderingEngineGecko&&!ORBEON.xforms.Globals.isFF3OrNewer&&ORBEON.xforms.Globals.htmlAreaNames.length>0){for(var childIndex=0;childIndex<children.length;childIndex++){var child=children[childIndex];var textHTMLElements=YAHOO.util.Dom.getElementsByClassName("xforms-mediatype-text-html",null,child);if(textHTMLElements!=null&&textHTMLElements.length>0){for(var htmlElementIndex=0;htmlElementIndex<textHTMLElements.length;htmlElementIndex++){var htmlElement=textHTMLElements[htmlElementIndex];if(htmlElement.name!=null&&htmlElement.name!=""&&ORBEON.util.Dom.hasClass(htmlElement,"xforms-textarea")){var editor=FCKeditorAPI.GetInstance(htmlElement.name);if(editor!=null){try{editor.EditorDocument.designMode="on"}catch(e){}}}}}}}}break;case"repeat-indexes":var repeatIndexesElement=actionElement.childNodes[actionIndex];var newRepeatIndexes=new Array();for(var j=0;j<repeatIndexesElement.childNodes.length;j++){if(ORBEON.util.Utils.getLocalName(repeatIndexesElement.childNodes[j])=="repeat-index"){var repeatIndexElement=repeatIndexesElement.childNodes[j];var repeatId=ORBEON.util.Dom.getAttribute(repeatIndexElement,"id");var newIndex=ORBEON.util.Dom.getAttribute(repeatIndexElement,"new-index");newRepeatIndexes[repeatId]=newIndex}}for(var repeatId in newRepeatIndexes){if(typeof repeatId=="string"){var children=ORBEON.xforms.Globals.repeatTreeParentToAllChildren[repeatId];if(children!=null){for(var childIndex in children){var child=children[childIndex];if(!newRepeatIndexes[child]){newRepeatIndexes[child]=ORBEON.xforms.Globals.repeatIndexes[child]}}}}}for(var repeatId in newRepeatIndexes){if(typeof repeatId=="string"){var oldIndex=ORBEON.xforms.Globals.repeatIndexes[repeatId];if(typeof oldIndex=="string"&&oldIndex!=0){var oldItemDelimiter=ORBEON.util.Utils.findRepeatDelimiter(repeatId,oldIndex);if(oldItemDelimiter!=null){var cursor=oldItemDelimiter.nextSibling;while(cursor.nodeType!=ELEMENT_TYPE||(!YAHOO.util.Dom.hasClass(cursor,"xforms-repeat-delimiter")&&!YAHOO.util.Dom.hasClass(cursor,"xforms-repeat-begin-end"))){if(cursor.nodeType==ELEMENT_TYPE){YAHOO.util.Dom.removeClass(cursor,ORBEON.util.Utils.getClassForRepeatId(repeatId))}cursor=cursor.nextSibling}}}}}for(var repeatId in newRepeatIndexes){var newIndex=newRepeatIndexes[repeatId];ORBEON.xforms.Globals.repeatIndexes[repeatId]=newIndex}for(var repeatId in newRepeatIndexes){if(typeof repeatId=="string"){var newIndex=newRepeatIndexes[repeatId];if(typeof newIndex=="string"&&newIndex!=0){var newItemDelimiter=ORBEON.util.Utils.findRepeatDelimiter(repeatId,newIndex);var cursor=newItemDelimiter.nextSibling;while(cursor.nodeType!=ELEMENT_TYPE||(!YAHOO.util.Dom.hasClass(cursor,"xforms-repeat-delimiter")&&!YAHOO.util.Dom.hasClass(cursor,"xforms-repeat-begin-end"))){if(cursor.nodeType==ELEMENT_TYPE){YAHOO.util.Dom.addClass(cursor,ORBEON.util.Utils.getClassForRepeatId(repeatId))}cursor=cursor.nextSibling}}}}break;case"server-events":var serverEventsElement=actionElement.childNodes[actionIndex];var delay=ORBEON.util.Dom.getAttribute(serverEventsElement,"delay");var showProgress=ORBEON.util.Dom.getAttribute(serverEventsElement,"show-progress");showProgress=YAHOO.lang.isNull(showProgress)||showProgress=="true";var discardable=ORBEON.util.Dom.getAttribute(serverEventsElement,"discardable");discardable=!YAHOO.lang.isNull(discardable)&discardable=="true";var progressMessage=ORBEON.util.Dom.getAttribute(serverEventsElement,"progress-message");if(delay==null){serverEventsIndex=actionIndex}else{var serverEvents=ORBEON.util.Dom.getStringValue(serverEventsElement);ORBEON.xforms.Server.createDelayedServerEvent(serverEvents,delay,showProgress,progressMessage,discardable,formID)}break;case"submission":var submissionElement=actionElement.childNodes[actionIndex];var showProgress=ORBEON.util.Dom.getAttribute(submissionElement,"show-progress");var replace=ORBEON.util.Dom.getAttribute(submissionElement,"replace");var target=ORBEON.util.Dom.getAttribute(submissionElement,"target");if(replace==null){replace="all"}if(serverEventsIndex!=-1){ORBEON.xforms.Globals.formServerEvents[formID].value=ORBEON.util.Dom.getStringValue(actionElement.childNodes[serverEventsIndex])}else{ORBEON.xforms.Globals.formServerEvents[formID].value=""}var requestForm=ORBEON.util.Dom.getElementById(formID);if(replace=="all"){if(showProgress!="false"){newDynamicStateTriggersReplace=true}if(requestForm.action.indexOf("xforms-server-submit")==-1){requestForm.action=window.location.href}if(target==null){requestForm.removeAttribute("target")}else{requestForm.target=target}requestForm.submit()}else{YAHOO.util.Connect.setForm(requestForm,true,true);var callback={upload:ORBEON.xforms.Server.handleUploadResponse,failure:ORBEON.xforms.Server.handleFailure};YAHOO.util.Connect.asyncRequest("POST",ORBEON.xforms.Globals.xformsServerURL[formID],callback)}ORBEON.xforms.Globals.formServerEvents[formID].value="";break;case"message":var messageElement=actionElement.childNodes[actionIndex];ORBEON.xforms.action.Message.execute(messageElement);break;case"load":var loadElement=actionElement.childNodes[actionIndex];var resource=ORBEON.util.Dom.getAttribute(loadElement,"resource");var show=ORBEON.util.Dom.getAttribute(loadElement,"show");var target=ORBEON.util.Dom.getAttribute(loadElement,"target");var showProcess=ORBEON.util.Dom.getAttribute(loadElement,"show-progress");if(show=="replace"){if(target==null){if(resource.charAt(0)!="#"&&showProcess!="false"){newDynamicStateTriggersReplace=true}try{window.location.href=resource}catch(e){}}else{window.open(resource,target)}}else{window.open(resource,"_blank")}break;case"setfocus":var setfocusElement=actionElement.childNodes[actionIndex];var controlId=ORBEON.util.Dom.getAttribute(setfocusElement,"control-id");ORBEON.xforms.Controls.setFocus(controlId);break;case"script":var scriptElement=actionElement.childNodes[actionIndex];var functionName=ORBEON.util.Dom.getAttribute(scriptElement,"name");var targetId=ORBEON.util.Dom.getAttribute(scriptElement,"target-id");var observerId=ORBEON.util.Dom.getAttribute(scriptElement,"observer-id");ORBEON.xforms.Server.callUserScript(functionName,targetId,observerId);break;case"help":var helpElement=actionElement.childNodes[actionIndex];var controlId=ORBEON.util.Dom.getAttribute(helpElement,"control-id");var control=ORBEON.util.Dom.getElementById(controlId);ORBEON.xforms.Controls.showHelp(control);break;case"offline":var offlineElement=actionElement.childNodes[actionIndex];var eventsElements=ORBEON.util.Dom.getElementsByName(offlineElement,"events",xmlNamespace);var mappingsElements=ORBEON.util.Dom.getElementsByName(offlineElement,"mappings",xmlNamespace);if(eventsElements.length!=0&&mappingsElements.length!=0){var replayResponse=ORBEON.util.Dom.getStringValue(eventsElements[0]);var mappings=ORBEON.util.Dom.getStringValue(mappingsElements[0]);ORBEON.xforms.Offline.takeOffline(replayResponse,formID,mappings)}}}}}}}if(newDynamicStateTriggersReplace){xformsDisplayIndicator("loading");ORBEON.xforms.Globals.loadingOtherPage=true}}catch(e){ORBEON.xforms.Server.exceptionWhenTalkingToServer(e,formID);throw e}},callUserScript:function(functionName,targetId,observerId){function getElement(id){var element=YAHOO.util.Dom.get(id);if(element==null){element=YAHOO.util.Dom.get("repeat-begin-"+id);if(element==null){var separatorPosition=Math.max(id.lastIndexOf(XFORMS_SEPARATOR_1),id.lastIndexOf(XFORMS_SEPARATOR_2));if(separatorPosition!=-1){var repeatID=id.substring(0,separatorPosition);var iteration=id.substring(separatorPosition+1);element=ORBEON.util.Utils.findRepeatDelimiter(repeatID,iteration);if(element==null){element=YAHOO.util.Dom.get("repeat-begin-"+id)}}}}return element}var targetElement=getElement(targetId);var observer=getElement(observerId);var event={target:targetElement};var theFunction=eval(functionName);theFunction.call(observer,event)}};YAHOO.util.DDM.mode=YAHOO.util.DDM.INTERSECT;ORBEON.xforms.DnD={DraggableItem:function(d,a,c){ORBEON.xforms.DnD.DraggableItem.superclass.constructor.call(this,d,d.tagName,c);YAHOO.util.Dom.setStyle(d,"cursor","move");var b=this.getDragEl();if(!YAHOO.util.Dom.hasClass(b.parentNode,"xforms-form")){var e=ORBEON.xforms.Controls.getForm(d);e.appendChild(b)}}};YAHOO.extend(ORBEON.xforms.DnD.DraggableItem,YAHOO.util.DDProxy,{_startPosition:-1,_getPosition:function(b){var c=b;var a=0;while(true){if(YAHOO.util.Dom.hasClass(c,"xforms-repeat-begin-end")){break}if(YAHOO.util.Dom.hasClass(c,"xforms-repeat-delimiter")){a++}c=YAHOO.util.Dom.getPreviousSibling(c)}return a},_renumberIDsWorker:function(e,f,d){var c=e.id.indexOf(XFORMS_SEPARATOR_1);if(c!=-1){var a=e.id.substring(c+1).split(XFORMS_SEPARATOR_2);a[f]=d;var b=e.id.substring(0,c)+XFORMS_SEPARATOR_1+a.join(XFORMS_SEPARATOR_2);e.id=b}YAHOO.util.Dom.batch(YAHOO.util.Dom.getChildren(e),function(g){this._renumberIDsWorker(g,f,d)},this,true)},_renumberIDs:function(f){var e=0;var g=f;var b=g.indexOf(XFORMS_SEPARATOR_1);if(b!=-1){g=g.substring(0,b)}while(true){var a=ORBEON.xforms.Globals.repeatTreeChildToParent[g];if(!a){break}e++;g=a}var c=YAHOO.util.Dom.get("repeat-begin-"+f);var d=0;while(true){c=YAHOO.util.Dom.getNextSibling(c);if(c==null||YAHOO.util.Dom.hasClass(c,"xforms-repeat-begin-end")){break}if(!YAHOO.util.Dom.hasClass(c,"xforms-repeat-delimiter")&&!YAHOO.util.Dom.hasClass(c,"xforms-repeat-template")){d++;this._renumberIDsWorker(c,e,d)}}},startDrag:function(a,f){var c=this.getDragEl();var b=this.getEl();this._startPosition=this._getPosition(b);var e=YAHOO.util.Dom.getElementsByClassName("xforms-repeat-begin-end",null,b.parentNode)[0].id;this.sourceControlID=e.substring(13);YAHOO.util.Dom.setStyle(c,"opacity",0.67);YAHOO.util.Dom.setStyle(c,"width",parseInt(c.style.width)+2+"px");YAHOO.util.Dom.setStyle(c,"height","auto");var d=b.tagName.toLowerCase();c.innerHTML=d=="tr"?"<table'><tr>"+b.innerHTML+"</tr></table>":b.innerHTML;c.className=b.className;YAHOO.util.Dom.setStyle(b,"visibility","hidden")},onDrag:function(a){var b=YAHOO.util.Event.getPageY(a);if(b<this.lastY){this.goingUp=true}else{if(b>this.lastY){this.goingUp=false}}this.lastY=b},onDragOver:function(g,h){var a=this.getEl();var b=YAHOO.util.Dom.getPreviousSibling(a);var f=YAHOO.util.Dom.get(h)[0];if(ORBEON.util.Dom.hasClass(a,"xforms-dnd")&&a.nodeName.toLowerCase()==f.getEl().nodeName.toLowerCase()){var c=f.getEl().parentNode;this.overElement=f.getEl();c.removeChild(b);c.removeChild(a);if(this.goingUp){var d=this.overElement;c.insertBefore(a,d);c.insertBefore(b,d)}else{var d=YAHOO.util.Dom.getNextSibling(this.overElement);c.insertBefore(b,d);c.insertBefore(a,d)}YAHOO.util.DragDropMgr.refreshCache()}},endDrag:function(h){var a=this.getEl();var c=this.getDragEl();var b=c.id;var j=this.id;YAHOO.util.Dom.setStyle(b,"visibility","hidden");YAHOO.util.Dom.setStyle(j,"visibility","");var g=this._getPosition(a);if(g!=this._startPosition){var f=ORBEON.xforms.Controls.getForm(a);var d=new ORBEON.xforms.Server.Event(f,this.sourceControlID,null,null,"xxforms-dnd",null,null,null,null,null,["dnd-start",this._startPosition,"dnd-end",g]);this._renumberIDs(this.sourceControlID);ORBEON.xforms.Server.fireEvents([d],false)}}});ORBEON.xforms.Offline={isOnline:true,lastRequestIsTakeOnline:false,hasGears:false,gearsDatabase:null,formStore:null,memoryOfflineEvents:[],mips:{},variables:{},controlIDToVariableName:{},encryptionKey:null,controlValues:null,typeRegExps:{"{http://www.w3.org/2001/XMLSchema}decimal":new RegExp("^[+-]?[0-9]+(\\.[0-9]+)?$","g"),"{http://www.w3.org/2001/XMLSchema}integer":new RegExp("^[+-]?[0-9]+$","g")},isGearsEnabled:function(){try{var a=typeof GearsFactory!="undefined"?new GearsFactory():new ActiveXObject("Gears.Factory")}catch(b){return false}},init:function(){if(window.google&&google.gears){return}var a=null;if(typeof GearsFactory!="undefined"){a=new GearsFactory()}else{try{a=new ActiveXObject("Gears.Factory");if(a.getBuildInfo().indexOf("ie_mobile")!=-1){a.privateSetGlobalObject(this)}}catch(d){if((typeof navigator.mimeTypes!="undefined")&&navigator.mimeTypes["application/x-googlegears"]){a=document.createElement("object");a.style.display="none";a.width=0;a.height=0;a.type="application/x-googlegears";document.documentElement.appendChild(a)}}}if(!a){return}if(!window.google){google={}}if(!google.gears){google.gears={factory:a}}ORBEON.xforms.Offline.hasGears=window.google&&google.gears;if(ORBEON.xforms.Offline.hasGears){var b=google.gears.factory.create("beta.database");ORBEON.xforms.Offline.gearsDatabase=b;b.open("orbeon.xforms");b.execute("create table if not exists Offline_Forms (url text, event_response text, form_id text, static_state text, dynamic_state text, mappings text, control_values text, offline_events text)").close();b.execute("create table if not exists Current_Password (encrypted_password text)").close();var c=google.gears.factory.create("beta.localserver");ORBEON.xforms.Offline.formStore=c.createStore("orbeon.form")}FunctionCallExpr.prototype.xpathfunctions["xxforms:if"]=function(e){var f=this.args[0].evaluate(e).booleanValue();return new StringValue(this.args[f?1:2].evaluate(e).stringValue())};FunctionCallExpr.prototype.xpathfunctions.matches=function(e){var f=this.args[0].evaluate(e).stringValue();var g=this.args[1].evaluate(e).stringValue();return new BooleanValue(new RegExp(g).test(f))}},reset:function(){ORBEON.xforms.Offline.init();var a=google.gears.factory.create("beta.localserver");a.removeStore("orbeon.form");ORBEON.xforms.Offline.gearsDatabase.execute("drop table if exists Events").close();ORBEON.xforms.Offline.gearsDatabase.execute("drop table if exists Offline_Forms").close();ORBEON.xforms.Offline.gearsDatabase.execute("drop table if exists Current_Password").close();window.google=null;document.cookie="orbeon.forms.encryption.password=; path=/; secure"},pageLoad:function(){ORBEON.xforms.Offline.init();if(ORBEON.xforms.Offline.hasGears){var resultSet=ORBEON.xforms.Offline.gearsDatabase.execute("select * from Offline_Forms where url = ?",[window.location.href]);ORBEON.xforms.Offline.isOnline=!resultSet.isValidRow();if(!ORBEON.xforms.Offline.isOnline){var initialEvents=ORBEON.xforms.Offline._decrypt(resultSet.fieldByName("event_response"),ORBEON.xforms.Offline.getEncryptionKey());var controlValues=resultSet.fieldByName("control_values");var formID=resultSet.fieldByName("form_id");var mappingsString=resultSet.fieldByName("mappings");var mappings=ORBEON.util.String.eval("({"+mappingsString+"})");ORBEON.xforms.Offline.mips=mappings.mips;ORBEON.xforms.Offline._setVariables(mappings.variables);var initialEventsXML=ORBEON.util.Dom.stringToDom(initialEvents);ORBEON.xforms.Globals.requestForm=ORBEON.util.Dom.getElementById(formID);ORBEON.xforms.Server.handleResponseDom(initialEventsXML,formID);controlValues=ORBEON.xforms.Offline._deserializerControlValues(controlValues);for(var controlID in controlValues){var controlValue=controlValues[controlID];var control=ORBEON.util.Dom.getElementById(controlID);ORBEON.xforms.Controls.setCurrentValue(control,controlValue)}ORBEON.xforms.Offline.controlValues=controlValues}else{ORBEON.xforms.Offline.controlValues={}}resultSet.close()}},getEncryptionKey:function(){if(ORBEON.xforms.Offline.encryptionKey!=null){return ORBEON.xforms.Offline.encryptionKey}else{var d=null;var a=document.cookie.split(";");for(var c=0;c<a.length;c++){var b=a[c];var e="orbeon.forms.encryption.password=";while(b.charAt(0)==" "){b=b.substring(1,b.length)}if(b.indexOf(e)==0){d=b.substring(e.length,b.length);break}}if(d==null||d==""){return null}else{ORBEON.xforms.Offline.encryptionKey=hexToByteArray(d);return ORBEON.xforms.Offline.encryptionKey}}},takeOffline:function(eventResponse,formID,mappings){ORBEON.xforms.Offline.init();var controlKeepValueIDs=[];var mappingsObject=ORBEON.util.String.eval("({"+mappings+"})");ORBEON.xforms.Offline.mips=mappingsObject.mips;ORBEON.xforms.Offline._setVariables(mappingsObject.variables);for(var variableName in mappingsObject.variables){var controlID=mappingsObject.variables[variableName].value;controlKeepValueIDs.push(controlID)}var controlValues={};for(var controlIndex=0;controlIndex<controlKeepValueIDs.length;controlIndex++){var controlID=controlKeepValueIDs[controlIndex];controlValues[controlID]=ORBEON.xforms.Controls.getCurrentValue(ORBEON.util.Dom.getElementById(controlID))}var controlValuesString=ORBEON.xforms.Offline._serializeControlValues(controlValues);var resultSet=ORBEON.xforms.Offline.gearsDatabase.execute("insert into Offline_Forms (url, event_response, form_id, static_state, dynamic_state, mappings, control_values, offline_events) values (?, ?, ?, ?, ?, ?, ?, ?)",[window.location.href,ORBEON.xforms.Offline._encrypt(eventResponse,ORBEON.xforms.Offline.getEncryptionKey()),formID,ORBEON.xforms.Globals.formStaticState[formID].value,ORBEON.xforms.Globals.formDynamicState[formID].value,mappings,controlValuesString,""]);resultSet.close();var htmlElements=[].concat(YAHOO.util.Selector.query("script"),YAHOO.util.Selector.query("link"),YAHOO.util.Selector.query("img"));var urlsToCapture=[window.location.href];for(var elementIndex=0;elementIndex<htmlElements.length;elementIndex++){var element=htmlElements[elementIndex];if(YAHOO.lang.isString(element.href)&&element.href!=""){urlsToCapture.push(element.href)}if(YAHOO.lang.isString(element.src)&&element.src!=""){urlsToCapture.push(element.src)}}var removeDupplicates=[];urlsToCapture=urlsToCapture.sort();for(var urlIndex=0;urlIndex<urlsToCapture.length;urlIndex++){if(urlIndex==0||urlsToCapture[urlIndex]!=urlsToCapture[urlIndex-1]){removeDupplicates.push(urlsToCapture[urlIndex])}}urlsToCapture=removeDupplicates;var removeAlreadyCaptured=[];for(var urlIndex=0;urlIndex<urlsToCapture.length;urlIndex++){var url=urlsToCapture[urlIndex];if(!ORBEON.xforms.Offline.formStore.isCaptured(url)){removeAlreadyCaptured.push(url)}}urlsToCapture=removeAlreadyCaptured;if(urlsToCapture.length!=0){ORBEON.xforms.Offline.formStore.capture(urlsToCapture,function(url,success,captureId){if(url==urlsToCapture[urlsToCapture.length-1]){ORBEON.xforms.Offline.isOnline=false}})}else{ORBEON.xforms.Offline.isOnline=false}},takeOnline:function(e){ORBEON.xforms.Offline.init();var g=ORBEON.xforms.Offline.gearsDatabase.execute("select form_id, static_state, dynamic_state, offline_events from Offline_Forms where url = ?",[window.location.href]);var d=g.fieldByName("form_id");ORBEON.xforms.Globals.formDynamicState[d].value=g.fieldByName("dynamic_state");ORBEON.xforms.Globals.formStaticState[d].value=g.fieldByName("static_state");var j=g.fieldByName("offline_events");j=ORBEON.xforms.Offline._decrypt(j,ORBEON.xforms.Offline.getEncryptionKey());ORBEON.xforms.Offline.lastRequestIsTakeOnline=true;ORBEON.xforms.Offline.isOnline=true;if(j!=""){var h=j.split(" ");var k=[];for(var a=0;a<h.length;a++){var f=unescape(h[a]);var b=f.split(" ");for(var c=0;c<b.length;c++){b[c]=unescape(b[c])}k.push(new ORBEON.xforms.Server.Event(ORBEON.util.Dom.getElementById(b[0]),b[1],b[2],b[3],b[4],b[5],b[6]=="1",b[7]=="1"))}ORBEON.xforms.Server.fireEvents(k,false)}ORBEON.xforms.Document.dispatchEvent("#document","xxforms-online");if(!YAHOO.lang.isUndefined(e)){e(window)}},storeEvents:function(a){function b(c){return c==null?"":c}ORBEON.xforms.Offline._runShowingIndicator(function(){ORBEON.xforms.Offline.init();var g=[];for(var c=0;c<a.length;c++){var d=a[c];var e=[b(d.form.id),b(d.targetId),b(d.otherId),b(d.value),b(d.eventName),d.bubbles?1:0,d.cancelable?1:0,d.ignoreErrors?1:0];var k=[];for(var f=0;f<e.length;f++){if(f!=0){k.push(" ")}k.push(escape(e[f]))}if(g.length>0){g.push(" ")}g.push(escape(k.join("")))}if(g.length>0){var l=ORBEON.xforms.Offline.gearsDatabase.execute("select offline_events from Offline_Forms where url = ?",[window.location.href]);var j=l.fieldByName("offline_events");if(j!=""){j=ORBEON.xforms.Offline._decrypt(j,ORBEON.xforms.Offline.getEncryptionKey());j+=" "}j+=g.join("");j=ORBEON.xforms.Offline._encrypt(j,ORBEON.xforms.Offline.getEncryptionKey());var h=ORBEON.xforms.Offline._serializeControlValues(ORBEON.xforms.Offline.controlValues);ORBEON.xforms.Offline.gearsDatabase.execute("update Offline_Forms set control_values = ?, offline_events = ? where url = ?",[h,j,window.location.href]).close()}})},loadFormInIframe:function(a,b){var d="orbeon-offline-iframe";var c=ORBEON.util.Dom.getElementByIdNoCache(d);if(c!=null){c.parentNode.removeChild(c)}c=document.createElement("iframe");c.id=d;c.name=d;c.style.display="none";document.body.appendChild(c);window.childWindowOrbeonReady=function(){b(c)};c.src=a},evaluateMIPs:function(){function a(j,h,l,f,k,n,c){if(l(j)!=n){f(j,n);if(k){for(var o=0;o<h.relevant.inherited.length;o++){var e=k[o];var p=ORBEON.util.Dom.getElementById(e);if(p==null){p=ORBEON.util.Dom.getElementById("group-begin-"+e)}if(c&&p==null){var m=Math.max(e.lastIndexOf(XFORMS_SEPARATOR_1),e.lastIndexOf(XFORMS_SEPARATOR_2));var g=e.substring(0,m);var d=e.substring(m+1);ORBEON.xforms.Controls.setRepeatIterationRelevance(g,d,n)}else{f(p,n)}}}}}function b(c,d){try{return xpathParse(c).evaluate(d).value}catch(f){ORBEON.util.Utils.logMessage("Error evaluating XPath expression "+c);return null}}ORBEON.xforms.Offline._runShowingIndicator(function(){var l=document.createElement("dummy");var r=new ExprContext(l);for(var o in ORBEON.xforms.Offline.variables){var g=ORBEON.xforms.Offline.variables[o].value;var p=ORBEON.xforms.Controls.getCurrentValue(ORBEON.util.Dom.getElementById(g));r.setVariable(o,p)}for(var g in ORBEON.xforms.Offline.mips){var h=ORBEON.xforms.Offline.mips[g];var j=ORBEON.util.Dom.getElementById(g);var k=ORBEON.xforms.Controls.getCurrentValue(j);ORBEON.util.Dom.setStringValue(l,k);if(h.calculate){var d=b(h.calculate.value,r);if(d!=null){ORBEON.xforms.Controls.setCurrentValue(j,d);var o=ORBEON.xforms.Offline.controlIDToVariableName[g];if(o!=null){r.setVariable(o,d)}}}var q=true;if(h.constraint){var c=b("boolean("+h.constraint.value+")",r);if(c!=null){q=q&&c}}if(h.required){var m=b(h.required.value,r);if(m!=null){q&=!(k==""&&m)}}if(h.relevant){var f=b("boolean("+h.relevant.value+")",r);if(f!=null){a(j,h,ORBEON.xforms.Controls.isRelevant,ORBEON.xforms.Controls.setRelevant,h.relevant.inherited,f,true)}}if(h.readonly){var e=b("boolean("+h.readonly.value+")",r);if(e!=null){a(j,h,ORBEON.xforms.Controls.isReadonly,ORBEON.xforms.Controls.setReadonly,h.readonly.inherited,e,false)}}if(h.type){var n=ORBEON.xforms.Offline.typeRegExps[h.type.value];if(n!=null){if(!k.match(n)){q=false}}}ORBEON.xforms.Controls.setValid(j,q?"true":"false")}})},_serializeControlValues:function(b){var a=[];for(controlID in b){if(a.length>0){a.push(" ")}a.push(escape(controlID));a.push(" ");a.push(escape(b[controlID]))}a=ORBEON.xforms.Offline._encrypt(a.join(""),ORBEON.xforms.Offline.getEncryptionKey());return a},_deserializerControlValues:function(a){a=ORBEON.xforms.Offline._decrypt(a,ORBEON.xforms.Offline.getEncryptionKey());var d=a.split(" ");var f={};for(var b=0;b<d.length/2;b++){var c=unescape(d[b*2]);var e=unescape(d[b*2+1]);f[c]=e}return f},_setVariables:function(d){ORBEON.xforms.Offline.variables=d;var b={};for(var a in d){var c=d[a].value;b[c]=a}ORBEON.xforms.Offline.controlIDToVariableName=b},_encrypt:function(b,a){return a==null?b:b==""?b:byteArrayToHex(rijndaelEncrypt(b,a,"ECB"))},_decrypt:function(b,a){return a==null?b:b==""?b:byteArrayToString(rijndaelDecrypt(hexToByteArray(b),a,"ECB"))},_runShowingIndicator:function(a){xformsDisplayIndicator("loading");window.setTimeout(function(){a();xformsDisplayIndicator("none")},ORBEON.util.Properties.internalShortDelay.get())}};function xformsIsDefined(a){return typeof a!="undefined"}function xformsDispatchEvent(c,a){if(c.dispatchEvent){var b=document.createEvent("HTMLEvents");b.initEvent(a.toLowerCase(),true,true);c.dispatchEvent(b)}else{c.fireEvent("on"+a)}}function xformsPreventDefault(a){if(a.preventDefault){a.preventDefault()}else{return false}}function xformsArrayContains(c,b){for(var a=0;a<c.length;a++){if(c[a]==b){return true}}return false}function xformsLog(e){var c=ORBEON.util.Dom.getElementById("xforms-debug");if(c==null){var d;var b;if(navigator.appName.indexOf("Microsoft")!=-1){d=document.body.offsetWidth;b=document.body.offsetHeight}else{d=window.innerWidth;b=window.innerHeight}c=document.createElement("div");c.className="xforms-debug";c.id="xforms-debug";c.style.width=ORBEON.util.Properties.debugWindowWidth.get()+"px";c.style.left=d-(ORBEON.util.Properties.debugWindowWidth.get()+50)+"px";c.style.height=ORBEON.util.Properties.debugWindowHeight.get()+"px";c.style.top=b-(ORBEON.util.Properties.debugWindowHeight.get()+20)+"px";var a=document.createElement("BUTTON");a.appendChild(document.createTextNode("Clear"));c.appendChild(a);document.body.insertBefore(c,document.body.firstChild);YAHOO.util.Event.addListener(a,"click",function(f){var g=getEventTarget(f);while(g.nextSibling){g.parentNode.removeChild(g.nextSibling)}return false});YAHOO.util.Event.addListener(c,"mousedown",function(f){ORBEON.xforms.Globals.debugDiv=getEventTarget(f);return false});YAHOO.util.Event.addListener(document,"mouseup",function(f){ORBEON.xforms.Globals.debugDiv=null;return false});YAHOO.util.Event.addListener(document,"mousemove",function(f){if(ORBEON.xforms.Globals.debugDiv){ORBEON.xforms.Globals.debugDiv.style.left=f.clientX;ORBEON.xforms.Globals.debugDiv.style.top=f.clientY}return false})}text=e===undefined?"undefined":e===null?"null":typeof e=="string"&&e==""?"empty string":e.nodeType&&e.nodeType==ORBEON.util.Dom.ELEMENT_TYPE?"Element "+e.tagName:e.nodeType&&e.nodeType==ORBEON.util.Dom.TEXT_TYPE?"Text: "+ORBEON.util.Dom.getStringValue(e):e;c.innerHTML+=text+" | "}function xformsLogTime(b){var c=ORBEON.xforms.Globals.debugLastTime;var a=new Date().getTime();ORBEON.xforms.Globals.debugLastTime=a;xformsLog((a-c)+": "+b)}function xformsLogProperties(a){var b="[";var d=true;for(var c in a){if(d){d=false}else{b+=", "}b+=c+": "+a[c]}b+="]";xformsLog(b)}function xformsDisplayIndicator(d,a){var c=ORBEON.xforms.Globals.requestForm;if(c!=null){var e=c.id;switch(d){case"loading":var b=ORBEON.xforms.Globals.formLoadingLoadingOverlay[e];if(b!=null){ORBEON.util.Dom.setStringValue(b.element,a==null?DEFAULT_LOADING_TEXT:a);b.show();ORBEON.xforms.Controls.updateLoadingPosition(e)}if(ORBEON.xforms.Globals.formLoadingNone[e]!=null){ORBEON.xforms.Globals.formLoadingNone[e].style.display="block"}break;case"none":if(!ORBEON.xforms.Globals.loadingOtherPage){if(ORBEON.xforms.Globals.formLoadingLoadingOverlay[e]!=null){ORBEON.xforms.Globals.formLoadingLoadingOverlay[e].render(document.body);ORBEON.xforms.Globals.formLoadingLoadingOverlay[e].cfg.setProperty("visible",false)}if(ORBEON.xforms.Globals.formLoadingNone[e]!=null){ORBEON.xforms.Globals.formLoadingNone[e].style.display="block"}}break}}}function xformsValueChanged(g,a){var f=ORBEON.xforms.Controls.getCurrentValue(g);var b=f!=g.previousValue;var d=ORBEON.util.Dom.hasClass(g,"xforms-upload");if(b&&!d){g.previousValue=f;var e=a==null&&ORBEON.util.Dom.hasClass(g,"xforms-incremental");var h=YAHOO.lang.isObject(a)?a.id:null;var c=new ORBEON.xforms.Server.Event(null,g.id,h,f,"xxforms-value-change-with-focus-change");ORBEON.xforms.Server.fireEvents([c],e)}return b}function xformsHandleClick(a){var b=getEventTarget(a);if((ORBEON.util.Dom.hasClass(b,"xforms-trigger")||ORBEON.util.Dom.hasClass(b,"xforms-trigger"))&&!ORBEON.util.Dom.hasClass(b,"xforms-readonly")){var a=new ORBEON.xforms.Server.Event(null,b.id,null,null,"DOMActivate");ORBEON.xforms.Server.fireEvents([a],false)}return false}function xformsHandleAutoCompleteMouseChange(a){a.parentNode.lastKeyCode=-1;a.parentNode.value=a.value;xformsValueChanged(a.parentNode,null)}function xformsCreateEventArray(d,b,c,a,e){return new Array(d,b,c,a,e)}function getEventTarget(a){if(a&&a.LinkedField){return a.LinkedField}else{a=a?a:window.event;var b=a.srcElement?a.srcElement:a.target;if(b.xformsElement){return b.xformsElement}else{if(b.ownerDocument.xformsElement){return b.ownerDocument.xformsElement}else{return b}}}}function xformsHtmlEditorChange(a){a.LinkedField.value=a.GetXHTML();if(ORBEON.util.Dom.hasClass(a.LinkedField,"xforms-incremental")){xformsValueChanged(a.LinkedField,null)}}function FCKeditor_OnComplete(b){b.EditorDocument.xformsElement=b.LinkedField;if(ORBEON.util.Dom.hasClass(b.LinkedField,"xforms-incremental")){b.Events.AttachEvent("OnSelectionChange",xformsHtmlEditorChange)}YAHOO.util.Event.addListener(b.EditorDocument,"focus",ORBEON.xforms.Events.focus);YAHOO.util.Event.addListener(b.EditorDocument,"blur",ORBEON.xforms.Events.blur);YAHOO.util.Event.addListener(b.EditorDocument,"focusin",ORBEON.xforms.Events.focus);YAHOO.util.Event.addListener(b.EditorDocument,"focusout",ORBEON.xforms.Events.blur);if(ORBEON.xforms.Globals.fckEditorsToLoad.length>0){var a=ORBEON.xforms.Globals.fckEditorsToLoad.shift();a.ReplaceTextarea();ORBEON.xforms.Controls.updateHTMLAreaClasses(ORBEON.util.Dom.getElementById(a.InstanceName))}else{ORBEON.xforms.Globals.fckEditorLoading=false;if(typeof xformsPageLoadedServer!="undefined"){xformsPageLoadedServer()}}}function xformsDisplayLoading(a){if(ORBEON.xforms.Globals.requestInProgress==true){xformsDisplayIndicator("loading",a)}}if(!ORBEON.xforms.Globals.pageLoadedRegistered){var foundDojoContentPane=false;for(var i=0;i<document.forms.length;i++){var form=document.forms[i];if(form.className.indexOf("xforms-form")!=-1){var currentElement=form.parentNode;while(currentElement!=null){if(currentElement.className=="dijitContentPane"){foundDojoContentPane=true;break}currentElement=currentElement.parentNode}}}if(!foundDojoContentPane){ORBEON.xforms.Globals.pageLoadedRegistered=true;YAHOO.util.Event.throwErrors=true;YAHOO.util.Event.onDOMReady(ORBEON.xforms.Init.document);ORBEON.xforms.Globals.debugLastTime=new Date().getTime();ORBEON.xforms.Globals.lastEventSentTime=new Date().getTime()}};